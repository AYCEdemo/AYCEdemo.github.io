<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Emptyx16 - X16 Hardware Specs</title>
    <style>
body {
  font-size: 16px;
  font-family: Arial, Helvetica, sans-serif;
}
.main-wrapper {
  margin-left: 240px;
}
.main {
  max-width: 48em;
  margin: auto;
}
.toc {
  position: fixed;
  left: 0;
  top: 0;
  bottom: 0;
  width: 240px;
}
.toc .nav {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  margin: 0;
  padding: 10px;
  overflow: auto;
}
.toc .nav .sidebar-header-1 {
  list-style: none;
}
.toc .nav .sidebar-header-2 {
  font-size: small;
  margin-left: 1em;
  list-style: disc;
}
.toc .nav .sidebar-header-3 {
  font-size: small;
  margin-left: 2em;
  list-style: circle;
}
.toc .nav li a {
  text-decoration: none;
}
p {
  text-align: justify;
}
p, li {
  line-height: 1.4;
}
pre {
  font-size: 0.85em;
  overflow: auto;
  padding: 0 0.5em;
}
code {
  font-size: 1em;
}
h1, h2, h3 {
  position: relative;
}
h1:hover .header-link:before,
h2:hover .header-link:before,
h3:hover .header-link:before {
    content: "\00B6";
    font-size: smaller;
}
.header-link {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;

  position: absolute;
  top: 0;
  left: -0.7em;
  display: block;
  padding-right: 1em;
}
h1:hover .header-link,
h2:hover .header-link,
h3:hover .header-link {
  display: inline-block;
  text-decoration: none;
}
@media print {
  body {
    font-size: 10.8px;
    font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
  }
  .toc {
    display: none;
  }
  a {
    color: blue;
  }
  h1:not(:first-of-type) {
    page-break-before: always;
  }
  pre {
    page-break-inside: avoid;
  }
}
    </style>
  </head>
<body>
  <nav class="toc"><ul class="nav nav-list">
    <li class="sidebar-header-1"><a href="#emptyx16---x16-hardware-specs">Emptyx16 - X16 Hardware Specs</a></li>
    <li class="sidebar-header-3"><a href="#x16-hardware-specifications">X16 Hardware Specifications</a></li>
    <li class="sidebar-header-3"><a href="#about">About</a></li>
    <li class="sidebar-header-1"><a href="#x16-overview">X16 Overview</a></li>
    <li class="sidebar-header-3"><a href="#cpu">CPU</a></li>
    <li class="sidebar-header-3"><a href="#internal-memory">Internal Memory</a></li>
    <li class="sidebar-header-3"><a href="#video">Video</a></li>
    <li class="sidebar-header-3"><a href="#sound">Sound</a></li>
    <li class="sidebar-header-3"><a href="#interface-ports">Interface Ports</a></li>
    <li class="sidebar-header-1"><a href="#x16-io-map">X16 I/O Map</a></li>
    <li class="sidebar-header-3"><a href="#first-some-bytes">First some bytes</a></li>
    <li class="sidebar-header-3"><a href="#via-versatile-interface-adapter-rw">VIA Versatile Interface Adapter (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#vera-versatile-embedded-retro-adapter-rw">VERA Versatile Embedded Retro Adapter (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#ym2151-io-ports">YM2151 I/O Ports</a></li>
    <li class="sidebar-header-3"><a href="#further-memory">Further Memory</a></li>
    <li class="sidebar-header-3"><a href="#vera-registers-internal-to-vera-not-the-main-cpu">VERA Registers (internal to VERA, not the Main CPU)</a></li>
    <li class="sidebar-header-1"><a href="#x16-memory">X16 Memory</a></li>
    <li class="sidebar-header-3"><a href="#system-rom">System ROM</a></li>
    <li class="sidebar-header-3"><a href="#fixed-and-banked-ram">Fixed and Banked RAM</a></li>
    <li class="sidebar-header-3"><a href="#vera-memory">VERA Memory</a></li>
    <li class="sidebar-header-3"><a href="#audio-fifo-buffer">Audio FIFO buffer</a></li>
    <li class="sidebar-header-3"><a href="#rtc-nvram">RTC NVRAM</a></li>
    <li class="sidebar-header-2"><a href="#x16-memory-map">X16 Memory Map</a></li>
    <li class="sidebar-header-3"><a href="#overall-memory-map">Overall Memory Map</a></li>
    <li class="sidebar-header-3"><a href="#default-ram-usage">Default RAM Usage</a></li>
    <li class="sidebar-header-2"><a href="#x16-memory-control">X16 Memory Control</a></li>
    <li class="sidebar-header-3"><a href="#0000h---current-ram-bank-rw">0000h - Current RAM Bank (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#0001h---current-rom-bank-rw">0001h - Current ROM Bank (R/W)</a></li>
    <li class="sidebar-header-2"><a href="#x16-vera-memory-access">X16 VERA Memory Access</a></li>
    <li class="sidebar-header-3"><a href="#9f20h---addr_l---vram-address-lower-8-bits-rw">9F20h - ADDR_L - VRAM Address (lower 8 bits) (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f21h---addr_m---vram-address-middle-8-bits-rw">9F21h - ADDR_M - VRAM Address (middle 8 bits) (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f22h---addr_h---vram-address-upper-1-bit-and-increment-mode-rw">9F22h - ADDR_H - VRAM Address (upper 1 bit) and Increment Mode (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f23h---data0---vram-data-port-0-rw">9F23h - DATA0 - VRAM Data Port 0 (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f24h---data1---vram-data-port-1-rw">9F24h - DATA1 - VRAM Data Port 1 (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#memory-content">Memory Content</a></li>
    <li class="sidebar-header-2"><a href="#x16-ym2151-access">X16 YM2151 Access</a></li>
    <li class="sidebar-header-3"><a href="#9f40h---ym2151-register-address-w">9F40h - YM2151 Register Address (W)</a></li>
    <li class="sidebar-header-3"><a href="#9f41h---ym2151-register-data-w--status-r">9F41h - YM2151 Register Data (W) / Status (R)</a></li>
    <li class="sidebar-header-1"><a href="#x16-versatile-embedded-retro-adapter-vera">X16 Versatile Embedded Retro Adapter (VERA)</a></li>
    <li class="sidebar-header-3"><a href="#embedded-memory">Embedded Memory</a></li>
    <li class="sidebar-header-2"><a href="#x16-vera-control">X16 VERA Control</a></li>
    <li class="sidebar-header-3"><a href="#9f25h---ctrl---control-rw">9F25h - CTRL - Control (R/W)</a></li>
    <li class="sidebar-header-2"><a href="#x16-vera-display-composer">X16 VERA Display Composer</a></li>
    <li class="sidebar-header-3"><a href="#9f29h-dcsel0---dc_video---active-display-control-rw">9F29h (DCSEL&#x3D;0) - DC_VIDEO - Active Display Control (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f2ah-dcsel0---dc_hscale---active-display-h-scale-rw">9F2Ah (DCSEL&#x3D;0) - DC_HSCALE - Active Display H-Scale (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f2bh-dcsel0---dc_vscale---active-display-v-scale-rw">9F2Bh (DCSEL&#x3D;0) - DC_VSCALE - Active Display V-Scale (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f2ch-dcsel0---dc_border---border-color-rw">9F2Ch (DCSEL&#x3D;0) - DC_BORDER - Border Color (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f29h-dcsel1---dc_hstart---active-display-h-start-rw">9F29h (DCSEL&#x3D;1) - DC_HSTART - Active Display H-Start (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f2bh-dcsel1---dc_vstart---active-display-v-start-rw">9F2Bh (DCSEL&#x3D;1) - DC_VSTART - Active Display V-Start (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f2ah-dcsel1---dc_hstop---active-display-h-stop-rw">9F2Ah (DCSEL&#x3D;1) - DC_HSTOP - Active Display H-Stop (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f2ch-dcsel1---dc_vstop---active-display-v-stop-rw">9F2Ch (DCSEL&#x3D;1) - DC_VSTOP - Active Display V-Stop (R/W)</a></li>
    <li class="sidebar-header-2"><a href="#x16-vera-layer-control">X16 VERA Layer Control</a></li>
    <li class="sidebar-header-3"><a href="#9f2dh---l0_config---l0-mode-and-map-size-rw">9F2Dh - L0_CONFIG - L0 Mode and Map Size (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f34h---l1_config---l1-mode-and-map-size-rw">9F34h - L1_CONFIG - L1 Mode and Map Size (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f2eh---l0_mapbase---l0-map-base-rw">9F2Eh - L0_MAPBASE - L0 Map Base (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f35h---l1_mapbase---l1-map-base-rw">9F35h - L1_MAPBASE - L1 Map Base (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f2fh---l0_tilebase---l0-tile-base-and-tile-size-rw">9F2Fh - L0_TILEBASE - L0 Tile Base and Tile Size (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f36h---l1_tilebase---l1-tile-base-and-tile-size-rw">9F36h - L1_TILEBASE - L1 Tile Base and Tile Size (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f30h9f31h---l0_hscroll_ll0_hscroll_h---l0-horizontal-scroll-rw">9F30h/9F31h - L0_HSCROLL_L/L0_HSCROLL_H - L0 Horizontal Scroll (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f37h9f38h---l1_hscroll_ll1_hscroll_h---l1-horizontal-scroll-rw">9F37h/9F38h - L1_HSCROLL_L/L1_HSCROLL_H - L1 Horizontal Scroll (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f32h9f33h---l0_vscroll_ll0_vscroll_h---l0-vertical-scroll-rw">9F32h/9F33h - L0_VSCROLL_L/L0_VSCROLL_H - L0 Vertical Scroll (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f39h9f3ah---l1_vscroll_ll1_vscroll_h---l1-vertical-scroll-rw">9F39h/9F3Ah - L1_VSCROLL_L/L1_VSCROLL_H - L1 Vertical Scroll (R/W)</a></li>
    <li class="sidebar-header-2"><a href="#x16-vera-interrupts">X16 VERA Interrupts</a></li>
    <li class="sidebar-header-3"><a href="#9f26h---ien---interrupt-enable--line-compare-upper-1-bit-rw">9F26h - IEN - Interrupt Enable / Line Compare (upper 1 bit) (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f27h---isr---interrupt--status-register-rw">9F27h - ISR - Interrupt / Status Register (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f28h---irqline_l---interrupt-line-compare-lower-8-bits-rw">9F28h - IRQLINE_L - Interrupt Line Compare (lower 8 bits) (R/W)</a></li>
    <li class="sidebar-header-2"><a href="#x16-vera-audio-fifo">X16 VERA Audio FIFO</a></li>
    <li class="sidebar-header-3"><a href="#9f3bh---audio_ctrl---audio-fifo-control-rw">9F3Bh - AUDIO_CTRL - Audio FIFO Control (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f3ch---audio_rate---audio-fifo-sample-rate-rw">9F3Ch - AUDIO_RATE - Audio FIFO Sample Rate (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f3dh---audio_data---audio-fifo-data-w">9F3Dh - AUDIO_DATA - Audio FIFO Data (W)</a></li>
    <li class="sidebar-header-2"><a href="#x16-vera-memory-card-interface">X16 VERA Memory Card Interface</a></li>
    <li class="sidebar-header-3"><a href="#9f3eh---spi_data---spi-data-rw">9F3Eh - SPI_DATA - SPI Data (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#9f3fh---spi_ctrl---spi-control-rw">9F3Fh - SPI_CTRL - SPI Control (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#memory-card-commands">Memory Card Commands</a></li>
    <li class="sidebar-header-3"><a href="#memory-card-initialization">Memory Card Initialization</a></li>
    <li class="sidebar-header-3"><a href="#memory-card-data-transfer">Memory Card Data Transfer</a></li>
    <li class="sidebar-header-2"><a href="#x16-vera-memory-and-io-map-vram">X16 VERA Memory and I/O Map (VRAM)</a></li>
    <li class="sidebar-header-3"><a href="#vera-memory-map">VERA Memory Map</a></li>
    <li class="sidebar-header-3"><a href="#tile-map">Tile Map</a></li>
    <li class="sidebar-header-3"><a href="#tile-data-layers-and-obj">Tile Data (Layers and OBJ)</a></li>
    <li class="sidebar-header-3"><a href="#bitmap-data">Bitmap Data</a></li>
    <li class="sidebar-header-3"><a href="#accessing-vram">Accessing VRAM</a></li>
    <li class="sidebar-header-2"><a href="#x16-vera-programmable-sound-generator-psg">X16 VERA Programmable Sound Generator (PSG)</a></li>
    <li class="sidebar-header-3"><a href="#volume">Volume</a></li>
    <li class="sidebar-header-3"><a href="#waveform">Waveform</a></li>
    <li class="sidebar-header-2"><a href="#x16-vera-color-palette">X16 VERA Color Palette</a></li>
    <li class="sidebar-header-3"><a href="#color-palette-entries">Color Palette Entries</a></li>
    <li class="sidebar-header-3"><a href="#color-palette-indices">Color Palette Indices</a></li>
    <li class="sidebar-header-3"><a href="#initial-palette">Initial Palette</a></li>
    <li class="sidebar-header-3"><a href="#screen-border-color">Screen Border Color</a></li>
    <li class="sidebar-header-2"><a href="#x16-vera-sprites-objs">X16 VERA Sprites (OBJs)</a></li>
    <li class="sidebar-header-3"><a href="#oam-object-attribute-memory">OAM (Object Attribute Memory)</a></li>
    <li class="sidebar-header-3"><a href="#sprite-collision">Sprite Collision</a></li>
    <li class="sidebar-header-3"><a href="#obj-priority-to-other-objs">OBJ Priority to Other OBJs</a></li>
    <li class="sidebar-header-3"><a href="#maximum-number-of-sprites-per-line">Maximum Number of Sprites per Line</a></li>
    <li class="sidebar-header-1"><a href="#x16-peripherals">X16 Peripherals</a></li>
    <li class="sidebar-header-2"><a href="#via-connections">VIA Connections</a></li>
    <li class="sidebar-header-3"><a href="#1st-via-9f0xh">1st VIA (9F0xh)</a></li>
    <li class="sidebar-header-3"><a href="#2nd-via-9f1xh">2nd VIA (9F1xh)</a></li>
    <li class="sidebar-header-2"><a href="#x16-ps2-interface-keyboardmouse">X16 PS/2 Interface (Keyboard/Mouse)</a></li>
    <li class="sidebar-header-3"><a href="#ps2-bus-access-read">PS/2 Bus Access (Read)</a></li>
    <li class="sidebar-header-3"><a href="#ps2-bus-access-write">PS/2 Bus Access (Write)</a></li>
    <li class="sidebar-header-3"><a href="#parity-bit">Parity Bit</a></li>
    <li class="sidebar-header-3"><a href="#device-self-test-bat">Device Self-test (BAT)</a></li>
    <li class="sidebar-header-3"><a href="#keyboard-data-scancode-summary">Keyboard Data (Scancode) Summary</a></li>
    <li class="sidebar-header-3"><a href="#normal-keyboard-scancodes-us-layout">Normal Keyboard Scancodes (US Layout)</a></li>
    <li class="sidebar-header-3"><a href="#special-keyboard-scancodes">Special Keyboard Scancodes</a></li>
    <li class="sidebar-header-3"><a href="#mouse-modes">Mouse Modes</a></li>
    <li class="sidebar-header-3"><a href="#mouse-data">Mouse Data</a></li>
    <li class="sidebar-header-3"><a href="#host-write-commands">Host Write Commands</a></li>
    <li class="sidebar-header-2"><a href="#x16-joypad-interface-snes-controllers">X16 Joypad Interface (SNES Controllers)</a></li>
    <li class="sidebar-header-3"><a href="#x16-joypad-access">X16 Joypad Access</a></li>
    <li class="sidebar-header-3"><a href="#standard-snes-joypad-bits">Standard SNES Joypad Bits</a></li>
    <li class="sidebar-header-3"><a href="#other-snes-controllersdevices">Other SNES Controllers/Devices</a></li>
    <li class="sidebar-header-2"><a href="#x16-iec-interface-commodore-disk-drivesprinters">X16 IEC Interface (Commodore Disk Drives/Printers)</a></li>
    <li class="sidebar-header-1"><a href="#x16-i2c-bus">X16 I2C Bus</a></li>
    <li class="sidebar-header-3"><a href="#internal-i2c-devices">Internal I2C Devices</a></li>
    <li class="sidebar-header-2"><a href="#x16-i2c-bus-access">X16 I2C Bus Access</a></li>
    <li class="sidebar-header-2"><a href="#x16-system-management-controller">X16 System Management Controller</a></li>
    <li class="sidebar-header-3"><a href="#transfer-sequences">Transfer Sequences</a></li>
    <li class="sidebar-header-3"><a href="#commands">Commands</a></li>
    <li class="sidebar-header-2"><a href="#mcp7940n-real-time-clock">MCP7940N Real-Time Clock</a></li>
    <li class="sidebar-header-3"><a href="#transfer-sequences-1">Transfer Sequences</a></li>
    <li class="sidebar-header-3"><a href="#multi-function-pin">Multi-function Pin</a></li>
    <li class="sidebar-header-3"><a href="#power-down-and-power-up-timestamps">Power-down and Power-up Timestamps</a></li>
    <li class="sidebar-header-3"><a href="#memory-map">Memory Map</a></li>
    <li class="sidebar-header-3"><a href="#00h---rtcsec---timekeeping-seconds-rw">00h - RTCSEC - Timekeeping Seconds (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#01h---rtcmin---timekeeping-minutes-rw">01h - RTCMIN - Timekeeping Minutes (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#02h---rtchour---timekeeping-hours-rw">02h - RTCHOUR - Timekeeping Hours (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#03h---rtcwkday---timekeeping-weekday-rw">03h - RTCWKDAY - Timekeeping Weekday (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#04h---rtcdate---timekeeping-date-rw">04h - RTCDATE - Timekeeping Date (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#05h---rtcmth---timekeeping-month-rw">05h - RTCMTH - Timekeeping Month (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#06h---rtcyear---timekeeping-year-rw">06h - RTCYEAR - Timekeeping Year (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#07h---control---control-rw">07h - CONTROL - Control (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#08h---osctrim---oscillator-digital-trim-rw">08h - OSCTRIM - Oscillator Digital Trim (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#0ah---alm0sec---alarm-0-seconds-rw">0Ah - ALM0SEC - Alarm 0 Seconds (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#11h---alm1sec---alarm-1-seconds-rw">11h - ALM1SEC - Alarm 1 Seconds (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#0bh---alm0min---alarm-0-minutes-rw">0Bh - ALM0MIN - Alarm 0 Minutes (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#12h---alm1min---alarm-1-minutes-rw">12h - ALM1MIN - Alarm 1 Minutes (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#0ch---alm0hour---alarm-0-hours-rw">0Ch - ALM0HOUR - Alarm 0 Hours (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#13h---alm1hour---alarm-1-hours-rw">13h - ALM1HOUR - Alarm 1 Hours (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#0dh---alm0wkday---alarm-0-weekday--mask-rw">0Dh - ALM0WKDAY - Alarm 0 Weekday / Mask (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#14h---alm1wkday---alarm-1-weekday--mask-rw">14h - ALM1WKDAY - Alarm 1 Weekday / Mask (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#0eh---alm0date---alarm-0-date-rw">0Eh - ALM0DATE - Alarm 0 Date (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#15h---alm1date---alarm-1-date-rw">15h - ALM1DATE - Alarm 1 Date (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#0fh---alm0mth---alarm-0-month-rw">0Fh - ALM0MTH - Alarm 0 Month (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#16h---alm1mth---alarm-1-month-rw">16h - ALM1MTH - Alarm 1 Month (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#18h---pwrdnmin---power-down-minutes-rw">18h - PWRDNMIN - Power Down Minutes (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#1ch---pwrupmin---power-up-minutes-rw">1Ch - PWRUPMIN - Power Up Minutes (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#19h---pwrdnhour---power-down-hours-rw">19h - PWRDNHOUR - Power Down Hours (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#1dh---pwruphour---power-up-hours-rw">1Dh - PWRUPHOUR - Power Up Hours (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#1ah---pwrdndate---power-down-date-rw">1Ah - PWRDNDATE - Power Down Date (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#1eh---pwrupdate---power-up-date-rw">1Eh - PWRUPDATE - Power Up Date (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#1bh---pwrdnmth---power-down-month--weekday-rw">1Bh - PWRDNMTH - Power Down Month / Weekday (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#1fh---pwrupmth---power-up-month--weekday-rw">1Fh - PWRUPMTH - Power Up Month / Weekday (R/W)</a></li>
    <li class="sidebar-header-1"><a href="#x16-timings">X16 Timings</a></li>
    <li class="sidebar-header-2"><a href="#x16-timing-oscillators">X16 Timing Oscillators</a></li>
    <li class="sidebar-header-3"><a href="#system-timings">System Timings</a></li>
    <li class="sidebar-header-3"><a href="#vera-timings">VERA Timings</a></li>
    <li class="sidebar-header-3"><a href="#ym2151-timings">YM2151 Timings</a></li>
    <li class="sidebar-header-2"><a href="#x16-video-timings">X16 Video Timings</a></li>
    <li class="sidebar-header-3"><a href="#horizontal-timings">Horizontal Timings</a></li>
    <li class="sidebar-header-3"><a href="#detailed-timings">Detailed Timings</a></li>
    <li class="sidebar-header-1"><a href="#via-versatile-interface-adapter">VIA Versatile Interface Adapter</a></li>
    <li class="sidebar-header-2"><a href="#via-peripheral-data-ports">VIA Peripheral Data Ports</a></li>
    <li class="sidebar-header-3"><a href="#0h---prb---port-b-inputoutput-rw">0h - PRB - Port B Input/Output (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#1h---pra---port-a-inputoutput-rw">1h - PRA - Port A Input/Output (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#fh---pra2---port-a-inputoutput-without-handshaking-rw">Fh - PRA2 - Port A Input/Output Without Handshaking (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#2h---ddrb---port-b-data-direction-rw">2h - DDRB - Port B Data Direction (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#3h---ddra---port-a-data-direction-rw">3h - DDRA - Port A Data Direction (R/W)</a></li>
    <li class="sidebar-header-2"><a href="#via-data-transfer-controls">VIA Data Transfer Controls</a></li>
    <li class="sidebar-header-3"><a href="#bh---acr---auxiliary-control-register-rw">Bh - ACR - Auxiliary Control Register (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#ch---pcr---peripheral-control-register-rw">Ch - PCR - Peripheral Control Register (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#handshake-control">Handshake Control</a></li>
    <li class="sidebar-header-2"><a href="#via-timer-1">VIA Timer 1</a></li>
    <li class="sidebar-header-3"><a href="#4h5h---t1lt1h---t1-counter-rw">4h/5h - T1L/T1H - T1 Counter (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#6h7h---t1llt1lh---t1-latch-rw">6h/7h - T1LL/T1LH - T1 Latch (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#timer-1-one-shot-mode-acr-bit-6--0">Timer 1 One-shot Mode (ACR bit 6 &#x3D; 0)</a></li>
    <li class="sidebar-header-3"><a href="#timer-1-free-running-mode-acr-bit-6--1">Timer 1 Free-running Mode (ACR bit 6 &#x3D; 1)</a></li>
    <li class="sidebar-header-2"><a href="#via-timer-2">VIA Timer 2</a></li>
    <li class="sidebar-header-3"><a href="#8h9h---t2lt2h---t2-counter-rw">8h/9h - T2L/T2H - T2 Counter (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#timer-2-pulse-counting-mode-acr-bit-5--1">Timer 2 Pulse Counting Mode (ACR bit 5 &#x3D; 1)</a></li>
    <li class="sidebar-header-2"><a href="#via-shift-register">VIA Shift Register</a></li>
    <li class="sidebar-header-3"><a href="#ah---sr---shift-register-rw">Ah - SR  - Shift Register (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#shifting-disabled-acr-bit-2-4--0">Shifting Disabled (ACR bit 2-4 &#x3D; 0)</a></li>
    <li class="sidebar-header-3"><a href="#shift-in-at-t2-rate-acr-bit-2-4--1">Shift In At T2 Rate (ACR bit 2-4 &#x3D; 1)</a></li>
    <li class="sidebar-header-3"><a href="#shift-in-at-phi2-clock-acr-bit-2-4--2">Shift In At PHI2 Clock (ACR bit 2-4 &#x3D; 2)</a></li>
    <li class="sidebar-header-3"><a href="#shift-in-at-cb1-input-clock-acr-bit-2-4--3">Shift In At CB1 Input Clock (ACR bit 2-4 &#x3D; 3)</a></li>
    <li class="sidebar-header-3"><a href="#shift-out-free-running-at-t2-rate-acr-bit-2-4--4">Shift Out Free-running At T2 Rate (ACR bit 2-4 &#x3D; 4)</a></li>
    <li class="sidebar-header-3"><a href="#shift-out-at-t2-rate-acr-bit-2-4--5">Shift Out At T2 Rate (ACR bit 2-4 &#x3D; 5)</a></li>
    <li class="sidebar-header-3"><a href="#shift-out-at-phi2-clock-acr-bit-2-4--6">Shift Out At PHI2 Clock (ACR bit 2-4 &#x3D; 6)</a></li>
    <li class="sidebar-header-3"><a href="#shift-out-at-cb1-input-clock-acr-bit-2-4--7">Shift Out At CB1 Input Clock (ACR bit 2-4 &#x3D; 7)</a></li>
    <li class="sidebar-header-2"><a href="#via-interrupts">VIA Interrupts</a></li>
    <li class="sidebar-header-3"><a href="#dh---ifr---interrupt-flags-register-rw">Dh - IFR - Interrupt Flags Register (R/W)</a></li>
    <li class="sidebar-header-3"><a href="#eh---ier---interrupt-enable-register-rw">Eh - IER - Interrupt Enable Register (R/W)</a></li>
    <li class="sidebar-header-1"><a href="#ym2151-fm-operator-type-m-opm">YM2151 FM Operator Type-M (OPM)</a></li>
    <li class="sidebar-header-3"><a href="#overview">Overview</a></li>
    <li class="sidebar-header-3"><a href="#functions">Functions</a></li>
    <li class="sidebar-header-2"><a href="#ym2151-address-map">YM2151 Address Map</a></li>
    <li class="sidebar-header-2"><a href="#ym2151-block-diagram">YM2151 Block Diagram</a></li>
    <li class="sidebar-header-3"><a href="#overall-block-diagram">Overall Block Diagram</a></li>
    <li class="sidebar-header-3"><a href="#channel-block-diagram">Channel Block Diagram</a></li>
    <li class="sidebar-header-3"><a href="#slot-block-diagram">Slot Block Diagram</a></li>
    <li class="sidebar-header-3"><a href="#slot-connections-algorithms">Slot Connections (Algorithms)</a></li>
    <li class="sidebar-header-2"><a href="#ym2151-control-registers">YM2151 Control Registers</a></li>
    <li class="sidebar-header-3"><a href="#01h---test-registers">01h - Test Registers</a></li>
    <li class="sidebar-header-3"><a href="#1bh---control-output">1Bh - Control Output</a></li>
    <li class="sidebar-header-2"><a href="#ym2151-timers">YM2151 Timers</a></li>
    <li class="sidebar-header-3"><a href="#10h11h---timer-a-reload">10h/11h - Timer A Reload</a></li>
    <li class="sidebar-header-3"><a href="#12h---timer-b-reload-clkb">12h - Timer B Reload (CLKB)</a></li>
    <li class="sidebar-header-3"><a href="#14h---timer-control">14h - Timer Control</a></li>
    <li class="sidebar-header-2"><a href="#ym2151-channels-and-slots">YM2151 Channels and Slots</a></li>
    <li class="sidebar-header-3"><a href="#20h27h---channel-07-output--feedback--connection">20h..27h - Channel 0..7 Output / Feedback / Connection</a></li>
    <li class="sidebar-header-2"><a href="#ym2151-phase-generator">YM2151 Phase Generator</a></li>
    <li class="sidebar-header-3"><a href="#28h2fh---channel-07-key-code-kc">28h..2Fh - Channel 0..7 Key Code (KC)</a></li>
    <li class="sidebar-header-3"><a href="#30h37h---channel-07-key-fraction">30h..37h - Channel 0..7 Key Fraction</a></li>
    <li class="sidebar-header-3"><a href="#frequency-register-notes">Frequency Register Notes</a></li>
    <li class="sidebar-header-3"><a href="#40h5fh---slot-031-detune-1--phase-multiply">40h..5Fh - Slot 0..31 Detune 1 / Phase Multiply</a></li>
    <li class="sidebar-header-3"><a href="#c0hdfh---slot-031-detune-2">C0h..DFh - Slot 0..31 Detune 2</a></li>
    <li class="sidebar-header-2"><a href="#ym2151-adsr-envelope">YM2151 ADSR Envelope</a></li>
    <li class="sidebar-header-3"><a href="#08h---key-on--off">08h - Key On / Off</a></li>
    <li class="sidebar-header-3"><a href="#60h7fh---slot-031-total-level">60h..7Fh - Slot 0..31 Total Level</a></li>
    <li class="sidebar-header-3"><a href="#80h9fh---slot-031-key-scaling--attack-rate">80h..9Fh - Slot 0..31 Key Scaling / Attack Rate</a></li>
    <li class="sidebar-header-3"><a href="#a0hbfh---slot-031-decay-1-rate">A0h..BFh - Slot 0..31 Decay 1 Rate</a></li>
    <li class="sidebar-header-3"><a href="#c0hdfh---slot-031-decay-2-rate">C0h..DFh - Slot 0..31 Decay 2 Rate</a></li>
    <li class="sidebar-header-3"><a href="#e0hffh---slot-031-decay-1-level--release-rate">E0h..FFh - Slot 0..31 Decay 1 Level / Release Rate</a></li>
    <li class="sidebar-header-3"><a href="#adsr-rates">ADSR Rates</a></li>
    <li class="sidebar-header-2"><a href="#ym2151-low-frequency-oscillator-lfo">YM2151 Low Frequency Oscillator (LFO)</a></li>
    <li class="sidebar-header-3"><a href="#18h---lfo-frequency-lfrq">18h - LFO Frequency (LFRQ)</a></li>
    <li class="sidebar-header-3"><a href="#19h---phase--amplitude-modulation-depth">19h - Phase / Amplitude Modulation Depth</a></li>
    <li class="sidebar-header-3"><a href="#1bh---lfo-waveform">1Bh - LFO Waveform</a></li>
    <li class="sidebar-header-3"><a href="#38h3fh---channel-07-phase--amplitude-modulation-sensitivity">38h..3Fh - Channel 0..7 Phase / Amplitude Modulation Sensitivity</a></li>
    <li class="sidebar-header-3"><a href="#a0hbfh---slot-031-ams-enable">A0h..BFh - Slot 0..31 AMS Enable</a></li>
    <li class="sidebar-header-2"><a href="#ym2151-noise-generator">YM2151 Noise Generator</a></li>
    <li class="sidebar-header-3"><a href="#0fh---noise-enable--frequency">0Fh - Noise Enable / Frequency</a></li>
    <li class="sidebar-header-1"><a href="#cpu-65c02-microprocessor">CPU 65C02 Microprocessor</a></li>
    <li class="sidebar-header-3"><a href="#overview-1">Overview</a></li>
    <li class="sidebar-header-3"><a href="#instruction-set">Instruction Set</a></li>
    <li class="sidebar-header-2"><a href="#cpu-registers-and-flags">CPU Registers and Flags</a></li>
    <li class="sidebar-header-3"><a href="#registers">Registers</a></li>
    <li class="sidebar-header-3"><a href="#stack-pointer">Stack Pointer</a></li>
    <li class="sidebar-header-3"><a href="#processor-status-register-flags">Processor Status Register (Flags)</a></li>
    <li class="sidebar-header-3"><a href="#carry-flag-c">Carry Flag (C)</a></li>
    <li class="sidebar-header-3"><a href="#zero-flag-z-negativesign-flag-n-overflow-flag-v">Zero Flag (Z), Negative/Sign Flag (N), Overflow Flag (V)</a></li>
    <li class="sidebar-header-3"><a href="#irq-disable-flag-i">IRQ Disable Flag (I)</a></li>
    <li class="sidebar-header-3"><a href="#decimal-mode-flag-d">Decimal Mode Flag (D)</a></li>
    <li class="sidebar-header-3"><a href="#break-flag-b">Break Flag (B)</a></li>
    <li class="sidebar-header-2"><a href="#cpu-memory-addressing">CPU Memory Addressing</a></li>
    <li class="sidebar-header-3"><a href="#opcode-addressing-modes">Opcode Addressing Modes</a></li>
    <li class="sidebar-header-3"><a href="#zero-page---nn-nnx-nny">Zero Page - nn nn,X nn,Y</a></li>
    <li class="sidebar-header-3"><a href="#absolute---nnnn-nnnnx-nnnny">Absolute - nnnn nnnn+X nnnn+Y</a></li>
    <li class="sidebar-header-3"><a href="#indirect---nn-nnx-nny-nnnn-nnnnx">Indirect - (nn) (nn+X) (nn),Y (nnnn) (nnnn,X)</a></li>
    <li class="sidebar-header-2"><a href="#cpu-clock-cycles">CPU Clock Cycles</a></li>
    <li class="sidebar-header-3"><a href="#execution-legend">Execution Legend</a></li>
    <li class="sidebar-header-3"><a href="#implied-or-immediate-operands">Implied or Immediate Operands</a></li>
    <li class="sidebar-header-3"><a href="#memory-operands">Memory Operands</a></li>
    <li class="sidebar-header-3"><a href="#pushpulls">Push/Pulls</a></li>
    <li class="sidebar-header-3"><a href="#branches">Branches</a></li>
    <li class="sidebar-header-2"><a href="#cpu-memory-and-register-transfers">CPU Memory and Register Transfers</a></li>
    <li class="sidebar-header-3"><a href="#register-to-register-transfer">Register to Register Transfer</a></li>
    <li class="sidebar-header-3"><a href="#load-register-from-memory">Load Register from Memory</a></li>
    <li class="sidebar-header-3"><a href="#store-register-in-memory">Store Register in Memory</a></li>
    <li class="sidebar-header-3"><a href="#pushpull-stack">Push/Pull (Stack)</a></li>
    <li class="sidebar-header-2"><a href="#cpu-arithmeticlogical-operations">CPU Arithmetic/Logical Operations</a></li>
    <li class="sidebar-header-3"><a href="#alu-opcodes">ALU Opcodes</a></li>
    <li class="sidebar-header-3"><a href="#alu_types-operands-for-orandxoradcsbccmp-opcodes">alu_types (Operands for OR,AND,XOR,ADC,SBC,CMP Opcodes)</a></li>
    <li class="sidebar-header-3"><a href="#cpx_types-operands-for-cmp-opcodes-with-xy-operand">cpx_types (Operands for CMP Opcodes with X,Y Operand)</a></li>
    <li class="sidebar-header-3"><a href="#bit-test">Bit Test</a></li>
    <li class="sidebar-header-3"><a href="#increment-by-one">Increment by one</a></li>
    <li class="sidebar-header-3"><a href="#decrement-by-one">Decrement by one</a></li>
    <li class="sidebar-header-3"><a href="#tsbtrb-test-and-setreset">TSB/TRB (Test and Set/Reset)</a></li>
    <li class="sidebar-header-3"><a href="#bit-setreset">Bit Set/Reset</a></li>
    <li class="sidebar-header-2"><a href="#cpu-rotate-and-shift-instructions">CPU Rotate and Shift Instructions</a></li>
    <li class="sidebar-header-3"><a href="#logicalarithmetic-shift-left">Logical/Arithmetic Shift Left</a></li>
    <li class="sidebar-header-3"><a href="#logical-shift-right">Logical Shift Right</a></li>
    <li class="sidebar-header-3"><a href="#rotate-left-through-carry">Rotate Left through Carry</a></li>
    <li class="sidebar-header-3"><a href="#rotate-right-through-carry">Rotate Right through Carry</a></li>
    <li class="sidebar-header-2"><a href="#cpu-jump-and-control-instructions">CPU Jump and Control Instructions</a></li>
    <li class="sidebar-header-3"><a href="#normal-jumps">Normal Jumps</a></li>
    <li class="sidebar-header-3"><a href="#conditional-branches-branch-on-condition-to-pc-rr">Conditional Branches (Branch on condition to PC+/-rr)</a></li>
    <li class="sidebar-header-3"><a href="#interrupts-breakpoints">Interrupts, Breakpoints</a></li>
    <li class="sidebar-header-3"><a href="#cpu-control">CPU Control</a></li>
    <li class="sidebar-header-3"><a href="#special-opcodes">Special Opcodes</a></li>
    <li class="sidebar-header-3"><a href="#conditional-branch-page-crossing">Conditional Branch Page Crossing</a></li>
    <li class="sidebar-header-1"><a href="#aboutcredits">About/Credits</a></li>
    <li class="sidebar-header-3"><a href="#about-1">About</a></li>
    <li class="sidebar-header-3"><a href="#authors">Authors</a></li>
    <li class="sidebar-header-3"><a href="#credits">Credits</a></li>
    <li class="sidebar-header-3"><a href="#homepage">Homepage</a></li>
</ul>
  </nav>
  <div class="main-wrapper">
    <div class="main"><h1 id="emptyx16---x16-hardware-specs"><a class="header-link" href="#emptyx16---x16-hardware-specs"></a>Emptyx16 - X16 Hardware Specs</h1>
<p>nocash-style Commander X16 hardware specifications</p>
<h3 id="x16-hardware-specifications"><a class="header-link" href="#x16-hardware-specifications"></a>X16 Hardware Specifications</h3>
<p><a href="#x16-overview">X16 Overview</a><br><a href="#x16-io-map">X16 I/O Map</a><br><a href="#x16-memory">X16 Memory</a><br><a href="#x16-versatile-embedded-retro-adapter-vera">X16 Versatile Embedded Retro Adapter (VERA)</a><br><a href="#x16-peripherals">X16 Peripherals</a><br><a href="#x16-i2c-bus">X16 I2C Bus</a><br><a href="#x16-timings">X16 Timings</a><br><a href="#via-versatile-interface-adapter">VIA Versatile Interface Adapter</a><br><a href="#ym2151-fm-operator-type-m-opm">YM2151 FM Operator Type-M (OPM)</a><br><a href="#cpu-65c02-microprocessor">CPU 65C02 Microprocessor</a>  </p>
<h3 id="about"><a class="header-link" href="#about"></a>About</h3>
<p><a href="#aboutcredits">About/Credits</a></p>
<h1 id="x16-overview"><a class="header-link" href="#x16-overview"></a>X16 Overview</h1>
<h3 id="cpu"><a class="header-link" href="#cpu"></a>CPU</h3>
<pre class="hljs"><code><span class="hljs-attribute">CPU</span>         WDC <span class="hljs-number">65</span>C<span class="hljs-number">02</span> <span class="hljs-number">8</span>-bit CPU, <span class="hljs-number">8</span>.<span class="hljs-number">0</span>MHz</code></pre><h3 id="internal-memory"><a class="header-link" href="#internal-memory"></a>Internal Memory</h3>
<pre class="hljs"><code><span class="hljs-attribute">System</span> ROM  <span class="hljs-number">512</span> KiB
<span class="hljs-attribute">Fixed</span> RAM   <span class="hljs-number">39</span>.<span class="hljs-number">75</span> KiB
<span class="hljs-attribute">Banked</span> RAM  <span class="hljs-number">512</span> KiB (Installable up to <span class="hljs-number">2</span> MiB)
<span class="hljs-attribute">VERA</span> RAM    <span class="hljs-number">128</span> KiB
<span class="hljs-attribute">Audio</span> FIFO  <span class="hljs-number">4</span> KiB
<span class="hljs-attribute">RTC</span> NVRAM   <span class="hljs-number">64</span> bytes</code></pre><h3 id="video"><a class="header-link" href="#video"></a>Video</h3>
<pre class="hljs"><code><span class="hljs-attribute">Display</span>     <span class="hljs-number">640</span>x<span class="hljs-number">480</span> pixels with <span class="hljs-number">4096</span> colors
<span class="hljs-attribute">BG</span> layers   <span class="hljs-number">2</span> background layers
<span class="hljs-attribute">BG</span> types    Tile/map-based or bitmap-based
<span class="hljs-attribute">BG</span> colors   <span class="hljs-number">256</span> colors, or <span class="hljs-number">2</span>/<span class="hljs-number">4</span>/<span class="hljs-number">16</span> colors/<span class="hljs-number">16</span> palettes
<span class="hljs-attribute">OBJ</span> colors  <span class="hljs-number">256</span> colors, or <span class="hljs-number">16</span> colors/<span class="hljs-number">16</span> palettes
<span class="hljs-attribute">OBJ</span> size    <span class="hljs-number">16</span> types (in range of <span class="hljs-number">8</span>x<span class="hljs-number">8</span> up to <span class="hljs-number">64</span>x<span class="hljs-number">64</span>)
<span class="hljs-attribute">OBJs</span>/Screen max. <span class="hljs-number">128</span> OBJs of any size (up to <span class="hljs-number">64</span>x<span class="hljs-number">64</span> each)
<span class="hljs-attribute">OBJs</span>/Line   max. <span class="hljs-number">80</span> OBJs of <span class="hljs-number">8</span>x<span class="hljs-number">8</span> size (under best circumstances)</code></pre><h3 id="sound"><a class="header-link" href="#sound"></a>Sound</h3>
<pre class="hljs"><code><span class="hljs-attribute">VERA</span> PSG    <span class="hljs-number">16</span> channels, pulse/saw/triangle/noise
<span class="hljs-attribute">VERA</span> PCM    <span class="hljs-number">1</span> channel, <span class="hljs-number">8</span>/<span class="hljs-number">16</span>-bit mono/stereo PCM
<span class="hljs-attribute">YM2151</span>      <span class="hljs-number">8</span> channels, phase-modulated sine</code></pre><h3 id="interface-ports"><a class="header-link" href="#interface-ports"></a>Interface Ports</h3>
<pre class="hljs"><code>PS/<span class="hljs-number">2</span> port   Separate connector <span class="hljs-keyword">for</span> <span class="hljs-built_in">Keyboard</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">Mouse</span>
Joypad      <span class="hljs-number">2</span>x SNES controller ports
IEC         Commodore serial bus
Memory card <span class="hljs-built_in">SPI</span> mode MMC interface</code></pre><h1 id="x16-io-map"><a class="header-link" href="#x16-io-map"></a>X16 I/O Map</h1>
<h3 id="first-some-bytes"><a class="header-link" href="#first-some-bytes"></a>First some bytes</h3>
<pre class="hljs"><code><span class="hljs-number">0000</span><span class="hljs-built_in">h</span>        - Current RAM Bank (<span class="hljs-built_in">R</span>/W)
<span class="hljs-number">0001</span><span class="hljs-built_in">h</span>        - Current ROM Bank (<span class="hljs-built_in">R</span>/W)
<span class="hljs-number">0002</span><span class="hljs-built_in">h</span>..<span class="hljs-number">9</span>EFFh - Fixed RAM</code></pre><h3 id="via-versatile-interface-adapter-rw"><a class="header-link" href="#via-versatile-interface-adapter-rw"></a>VIA Versatile Interface Adapter (R/W)</h3>
<p>For below ports, x = Device number 0..1</p>
<pre class="hljs"><code><span class="hljs-attribute">9Fx0h</span> - PRB  - Port B Input/Output
<span class="hljs-attribute">9Fx1h</span> - PRA  - Port A Input/Output
<span class="hljs-attribute">9Fx2h</span> - DDRB - Port B Data Direction
<span class="hljs-attribute">9Fx3h</span> - DDRA - Port A Data Direction
<span class="hljs-attribute">9Fx4h</span> - T<span class="hljs-number">1</span>L  - T<span class="hljs-number">1</span> Counter (low <span class="hljs-number">8</span> bits)
<span class="hljs-attribute">9Fx5h</span> - T<span class="hljs-number">1</span>H  - T<span class="hljs-number">1</span> Counter (high <span class="hljs-number">8</span> bits)
<span class="hljs-attribute">9Fx6h</span> - T<span class="hljs-number">1</span>LL - T<span class="hljs-number">1</span> Latch (low <span class="hljs-number">8</span> bits)
<span class="hljs-attribute">9Fx7h</span> - T<span class="hljs-number">1</span>LH - T<span class="hljs-number">1</span> Latch (high <span class="hljs-number">8</span> bits)
<span class="hljs-attribute">9Fx8h</span> - T<span class="hljs-number">2</span>L  - T<span class="hljs-number">2</span> Counter (low <span class="hljs-number">8</span> bits)
<span class="hljs-attribute">9Fx9h</span> - T<span class="hljs-number">2</span>H  - T<span class="hljs-number">2</span> Counter (high <span class="hljs-number">8</span> bits)
<span class="hljs-attribute">9FxAh</span> - SR   - Shift Register
<span class="hljs-attribute">9FxBh</span> - ACR  - Auxiliary Control Register
<span class="hljs-attribute">9FxCh</span> - PCR  - Peripheral Control Register
<span class="hljs-attribute">9FxDh</span> - IFR  - Interrupt Flags Register
<span class="hljs-attribute">9FxEh</span> - IER  - Interrupt Enable Register
<span class="hljs-attribute">9FxFh</span> - PRA<span class="hljs-number">2</span> - Port A Input/Output Without Handshaking</code></pre><h3 id="vera-versatile-embedded-retro-adapter-rw"><a class="header-link" href="#vera-versatile-embedded-retro-adapter-rw"></a>VERA Versatile Embedded Retro Adapter (R/W)</h3>
<p>Note: The rightmost column shows the initial value on Reset</p>
<pre class="hljs"><code><span class="hljs-number">9F20h</span> - ADDR_L       - VRAM Address (lower <span class="hljs-number">8</span> <span class="hljs-meta">bits</span>)                    <span class="hljs-number">00h</span>
<span class="hljs-number">9F21h</span> - ADDR_M       - VRAM Address (middle <span class="hljs-number">8</span> <span class="hljs-meta">bits</span>)                   <span class="hljs-number">00h</span>
<span class="hljs-number">9F22h</span> - ADDR_H       - VRAM Address (upper <span class="hljs-number">1</span> bit) / Increment Mode    <span class="hljs-number">00h</span>
<span class="hljs-number">9F23h</span> - DATA0        - VRAM Data Port <span class="hljs-number">0</span>                               <span class="hljs-number">00h</span>
<span class="hljs-number">9F24h</span> - DATA1        - VRAM Data Port <span class="hljs-number">1</span>                               <span class="hljs-number">00h</span>
<span class="hljs-number">9F25h</span> - CTRL         - Control                                        <span class="hljs-number">00h</span>
<span class="hljs-number">9F26h</span> - IEN          - Interrupt Enable / Line Compare (upper <span class="hljs-number">1</span> bit)  <span class="hljs-number">00h</span>
<span class="hljs-number">9F27h</span> - ISR          - Interrupt / Status Register                    <span class="hljs-number">00h</span>
<span class="hljs-number">9F28h</span> - IRQLINE_L    - Interrupt Line Compare (lower <span class="hljs-number">8</span> <span class="hljs-meta">bits</span>)          <span class="hljs-number">00h</span>

        (DCSEL=<span class="hljs-number">0</span>)
<span class="hljs-number">9F29h</span> - DC_VIDEO     - Active Display Control                         <span class="hljs-number">00h</span>
<span class="hljs-number">9F2Ah</span> - DC_HSCALE    - Active Display H-Scale                         <span class="hljs-number">80h</span>
<span class="hljs-number">9F2Bh</span> - DC_VSCALE    - Active Display V-Scale                         <span class="hljs-number">80h</span>
<span class="hljs-number">9F2Ch</span> - DC_BORDER    - Border Color                                   <span class="hljs-number">00h</span>

        (DCSEL=<span class="hljs-number">1</span>)
<span class="hljs-number">9F29h</span> - DC_HSTART    - Active Display H-Start                         <span class="hljs-number">00h</span>
<span class="hljs-number">9F2Ah</span> - DC_HSTOP     - Active Display H-Stop                          <span class="hljs-number">A0h</span>
<span class="hljs-number">9F2Bh</span> - DC_VSTART    - Active Display V-Start                         <span class="hljs-number">00h</span>
<span class="hljs-number">9F2Ch</span> - DC_VSTOP     - Active Display V-Stop                          <span class="hljs-number">F0h</span>

<span class="hljs-number">9F2Dh</span> - L0_CONFIG    - L0 Mode <span class="hljs-keyword">and</span> Map Size                           <span class="hljs-number">00h</span>
<span class="hljs-number">9F2Eh</span> - L0_MAPBASE   - L0 Map Base                                    <span class="hljs-number">00h</span>
<span class="hljs-number">9F2Fh</span> - L0_TILEBASE  - L0 Tile Base <span class="hljs-keyword">and</span> Tile Size                     <span class="hljs-number">00h</span>
<span class="hljs-number">9F30h</span> - L0_HSCROLL_L - L0 H-Scroll (lower <span class="hljs-number">8</span> <span class="hljs-meta">bits</span>)                     <span class="hljs-number">00h</span>
<span class="hljs-number">9F31h</span> - L0_HSCROLL_H - L0 H-Scroll (upper <span class="hljs-number">4</span> <span class="hljs-meta">bits</span>) / Bitmap Color      <span class="hljs-number">00h</span>
<span class="hljs-number">9F32h</span> - L0_VSCROLL_L - L0 V-Scroll (lower <span class="hljs-number">8</span> <span class="hljs-meta">bits</span>)                     <span class="hljs-number">00h</span>
<span class="hljs-number">9F33h</span> - L0_VSCROLL_H - L0 V-Scroll (upper <span class="hljs-number">4</span> <span class="hljs-meta">bits</span>)                     <span class="hljs-number">00h</span>
<span class="hljs-number">9F34h</span> - L1_CONFIG    - L1 Mode <span class="hljs-keyword">and</span> Map Size                           <span class="hljs-number">00h</span>
<span class="hljs-number">9F35h</span> - L1_MAPBASE   - L1 Map Base                                    <span class="hljs-number">00h</span>
<span class="hljs-number">9F36h</span> - L1_TILEBASE  - L1 Tile Base <span class="hljs-keyword">and</span> Tile Size                     <span class="hljs-number">00h</span>
<span class="hljs-number">9F37h</span> - L1_HSCROLL_L - L1 H-Scroll (lower <span class="hljs-number">8</span> <span class="hljs-meta">bits</span>)                     <span class="hljs-number">00h</span>
<span class="hljs-number">9F38h</span> - L1_HSCROLL_H - L1 H-Scroll (upper <span class="hljs-number">4</span> <span class="hljs-meta">bits</span>) / Bitmap Color      <span class="hljs-number">00h</span>
<span class="hljs-number">9F39h</span> - L1_VSCROLL_L - L1 V-Scroll (lower <span class="hljs-number">8</span> <span class="hljs-meta">bits</span>)                     <span class="hljs-number">00h</span>
<span class="hljs-number">9F3Ah</span> - L1_VSCROLL_H - L1 V-Scroll (upper <span class="hljs-number">4</span> <span class="hljs-meta">bits</span>)                     <span class="hljs-number">00h</span>
<span class="hljs-number">9F3Bh</span> - AUDIO_CTRL   - Audio FIFO Control                             <span class="hljs-number">00h</span>
<span class="hljs-number">9F3Ch</span> - AUDIO_RATE   - Audio FIFO Sample Rate                         <span class="hljs-number">00h</span>
<span class="hljs-number">9F3Dh</span> - AUDIO_DATA   - Audio FIFO Data (W)                            -
<span class="hljs-number">9F3Eh</span> - SPI_DATA     - SPI Data                                       -
<span class="hljs-number">9F3Fh</span> - SPI_CTRL     - SPI Control                                    <span class="hljs-number">00h</span> (?)</code></pre><h3 id="ym2151-io-ports"><a class="header-link" href="#ym2151-io-ports"></a>YM2151 I/O Ports</h3>
<pre class="hljs"><code><span class="hljs-number">9</span>F<span class="hljs-number">40</span>h - Y<span class="hljs-name">M2151</span> Register Address <span class="hljs-comment">(W)</span>
<span class="hljs-number">9</span>F<span class="hljs-number">41</span>h - Y<span class="hljs-name">M2151</span> Register Data <span class="hljs-comment">(W)</span> / Status <span class="hljs-comment">(R)</span></code></pre><h3 id="further-memory"><a class="header-link" href="#further-memory"></a>Further Memory</h3>
<pre class="hljs"><code><span class="hljs-number">9F42h</span>..<span class="hljs-number">9F5Fh</span> - Reserved
<span class="hljs-number">9F60h</span>..<span class="hljs-number">9FFFh</span> - Expansion
<span class="hljs-number">A000h</span>..<span class="hljs-number">BFFFh</span> - Banked RAM
<span class="hljs-number">C000h</span>..<span class="hljs-number">FFFFh</span> - Banked System ROM</code></pre><h3 id="vera-registers-internal-to-vera-not-the-main-cpu"><a class="header-link" href="#vera-registers-internal-to-vera-not-the-main-cpu"></a>VERA Registers (internal to VERA, not the Main CPU)</h3>
<p><a href="#x16-vera-memory-and-io-map-vram">X16 VERA Memory and I/O Map (VRAM)</a>  </p>
<h1 id="x16-memory"><a class="header-link" href="#x16-memory"></a>X16 Memory</h1>
<p><a href="#x16-memory-map">X16 Memory Map</a><br><a href="#x16-memory-control">X16 Memory Control</a>  </p>
<h3 id="system-rom"><a class="header-link" href="#system-rom"></a>System ROM</h3>
<p>System ROM is mapped directly to the CPU bus. Only a 16 KiB bank window of it
is mapped at a time. Since the banking area also covers a CPU interrupt vectors
region (FFFAh-FFFFh) and not all System ROM banks has them. It&#39;s recommended to
disable interrupts when accessing outside bank 0 of the System ROM.</p>
<h3 id="fixed-and-banked-ram"><a class="header-link" href="#fixed-and-banked-ram"></a>Fixed and Banked RAM</h3>
<p>Fixed and Banked RAM are both mapped directly to the CPU bus. Fixed RAM has
more capacity on hardware but it was limited by memory mapping to 39.75 KiB.
For Banked RAM, only an 8 KiB bank window of it is mapped at a time.</p>
<h3 id="vera-memory"><a class="header-link" href="#vera-memory"></a>VERA Memory</h3>
<p>All of VERA memory isn&#39;t mapped to the CPU bus, and can be accessed only via
I/O ports. Unlike many older consoles that have this kind of access, it can be
accessed in any time, even if VERA is currently rendering to the screen.<br><a href="#x16-vera-memory-access">X16 VERA Memory Access</a></p>
<h3 id="audio-fifo-buffer"><a class="header-link" href="#audio-fifo-buffer"></a>Audio FIFO buffer</h3>
<p>Audio FIFO buffer isn&#39;t mapped to either CPU bus or VERA memory, and can be
accessed only via write-only I/O ports. The buffer is 4095 bytes in size (the
last byte is not used to prevent overflow).<br><a href="#x16-vera-audio-fifo">X16 VERA Audio FIFO</a></p>
<h3 id="rtc-nvram"><a class="header-link" href="#rtc-nvram"></a>RTC NVRAM</h3>
<p>This small 64 bytes memory comes with the on-board Real-Time Clock chip. It is
used to store data that needs to last across power cycles without the usage of
memory card since the System ROM is not writable from software. RTC NVRAM isn&#39;t
mapped to the CPU bus, and can be accessed only via I2C bus.<br><a href="#x16-i2c-bus-access">X16 I2C Bus Access</a></p>
<h2 id="x16-memory-map"><a class="header-link" href="#x16-memory-map"></a>X16 Memory Map</h2>
<p>The X16 uses a 16-bit address bus (0000h-FFFFh). In order to access more than
64 KiB, it has two 8-bit transparent latches to hold the current RAM bank and
ROM bank. These combined 24-bit addresses are then used to address banked RAM
and system ROM area in order.</p>
<h3 id="overall-memory-map"><a class="header-link" href="#overall-memory-map"></a>Overall Memory Map</h3>
<pre class="hljs"><code>Bank    Offset      Content
        <span class="hljs-number">0000h</span>-<span class="hljs-number">9EFFh</span> Fixed RAM
        <span class="hljs-number">9F00h</span>-<span class="hljs-number">9FFFh</span> I/O Area
<span class="hljs-number">00h</span>-<span class="hljs-number">FFh</span>:<span class="hljs-number">A000h</span>-<span class="hljs-number">BFFFh</span> Banked RAM (max <span class="hljs-number">2</span> MiB) (256x8K)
<span class="hljs-number">00h</span>-<span class="hljs-number">1Fh</span>:<span class="hljs-number">C000h</span>-<span class="hljs-number">FFFFh</span> System ROM (<span class="hljs-number">512</span> KiB) (32x16K)
<span class="hljs-number">20h</span>-<span class="hljs-number">FFh</span>:<span class="hljs-number">C000h</span>-<span class="hljs-number">FFFFh</span> Unused (mirrors of System ROM)</code></pre><p>Additional memory, not mapped to CPU address (accessible only via I/O):</p>
<pre class="hljs"><code><span class="hljs-selector-tag">VERA</span> <span class="hljs-selector-tag">Memory</span> (<span class="hljs-number">128</span> KiB)
<span class="hljs-selector-tag">Audio</span> <span class="hljs-selector-tag">FIFO</span>  (<span class="hljs-number">4</span> KiB)
<span class="hljs-selector-tag">RTC</span> <span class="hljs-selector-tag">NVRAM</span>   (<span class="hljs-number">64</span> bytes)</code></pre><p>For details on separate I/O ports and expansions, see:<br><a href="#x16-io-map">X16 I/O Map</a></p>
<h3 id="default-ram-usage"><a class="header-link" href="#default-ram-usage"></a>Default RAM Usage</h3>
<p>By default, the addresses at 0080h-03FFh and banked RAM bank 00h are reserved
for CPU Stack, System Interrupt Vectors and Variables. The remaining RAM is
free for whatever use.</p>
<h2 id="x16-memory-control"><a class="header-link" href="#x16-memory-control"></a>X16 Memory Control</h2>
<h3 id="0000h---current-ram-bank-rw"><a class="header-link" href="#0000h---current-ram-bank-rw"></a>0000h - Current RAM Bank (R/W)</h3>
<pre class="hljs"><code><span class="hljs-keyword">Bit
</span><span class="hljs-number">7</span><span class="hljs-number">-0</span>     <span class="hljs-keyword">Banked </span>RAM <span class="hljs-keyword">bank </span>number</code></pre><h3 id="0001h---current-rom-bank-rw"><a class="header-link" href="#0001h---current-rom-bank-rw"></a>0001h - Current ROM Bank (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">5</span>     Not used
<span class="hljs-attribute">4</span>-<span class="hljs-number">0</span>     System ROM bank number</code></pre><p>Note that the actual values of these two registers are external to the RAM and
can have different values on power-up. However, they are written by the system
on boot and become consistent at user program execution.</p>
<h2 id="x16-vera-memory-access"><a class="header-link" href="#x16-vera-memory-access"></a>X16 VERA Memory Access</h2>
<h3 id="9f20h---addr_l---vram-address-lower-8-bits-rw"><a class="header-link" href="#9f20h---addr_l---vram-address-lower-8-bits-rw"></a>9F20h - ADDR_L - VRAM Address (lower 8 bits) (R/W)</h3>
<h3 id="9f21h---addr_m---vram-address-middle-8-bits-rw"><a class="header-link" href="#9f21h---addr_m---vram-address-middle-8-bits-rw"></a>9F21h - ADDR_M - VRAM Address (middle 8 bits) (R/W)</h3>
<h3 id="9f22h---addr_h---vram-address-upper-1-bit-and-increment-mode-rw"><a class="header-link" href="#9f22h---addr_h---vram-address-upper-1-bit-and-increment-mode-rw"></a>9F22h - ADDR_H - VRAM Address (upper 1 bit) and Increment Mode (R/W)</h3>
<pre class="hljs"><code>Bit
7-4    <span class="hljs-built_in"> Address </span><span class="hljs-keyword">Step</span> Size (see below)
3      <span class="hljs-built_in"> Address </span><span class="hljs-keyword">Step</span> Direction (<span class="hljs-attribute">0</span>=Increment, <span class="hljs-attribute">1</span>=Decrement)
2-1     <span class="hljs-keyword">Not</span> Used
0       Upper 1 bit of VRAM Address</code></pre><p>Address Step Size:</p>
<pre class="hljs"><code><span class="hljs-attribute">0h</span>=0
<span class="hljs-attribute">1h</span>=1
<span class="hljs-attribute">2h</span>=2
<span class="hljs-attribute">3h</span>=4
<span class="hljs-attribute">4h</span>=8
<span class="hljs-attribute">5h</span>=16
<span class="hljs-attribute">6h</span>=32   <span class="hljs-attribute">Bh</span>=40
<span class="hljs-attribute">7h</span>=64   <span class="hljs-attribute">Ch</span>=80
<span class="hljs-attribute">8h</span>=128  <span class="hljs-attribute">Dh</span>=160
<span class="hljs-attribute">9h</span>=256  <span class="hljs-attribute">Eh</span>=320
<span class="hljs-attribute">Ah</span>=512  <span class="hljs-attribute">Fh</span>=640</code></pre><p>Sets or reads a 17-bit address for addressing the 128 KiB of VRAM via DATA0 or
DATA1. These registers are multiplexed for each port which is set by ADDRSEL
bit in CTRL. Address register contents are also updated after each step
occurred from reading/writing to their respective data port register. For
details about ADDRSEL bit, see:<br><a href="#x16-vera-control">X16 VERA Control</a></p>
<h3 id="9f23h---data0---vram-data-port-0-rw"><a class="header-link" href="#9f23h---data0---vram-data-port-0-rw"></a>9F23h - DATA0 - VRAM Data Port 0 (R/W)</h3>
<h3 id="9f24h---data1---vram-data-port-1-rw"><a class="header-link" href="#9f24h---data1---vram-data-port-1-rw"></a>9F24h - DATA1 - VRAM Data Port 1 (R/W)</h3>
<p>Simply reads or writes a byte at the set address in 9F20h-9F22h of their
respective ports, then steps the address once.</p>
<h3 id="memory-content"><a class="header-link" href="#memory-content"></a>Memory Content</h3>
<p><a href="#x16-vera-memory-and-io-map-vram">X16 VERA Memory and I/O Map (VRAM)</a>  </p>
<h2 id="x16-ym2151-access"><a class="header-link" href="#x16-ym2151-access"></a>X16 YM2151 Access</h2>
<p>Due to the chip&#39;s large address space and low pin count, its address and data
pins are multiplexed. Then, an address/data select pin is provided. X16
connects this pin to the lowest address pin as usual. Providing I/O ports to
the chip&#39;s registers.</p>
<p>For more information about this chip and its registers, see:<br><a href="#ym2151-fm-operator-type-m-opm">YM2151 FM Operator Type-M (OPM)</a>  </p>
<h3 id="9f40h---ym2151-register-address-w"><a class="header-link" href="#9f40h---ym2151-register-address-w"></a>9F40h - YM2151 Register Address (W)</h3>
<p>Sets the chip&#39;s register address.</p>
<h3 id="9f41h---ym2151-register-data-w--status-r"><a class="header-link" href="#9f41h---ym2151-register-data-w--status-r"></a>9F41h - YM2151 Register Data (W) / Status (R)</h3>
<p>Writes to the chip at the currently set register address. Writes here will not
do any address auto-steps. Reads from the chip will always return this status
byte no matter what the currently set register address is:</p>
<pre class="hljs"><code>Bit
7       Busy Flag (<span class="hljs-attribute">1</span>=Busy)
6-2     <span class="hljs-keyword">Not</span> Used
1       Timer B Overflow (<span class="hljs-attribute">0</span>=<span class="hljs-literal">No</span> Overflow, <span class="hljs-attribute">1</span>=Overflow)
0       Timer A Overflow (<span class="hljs-attribute">0</span>=<span class="hljs-literal">No</span> Overflow, <span class="hljs-attribute">1</span>=Overflow)</code></pre><p>Any successful writes to the register data will set a busy flag for 64 clock
cycles (about 144 CPU cycles since the chip runs slower), indicating that any
other writes shouldn&#39;t be done during this period. It&#39;s recommended to check
for the busy flag in a wait loop until it&#39;s cleared before writing. Setting
the register address won&#39;t set and isn&#39;t affected by this busy flag, however.</p>
<h1 id="x16-versatile-embedded-retro-adapter-vera"><a class="header-link" href="#x16-versatile-embedded-retro-adapter-vera"></a>X16 Versatile Embedded Retro Adapter (VERA)</h1>
<p><a href="#x16-vera-control">X16 VERA Control</a><br><a href="#x16-vera-display-composer">X16 VERA Display Composer</a><br><a href="#x16-vera-layer-control">X16 VERA Layer Control</a><br><a href="#x16-vera-layer-control">X16 VERA Interrupts</a><br><a href="#x16-vera-audio-fifo">X16 VERA Audio FIFO</a><br><a href="#x16-vera-memory-card-interface">X16 VERA Memory Card Interface</a>  </p>
<h3 id="embedded-memory"><a class="header-link" href="#embedded-memory"></a>Embedded Memory</h3>
<p><a href="#x16-vera-memory-and-io-map-vram">X16 VERA Memory and I/O Map (VRAM)</a><br><a href="#x16-vera-programmable-sound-generator-psg">X16 VERA Programmable Sound Generator (PSG)</a><br><a href="#x16-vera-color-palette">X16 VERA Color Palette</a><br><a href="#x16-vera-sprites-objs">X16 VERA Sprites (OBJs)</a><br>VERA memory isn&#39;t mapped to the CPU bus, and can be accessed only via I/O
ports.<br><a href="#x16-vera-memory-access">X16 VERA Memory Access</a></p>
<h2 id="x16-vera-control"><a class="header-link" href="#x16-vera-control"></a>X16 VERA Control</h2>
<h3 id="9f25h---ctrl---control-rw"><a class="header-link" href="#9f25h---ctrl---control-rw"></a>9F25h - CTRL - Control (R/W)</h3>
<pre class="hljs"><code><span class="hljs-type">Bit</span>
<span class="hljs-number">7</span>       <span class="hljs-keyword">Reset</span> Adapter (<span class="hljs-number">1</span>=<span class="hljs-keyword">Reset</span>)
<span class="hljs-number">6</span><span class="hljs-number">-2</span>     <span class="hljs-keyword">Not</span> Used
<span class="hljs-number">1</span>       Display Composer Register <span class="hljs-keyword">Select</span> (DCSEL)
<span class="hljs-number">0</span>       Address Port <span class="hljs-keyword">Select</span> (ADDRSEL)</code></pre><p>Writing reset bit to this register will reset the entire adapter&#39;s operation.
The main chip will reconfigure itself and initialize all registers.</p>
<p>DCSEL selects which Display Composer register to access in location
9F29h-9F2Ch. ADDRSEL selects which port to read/write address when accessing
VERA memory from the CPU. For more information, see their respective entries:<br><a href="#x16-vera-display-composer">X16 VERA Display Composer</a><br><a href="#x16-vera-memory-access">X16 VERA Memory Access</a></p>
<h2 id="x16-vera-display-composer"><a class="header-link" href="#x16-vera-display-composer"></a>X16 VERA Display Composer</h2>
<h3 id="9f29h-dcsel0---dc_video---active-display-control-rw"><a class="header-link" href="#9f29h-dcsel0---dc_video---active-display-control-rw"></a>9F29h (DCSEL=0) - DC_VIDEO - Active Display Control (R/W)</h3>
<pre class="hljs"><code>Bit
7       Current Interlace Frame (<span class="hljs-attribute">0</span>=Even, <span class="hljs-attribute">1</span>=Odd Frame) (Read-only)
6       Sprites (<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
5       Layer 1 (<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
4       Layer 0 (<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
3       <span class="hljs-keyword">Not</span> Used
2       Chroma Output (<span class="hljs-literal">no</span> effect <span class="hljs-keyword">in</span> RGB) (<span class="hljs-attribute">0</span>=Enable, <span class="hljs-attribute">1</span>=Disable)
1-0     Output Mode
          0 = <span class="hljs-literal">No</span> Video
          1 = Progressive RGB
          2 = Interlaced Luma/Chroma
          3 = Interlaced RGB</code></pre><p>VERA natively outputs in a progressive RGB format with a line rate of 31.5 kHz.
Which the system also boots in that mode. It is also capable of outputting at
half a line rate of 15.75 kHz with interlacing. However, it comes with a
trade-off that every other lines will not be rendered at all. Also, interlaced
mode has different video timings compared to progressive mode.</p>
<p>Luma/Chroma output can only be output in interlaced mode. The adapter also has
a hardware to modulate Luma/Chroma signals into NTSC composite video. However,
most NTSC CRT TVs can only display around the middle 592x448 region. So, this
overscan should be taken into account when using composite output.</p>
<h3 id="9f2ah-dcsel0---dc_hscale---active-display-h-scale-rw"><a class="header-link" href="#9f2ah-dcsel0---dc_hscale---active-display-h-scale-rw"></a>9F2Ah (DCSEL=0) - DC_HSCALE - Active Display H-Scale (R/W)</h3>
<h3 id="9f2bh-dcsel0---dc_vscale---active-display-v-scale-rw"><a class="header-link" href="#9f2bh-dcsel0---dc_vscale---active-display-v-scale-rw"></a>9F2Bh (DCSEL=0) - DC_VSCALE - Active Display V-Scale (R/W)</h3>
<p>Scales the entire rendering output by a factor of 128/x. A value of 80h means
no scaling. This is mainly used for displaying low resolution graphics.</p>
<p>Scaling is probably done by adding this fractional H-Scale value each drawn
pixel and V-Scale value each drawn line to the virtual screen position. Then
the integer part of this virtual screen position is then used for the rest of
the composition logic. This puts the scaling center at the top-left corner of
an active display area.</p>
<p>NOTE: Setting H-Scale or V-Scale above 1.0 (80h) will skip some pixels while
rendering, potentially causing inaccurate collision detection (?)</p>
<h3 id="9f2ch-dcsel0---dc_border---border-color-rw"><a class="header-link" href="#9f2ch-dcsel0---dc_border---border-color-rw"></a>9F2Ch (DCSEL=0) - DC_BORDER - Border Color (R/W)</h3>
<p>When the drawing pixel is outside the active display area defined by start and
stop registers, it will be set to a solid color at the index of this register&#39;s
value in the palette memory. Please note that this is different from a backdrop
color which is always color index 0.</p>
<h3 id="9f29h-dcsel1---dc_hstart---active-display-h-start-rw"><a class="header-link" href="#9f29h-dcsel1---dc_hstart---active-display-h-start-rw"></a>9F29h (DCSEL=1) - DC_HSTART - Active Display H-Start (R/W)</h3>
<h3 id="9f2bh-dcsel1---dc_vstart---active-display-v-start-rw"><a class="header-link" href="#9f2bh-dcsel1---dc_vstart---active-display-v-start-rw"></a>9F2Bh (DCSEL=1) - DC_VSTART - Active Display V-Start (R/W)</h3>
<p>Sets the starting point of an active display area in native display
coordinates. Horizontal value is in steps of 4 and vertical value is in steps
of 2. The virtual screen will always start from this point.</p>
<h3 id="9f2ah-dcsel1---dc_hstop---active-display-h-stop-rw"><a class="header-link" href="#9f2ah-dcsel1---dc_hstop---active-display-h-stop-rw"></a>9F2Ah (DCSEL=1) - DC_HSTOP - Active Display H-Stop (R/W)</h3>
<h3 id="9f2ch-dcsel1---dc_vstop---active-display-v-stop-rw"><a class="header-link" href="#9f2ch-dcsel1---dc_vstop---active-display-v-stop-rw"></a>9F2Ch (DCSEL=1) - DC_VSTOP - Active Display V-Stop (R/W)</h3>
<p>Sets the stopping point of an active display area in native display
coordinates (they are not scaled to the DC_xSCALE values). Horizontal value is
in steps of 4 and vertical value is in steps of 2. The stopping point is not
inclusive.</p>
<p>These four register values are analogous to a display window in many consoles.
The width of an active display is <code>(DC_HSTOP-DC_HSTART)*4</code> pixels and the height
of an active display is <code>(DC_VSTOP-DC_VSTART)*2</code> pixels. For example, a screen
that starts at (64,50) with an active display size of 320x200 pixels will
have 9F29h-9F2Ch values of 10h, 19h, 60h, 7Dh in order.</p>
<h2 id="x16-vera-layer-control"><a class="header-link" href="#x16-vera-layer-control"></a>X16 VERA Layer Control</h2>
<h3 id="9f2dh---l0_config---l0-mode-and-map-size-rw"><a class="header-link" href="#9f2dh---l0_config---l0-mode-and-map-size-rw"></a>9F2Dh - L0_CONFIG - L0 Mode and Map Size (R/W)</h3>
<h3 id="9f34h---l1_config---l1-mode-and-map-size-rw"><a class="header-link" href="#9f34h---l1_config---l1-mode-and-map-size-rw"></a>9F34h - L1_CONFIG - L1 Mode and Map Size (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">6</span>     Map Height (<span class="hljs-number">0</span>=<span class="hljs-number">32</span>, <span class="hljs-number">1</span>=<span class="hljs-number">64</span>, <span class="hljs-number">2</span>=<span class="hljs-number">128</span>, <span class="hljs-number">3</span>=<span class="hljs-number">256</span> tiles)
<span class="hljs-attribute">5</span>-<span class="hljs-number">4</span>     Map Width (<span class="hljs-number">0</span>=<span class="hljs-number">32</span>, <span class="hljs-number">1</span>=<span class="hljs-number">64</span>, <span class="hljs-number">2</span>=<span class="hljs-number">128</span>, <span class="hljs-number">3</span>=<span class="hljs-number">256</span> tiles)
<span class="hljs-attribute">3</span>       <span class="hljs-number">1</span>bpp Tile Mode Color (<span class="hljs-number">0</span>=<span class="hljs-number">16</span>FG/<span class="hljs-number">16</span>BG, <span class="hljs-number">1</span>=<span class="hljs-number">256</span>FG/<span class="hljs-number">1</span>BG)
<span class="hljs-attribute">2</span>       Tile/Bitmap Mode (<span class="hljs-number">0</span>=Tile Mode, <span class="hljs-number">1</span>=Bitmap Mode)
<span class="hljs-attribute">1</span>-<span class="hljs-number">0</span>     Color Depth (<span class="hljs-number">0</span>=<span class="hljs-number">1</span>bpp, <span class="hljs-number">1</span>=<span class="hljs-number">2</span>bpp, <span class="hljs-number">2</span>=<span class="hljs-number">4</span>bpp, <span class="hljs-number">3</span>=<span class="hljs-number">8</span>bpp)</code></pre><p>1bpp Tile Mode Color (bit 3) setting is valid only if the layer is set to that
mode (bits 0-2 are all zero). The map will wrap around if the screen draws
beyond its width or height.</p>
<h3 id="9f2eh---l0_mapbase---l0-map-base-rw"><a class="header-link" href="#9f2eh---l0_mapbase---l0-map-base-rw"></a>9F2Eh - L0_MAPBASE - L0 Map Base (R/W)</h3>
<h3 id="9f35h---l1_mapbase---l1-map-base-rw"><a class="header-link" href="#9f35h---l1_mapbase---l1-map-base-rw"></a>9F35h - L1_MAPBASE - L1 Map Base (R/W)</h3>
<p>Specifies the map base address in 512-byte steps. In bitmap mode, this has no
effect.</p>
<h3 id="9f2fh---l0_tilebase---l0-tile-base-and-tile-size-rw"><a class="header-link" href="#9f2fh---l0_tilebase---l0-tile-base-and-tile-size-rw"></a>9F2Fh - L0_TILEBASE - L0 Tile Base and Tile Size (R/W)</h3>
<h3 id="9f36h---l1_tilebase---l1-tile-base-and-tile-size-rw"><a class="header-link" href="#9f36h---l1_tilebase---l1-tile-base-and-tile-size-rw"></a>9F36h - L1_TILEBASE - L1 Tile Base and Tile Size (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">2</span>     Tile / Bitmap Base Address in VRAM (in <span class="hljs-number">2</span>-KiB steps)
<span class="hljs-attribute">1</span>       Tile Height (<span class="hljs-number">0</span>=<span class="hljs-number">8</span>, <span class="hljs-number">1</span>=<span class="hljs-number">16</span> pixels)
<span class="hljs-attribute">0</span>       Tile Width (<span class="hljs-number">0</span>=<span class="hljs-number">8</span>, <span class="hljs-number">1</span>=<span class="hljs-number">16</span> pixels) / Bitmap Width (<span class="hljs-number">0</span>=<span class="hljs-number">320</span>, <span class="hljs-number">1</span>=<span class="hljs-number">640</span> pixels)</code></pre><h3 id="9f30h9f31h---l0_hscroll_ll0_hscroll_h---l0-horizontal-scroll-rw"><a class="header-link" href="#9f30h9f31h---l0_hscroll_ll0_hscroll_h---l0-horizontal-scroll-rw"></a>9F30h/9F31h - L0_HSCROLL_L/L0_HSCROLL_H - L0 Horizontal Scroll (R/W)</h3>
<h3 id="9f37h9f38h---l1_hscroll_ll1_hscroll_h---l1-horizontal-scroll-rw"><a class="header-link" href="#9f37h9f38h---l1_hscroll_ll1_hscroll_h---l1-horizontal-scroll-rw"></a>9F37h/9F38h - L1_HSCROLL_L/L1_HSCROLL_H - L1 Horizontal Scroll (R/W)</h3>
<pre class="hljs"><code><span class="hljs-variable">Bit</span>
<span class="hljs-number">15</span><span class="hljs-operator">-</span><span class="hljs-number">12</span>   <span class="hljs-built_in">Not</span> <span class="hljs-variable">Used</span>
<span class="hljs-number">11</span><span class="hljs-operator">-</span><span class="hljs-number">0</span>    <span class="hljs-built_in">Horizontal</span> <span class="hljs-variable">Scroll</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Tile</span> <span class="hljs-built_in">Mode</span><span class="hljs-punctuation">)</span>
<span class="hljs-number">11</span><span class="hljs-operator">-</span><span class="hljs-number">8</span>    <span class="hljs-variable">Palette</span> <span class="hljs-built_in">Number</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Bitmap</span> <span class="hljs-built_in">Mode</span><span class="hljs-punctuation">)</span></code></pre><p>In bitmap mode, horizontal scroll has no effect.</p>
<h3 id="9f32h9f33h---l0_vscroll_ll0_vscroll_h---l0-vertical-scroll-rw"><a class="header-link" href="#9f32h9f33h---l0_vscroll_ll0_vscroll_h---l0-vertical-scroll-rw"></a>9F32h/9F33h - L0_VSCROLL_L/L0_VSCROLL_H - L0 Vertical Scroll (R/W)</h3>
<h3 id="9f39h9f3ah---l1_vscroll_ll1_vscroll_h---l1-vertical-scroll-rw"><a class="header-link" href="#9f39h9f3ah---l1_vscroll_ll1_vscroll_h---l1-vertical-scroll-rw"></a>9F39h/9F3Ah - L1_VSCROLL_L/L1_VSCROLL_H - L1 Vertical Scroll (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">15</span>-<span class="hljs-number">12</span>   Not Used
<span class="hljs-attribute">11</span>-<span class="hljs-number">0</span>    Vertical Scroll</code></pre><p>In bitmap mode, this has no effect.</p>
<h2 id="x16-vera-interrupts"><a class="header-link" href="#x16-vera-interrupts"></a>X16 VERA Interrupts</h2>
<h3 id="9f26h---ien---interrupt-enable--line-compare-upper-1-bit-rw"><a class="header-link" href="#9f26h---ien---interrupt-enable--line-compare-upper-1-bit-rw"></a>9F26h - IEN - Interrupt Enable / Line Compare (upper 1 bit) (R/W)</h3>
<pre class="hljs"><code>Bit
7       Interrupt Line Compare (upper 1 bit)
6-4     <span class="hljs-keyword">Not</span> Used
3       FIFO Low<span class="hljs-built_in"> IRQ </span>(<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
2       Sprite Collide<span class="hljs-built_in"> IRQ </span>(<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
1       Line<span class="hljs-built_in"> IRQ </span>(<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
0       VBlank<span class="hljs-built_in"> IRQ </span>(<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)</code></pre><p>For details about Line Compare bit, see IRQLINE_L (9F28h) entry.</p>
<h3 id="9f27h---isr---interrupt--status-register-rw"><a class="header-link" href="#9f27h---isr---interrupt--status-register-rw"></a>9F27h - ISR - Interrupt / Status Register (R/W)</h3>
<pre class="hljs"><code>Bit
7-4     Sprite Collisions (Read-only)
3       FIFO Low<span class="hljs-built_in"> IRQ </span>Flag (<span class="hljs-attribute">0</span>=None, <span class="hljs-attribute">1</span>=Interrupt Request) (Read-only)
2       Sprite Collide<span class="hljs-built_in"> IRQ </span>Flag (<span class="hljs-attribute">0</span>=None, <span class="hljs-attribute">1</span>=Interrupt Request)
1       Line<span class="hljs-built_in"> IRQ </span>Flag (<span class="hljs-attribute">0</span>=None, <span class="hljs-attribute">1</span>=Interrupt Request)
0       VBlank<span class="hljs-built_in"> IRQ </span>Flag (<span class="hljs-attribute">0</span>=None, <span class="hljs-attribute">1</span>=Interrupt Request)</code></pre><p>FIFO Low IRQ is generated once the buffer is less than 1024 bytes in size and
its flags remain set until the buffer is larger than or equal to 1024 bytes.</p>
<p>Sprite Collide IRQ is generated at VBlank when a sprite collision occurs. Its
flags and Sprite Collisions field remain set until the next VBlank. For details
about sprite collision bits, see:<br><a href="#x16-vera-sprites-objs">X16 VERA Sprites (OBJs)</a></p>
<p>Line IRQ is generated at the beginning of the display line that matches the
line compare value. Its flags are not automatically cleared.</p>
<p>VBlank IRQ is generated at the beginning of VBlank period (the line after the
last display line). Its flags are not automatically cleared.</p>
<p>All of the 4 flags get set even if their respective interrupts are disabled.
Writing a bit 1 to one of the bits 0-2 will clear that interrupt status.</p>
<h3 id="9f28h---irqline_l---interrupt-line-compare-lower-8-bits-rw"><a class="header-link" href="#9f28h---irqline_l---interrupt-line-compare-lower-8-bits-rw"></a>9F28h - IRQLINE_L - Interrupt Line Compare (lower 8 bits) (R/W)</h3>
<p>Specifies the <em>display</em> line number to generate IRQ at. It is neither scaled
with the DC_VSCALE register nor offset with the DC_VSTART register. In
interlaced mode, bit 0 is ignored and will generate IRQ in both two frames even
if that line is skipped in either field of the display. Line comparison is only
done on drawing lines which means a value higher than 479 will never generate
Line IRQs.</p>
<h2 id="x16-vera-audio-fifo"><a class="header-link" href="#x16-vera-audio-fifo"></a>X16 VERA Audio FIFO</h2>
<h3 id="9f3bh---audio_ctrl---audio-fifo-control-rw"><a class="header-link" href="#9f3bh---audio_ctrl---audio-fifo-control-rw"></a>9F3Bh - AUDIO_CTRL - Audio FIFO Control (R/W)</h3>
<pre class="hljs"><code>Bit
7       FIFO Full (R) / FIFO Reset (<span class="hljs-attribute">1</span>=Reset) (W)
6       <span class="hljs-keyword">Not</span> Used
5       FIFO Sample Size (<span class="hljs-attribute">0</span>=8-bit, <span class="hljs-attribute">1</span>=16-bit)
4       FIFO Sample Channels (<span class="hljs-attribute">0</span>=Mono, <span class="hljs-attribute">1</span>=Stereo)
3-0     FIFO Output Volume (<span class="hljs-attribute">0</span>=Silent, <span class="hljs-attribute">15</span>=Loudest)</code></pre><p>Writing reset bit to this register will empty the current buffer. The output
volume is not linear and has the meaning as follows:</p>
<pre class="hljs"><code><span class="hljs-attribute">0h</span>=0    <span class="hljs-attribute">2h</span>=2    <span class="hljs-attribute">4h</span>=4    <span class="hljs-attribute">6h</span>=6    <span class="hljs-attribute">8h</span>=11   <span class="hljs-attribute">Ah</span>=18   <span class="hljs-attribute">Ch</span>=30   <span class="hljs-attribute">Eh</span>=49
<span class="hljs-attribute">1h</span>=1    <span class="hljs-attribute">3h</span>=3    <span class="hljs-attribute">5h</span>=5    <span class="hljs-attribute">7h</span>=8    <span class="hljs-attribute">9h</span>=14   <span class="hljs-attribute">Bh</span>=23   <span class="hljs-attribute">Dh</span>=38   <span class="hljs-attribute">Fh</span>=64</code></pre><p>NOTE: All values can be approximated as 2 dB steps. Volume values are taken
from the official emulator source code and are not confirmed on real hardware
(?)</p>
<h3 id="9f3ch---audio_rate---audio-fifo-sample-rate-rw"><a class="header-link" href="#9f3ch---audio_rate---audio-fifo-sample-rate-rw"></a>9F3Ch - AUDIO_RATE - Audio FIFO Sample Rate (R/W)</h3>
<p>Specifies the playback rate of the FIFO in <code>25000*n/65536</code> KHz.
A value of 0 or anything greater than 128 will stop playback.</p>
<h3 id="9f3dh---audio_data---audio-fifo-data-w"><a class="header-link" href="#9f3dh---audio_data---audio-fifo-data-w"></a>9F3Dh - AUDIO_DATA - Audio FIFO Data (W)</h3>
<p>Writes one byte to the FIFO and increases the current buffer size by one. Any
writes will be ignored if the current buffer size is over 4095 bytes
(indicated by bit 7 in AUDIO_CTRL). The data needs to be written depends on the
current bit 4-5 setting in AUDIO_CTRL as follows:</p>
<pre class="hljs"><code>AUDIO_CTRL      Data Format
<span class="hljs-number">8</span>-<span class="hljs-built_in">bit</span> Mono      [<span class="hljs-built_in">Signed</span> <span class="hljs-number">7</span>:<span class="hljs-number">0</span>]
<span class="hljs-number">8</span>-<span class="hljs-built_in">bit</span> Stereo    [<span class="hljs-built_in">Signed</span> Left <span class="hljs-number">7</span>:<span class="hljs-number">0</span>] [<span class="hljs-built_in">Signed</span> Right <span class="hljs-number">7</span>:<span class="hljs-number">0</span>]
<span class="hljs-number">16</span>-<span class="hljs-built_in">bit</span> Mono     [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] [<span class="hljs-built_in">Signed</span> <span class="hljs-number">15</span>:<span class="hljs-number">8</span>]
<span class="hljs-number">16</span>-<span class="hljs-built_in">bit</span> Stereo   [Left <span class="hljs-number">7</span>:<span class="hljs-number">0</span>] [<span class="hljs-built_in">Signed</span> Left <span class="hljs-number">15</span>:<span class="hljs-number">8</span>] [Right <span class="hljs-number">7</span>:<span class="hljs-number">0</span>] [<span class="hljs-built_in">Signed</span> Right <span class="hljs-number">15</span>:<span class="hljs-number">8</span>]</code></pre><p>When the FIFO is active, it will regularly retrieve the oldest sample in the
buffer as the name implies (First In, First Out), at a rate defined in
AUDIO_RATE register. And then decreases the buffer size. Once the buffer size
is lower than 1024 bytes it will generate FIFO Low IRQ if it&#39;s enabled and set
its flag until the buffer size is higher than or equal to 1024 bytes.</p>
<h2 id="x16-vera-memory-card-interface"><a class="header-link" href="#x16-vera-memory-card-interface"></a>X16 VERA Memory Card Interface</h2>
<p>VERA uses an SPI bus, which is a 4-wire serial bus to communicate and transfer
data with the memory card. It uses SPI Mode 0 (?) for clock and data signals.
Its interface is quite bare and can be adapted to any SPI device. This is the
only interface with automatic clocking and transfer in X16.</p>
<h3 id="9f3eh---spi_data---spi-data-rw"><a class="header-link" href="#9f3eh---spi_data---spi-data-rw"></a>9F3Eh - SPI_DATA - SPI Data (R/W)</h3>
<p>Reads from this register returns the last received byte. Writes to this
register will start transferring one byte of written data to the device and
receiving one byte of data from the device at the same time. The busy flag in
SPI_CTRL is set during the transfer period. Once the transfer completes, the
busy flag is cleared and the new received byte is latched to this register.
Since the VERA is on the controller side and due to how SPI works, it&#39;s usually
required to write to this register many times to shift out dummy clocks until
the desired data from the device is received and latched.</p>
<h3 id="9f3fh---spi_ctrl---spi-control-rw"><a class="header-link" href="#9f3fh---spi_ctrl---spi-control-rw"></a>9F3Fh - SPI_CTRL - SPI Control (R/W)</h3>
<pre class="hljs"><code>Bit
7       Busy Flag (<span class="hljs-attribute">1</span>=Busy) (Read-only)
6-4     <span class="hljs-keyword">Not</span> Used
3       Auto Transfer (<span class="hljs-attribute">0</span>=Off, <span class="hljs-attribute">1</span>=On) (undocumented)
2       <span class="hljs-keyword">Not</span> Used
1       Shift<span class="hljs-built_in"> Clock </span>Speed (<span class="hljs-attribute">0</span>=12.5MHz, <span class="hljs-attribute">1</span>=391KHz)
0       Chip Select (<span class="hljs-attribute">0</span>=Release, <span class="hljs-attribute">1</span>=Select)</code></pre><p>A shift clock speed of 391KHz was implemented because some memory cards require
it to be lower than 400KHz during an initialization process. A chip select is
required in order to activate the memory card.</p>
<p>When Auto Transfer is on, any reads from SPI_DATA will also transfer FFh to the
device and receive one byte of data from it at the same time.</p>
<h3 id="memory-card-commands"><a class="header-link" href="#memory-card-commands"></a>Memory Card Commands</h3>
<p>The memory card takes a 6-byte command and arguments as shown below:</p>
<pre class="hljs"><code><span class="hljs-attribute">Byte</span> <span class="hljs-number">0</span>
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">7</span>     Start Bit, always <span class="hljs-number">0</span>
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">6</span>     Transmission Bit, always <span class="hljs-number">1</span>
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">5</span>-<span class="hljs-number">0</span>   Command Index
<span class="hljs-attribute">Byte</span> <span class="hljs-number">1</span>-<span class="hljs-number">4</span>    Command Argument
<span class="hljs-attribute">Byte</span> <span class="hljs-number">5</span>
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">7</span>-<span class="hljs-number">1</span>   CRC-<span class="hljs-number">7</span> (<span class="hljs-number">09</span>h Polynomial)
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">0</span>     Stop Bit, always <span class="hljs-number">1</span></code></pre><p>NOTE: SPI mode disables all CRCs by default. However, commands 00h and 08h are
of native mode and still requires it.</p>
<p>The below is a partial list of commands that are usually used for basic card
initialization and data transfer, all reserved bits should always be 0:</p>
<pre class="hljs"><code><span class="hljs-attribute">Command</span> Arguments (Big Endian)  Resp.   Explanation
<span class="hljs-attribute">00h</span>     <span class="hljs-number">31</span>-<span class="hljs-number">0</span>  Stuff             R<span class="hljs-number">1</span>      Reset the memory card to idle state
<span class="hljs-attribute">01h</span>     <span class="hljs-number">31</span>-<span class="hljs-number">0</span>  Stuff             R<span class="hljs-number">1</span>      Initialize the memory card (MMC only)
<span class="hljs-attribute">08h</span>     <span class="hljs-number">31</span>-<span class="hljs-number">12</span> Reserved          R<span class="hljs-number">7</span>      Check voltage range (added later in
        <span class="hljs-attribute">11</span>-<span class="hljs-number">8</span>  Supply Voltage            SD v<span class="hljs-number">2</span> spec, used to detect newer cards)
         <span class="hljs-attribute">7</span>-<span class="hljs-number">0</span>  Check Pattern     
<span class="hljs-attribute">0Ch</span>     <span class="hljs-number">31</span>-<span class="hljs-number">0</span>  Stuff             R<span class="hljs-number">1</span>b     Force the memory card to stop
                                        <span class="hljs-attribute">transmission</span> in Read Multiple Blocks
                                        <span class="hljs-attribute">operation</span>.
<span class="hljs-attribute">0Dh</span>     <span class="hljs-number">31</span>-<span class="hljs-number">0</span>  Stuff             R<span class="hljs-number">2</span>      Read the status register
<span class="hljs-attribute">10h</span>     <span class="hljs-number">31</span>-<span class="hljs-number">0</span>  Block Length      R<span class="hljs-number">1</span>      Set block length (always fixed to <span class="hljs-number">512</span>
                                        <span class="hljs-attribute">bytes</span> in SDHC/SDXC)
<span class="hljs-attribute">11h</span>     <span class="hljs-number">31</span>-<span class="hljs-number">0</span>  Data Address*     R<span class="hljs-number">1</span>      Read a block of data
<span class="hljs-attribute">12h</span>     <span class="hljs-number">31</span>-<span class="hljs-number">0</span>  Data Address*     R<span class="hljs-number">1</span>      Read multiple blocks until stop command
<span class="hljs-attribute">18h</span>     <span class="hljs-number">31</span>-<span class="hljs-number">0</span>  Data Address*     R<span class="hljs-number">1</span>      Write a block of data
<span class="hljs-attribute">19h</span>     <span class="hljs-number">31</span>-<span class="hljs-number">0</span>  Data Address*     R<span class="hljs-number">1</span>      Write multiple blocks until stop token
<span class="hljs-attribute">37h</span>     <span class="hljs-number">31</span>-<span class="hljs-number">0</span>  Stuff             R<span class="hljs-number">1</span>      Tell the memory card that the next
                                        <span class="hljs-attribute">command</span> is an application(SD)-specific
                                        <span class="hljs-attribute">command</span>. Used in next two commands:
<span class="hljs-attribute">37h</span> <span class="hljs-number">17</span>h <span class="hljs-number">31</span>-<span class="hljs-number">23</span> Stuff             R<span class="hljs-number">1</span>      Set the number of write blocks to be
        <span class="hljs-attribute">22</span>-<span class="hljs-number">0</span>  Number of Blocks          pre-erased before writing for faster
                                        <span class="hljs-attribute">Write</span> Multiple Blocks operation
<span class="hljs-attribute">37h</span> <span class="hljs-number">29</span>h <span class="hljs-number">31</span>    Reserved          R<span class="hljs-number">1</span>      Send host capacity support information
        <span class="hljs-attribute">30</span>    Host Capacity             (<span class="hljs-number">0</span>=SDSC, <span class="hljs-number">1</span>=SDHC/SDXC) and initialize
        <span class="hljs-attribute">29</span>-<span class="hljs-number">0</span>  Reserved                  the memory card
<span class="hljs-attribute">3Ah</span>     <span class="hljs-number">31</span>-<span class="hljs-number">0</span>  Stuff             R<span class="hljs-number">3</span>      Reads the OCR register (see below)
<span class="hljs-attribute">3Bh</span>     <span class="hljs-number">31</span>-<span class="hljs-number">1</span>  Stuff
        <span class="hljs-attribute">0</span>     CRC (<span class="hljs-number">0</span>=<span class="hljs-literal">Off</span>, <span class="hljs-number">1</span>=<span class="hljs-literal">On</span>) R<span class="hljs-number">1</span>      Turns CRC <span class="hljs-literal">on</span> or <span class="hljs-literal">off</span></code></pre><p><small>* In bytes for MMC/SDSC, in 512-byte blocks for SDHC/SDXC</small></p>
<p>When a command is sent, after certain delay bytes (write to 9F3Eh until read
isn&#39;t FFh), the memory card will send response bits back. The format depends on
the command as described in the above table. Response R1b is response R1 with
optional trailing busy signal where the memory card pulls the data line low
(reads are not FFh like on release). Bytes in all tables below are big endian.</p>
<p>Response R1</p>
<pre class="hljs"><code>Bit
7       Always 0
6       Parameter <span class="hljs-builtin-name">Error</span>
5      <span class="hljs-built_in"> Address </span><span class="hljs-builtin-name">Error</span>
4       Erase Sequence <span class="hljs-builtin-name">Error</span>
3       CRC <span class="hljs-builtin-name">Error</span>
2       Illegal Command
1       Erase Reset
0       <span class="hljs-keyword">In</span> Idle State</code></pre><p>Response R2 (Status Register)</p>
<pre class="hljs"><code><span class="hljs-variable">Bit</span>
<span class="hljs-number">15</span><span class="hljs-operator">-</span><span class="hljs-number">8</span>    <span class="hljs-variable">Same</span> <span class="hljs-variable">as</span> <span class="hljs-variable">R1</span>
<span class="hljs-number">7</span>       <span class="hljs-built_in">Out</span> <span class="hljs-variable">of</span> <span class="hljs-built_in">Range</span><span class="hljs-operator">/</span><span class="hljs-variable">CSD</span> <span class="hljs-variable">overwrite</span>
<span class="hljs-number">6</span>       <span class="hljs-variable">Erase</span> <span class="hljs-built_in">Parameter</span>
<span class="hljs-number">5</span>       <span class="hljs-built_in">Write</span> <span class="hljs-built_in">Protect</span> <span class="hljs-variable">Violation</span>
<span class="hljs-number">4</span>       <span class="hljs-variable">Card</span> <span class="hljs-variable">ECC</span> <span class="hljs-variable">failed</span>
<span class="hljs-number">3</span>       <span class="hljs-variable">Card</span> <span class="hljs-variable">Controller</span> <span class="hljs-variable">Error</span>
<span class="hljs-number">2</span>       <span class="hljs-built_in">Generic</span> <span class="hljs-variable">Error</span>
<span class="hljs-number">1</span>       <span class="hljs-built_in">Write</span> <span class="hljs-built_in">Protect</span> <span class="hljs-variable">Erase</span> <span class="hljs-built_in">Skip</span><span class="hljs-operator">/</span><span class="hljs-punctuation">(</span><span class="hljs-variable">Un</span><span class="hljs-punctuation">)</span><span class="hljs-variable">lock</span> <span class="hljs-variable">Command</span> <span class="hljs-variable">Failed</span>
<span class="hljs-number">0</span>       <span class="hljs-variable">Card</span> <span class="hljs-variable">is</span> <span class="hljs-built_in">Locked</span></code></pre><p>Response R3 (OCR Register)</p>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">39</span>-<span class="hljs-number">32</span>   Same as R<span class="hljs-number">1</span>
<span class="hljs-attribute">31</span>      Card Power-up Status (<span class="hljs-number">0</span>=Powering Up, <span class="hljs-number">1</span>=Normal)
<span class="hljs-attribute">30</span>      Card Capacity Status (<span class="hljs-number">0</span>=MMC/SDSC, <span class="hljs-number">1</span>=SDHC/SDXC)
<span class="hljs-attribute">29</span>-<span class="hljs-number">24</span>   Reserved
<span class="hljs-attribute">23</span>-<span class="hljs-number">0</span>    Voltage Window</code></pre><p>Response R7</p>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">39</span>-<span class="hljs-number">32</span>   Same as R<span class="hljs-number">1</span>
<span class="hljs-attribute">31</span>-<span class="hljs-number">28</span>   Command Version
<span class="hljs-attribute">27</span>-<span class="hljs-number">12</span>   Reserved
<span class="hljs-attribute">11</span>-<span class="hljs-number">8</span>    Voltage Accepted
<span class="hljs-attribute">7</span>-<span class="hljs-number">0</span>     Check Pattern Echo</code></pre><h3 id="memory-card-initialization"><a class="header-link" href="#memory-card-initialization"></a>Memory Card Initialization</h3>
<p>After power on or memory card insertion, wait for at least 1 ms. Set shift
clock speed to slow speed (bit 1 of 9F3Fh is set). Chip release the memory card
then write at least 10 bytes of data to apply clock pulses. It is now operating
in native mode. To change it to SPI mode or resetting it, chip select it back
and send a command 00h. It is now in SPI mode with idle state.</p>
<p>In idle state, only commands 00h, 01h, 08h, 37h 29h, 3Ah and 3Bh are accepted.
To initialize the card and exit idle state, send a command 08h to detect
newer SD (this command does not exist in older MMC/SDSC) then repeatedly send a
command 37h 29h (or 01h in case of illegal command) until idle state bit in the
response is cleared. Now the memory card is fully initialized and able to run
at full shift clock speed. OCR register can now be read to determine the memory
card&#39;s capacity.</p>
<h3 id="memory-card-data-transfer"><a class="header-link" href="#memory-card-data-transfer"></a>Memory Card Data Transfer</h3>
<p>The memory card sends and takes a data in packets. The packet consists of a 1-byte token, a data block with a size of the current block length setting and a 2-byte CRC-16-CCITT (1021h Polynomial). There are delays between each data packets which needs to be clocked.</p>
<p>Single Block Read (Token=FEh)</p>
<pre class="hljs"><code>      __ _________ _______________________
Write   |<span class="hljs-string">_CMD 11h_</span>|<span class="hljs-string"> 
      _______________ __ ____ ________ ___
Read                 </span>|<span class="hljs-string">R1</span>|<span class="hljs-string">    </span>|<span class="hljs-string">_Packet_</span>|</code></pre><p>Multiple Blocks Read (Token=FEh)</p>
<pre class="hljs"><code>      __ _________ _____________________________  __ _________ ________________
Write   |<span class="hljs-string">_CMD 12h_</span>|<span class="hljs-string">                            / /  </span>|<span class="hljs-string">_CMD 0Ch_</span>|
      _______________ __ ____ ________ ____ ___/ /__ ____ ____ __ __        ___
Read                 |<span class="hljs-string">R1</span>|<span class="hljs-string">    </span>|<span class="hljs-string">_Packet_</span>|<span class="hljs-string">    </span>|<span class="hljs-string">_Pa/ /t_</span>|<span class="hljs-string">    </span>|<span class="hljs-string">_Pac</span>|<span class="hljs-string">  </span>|<span class="hljs-string">R1</span>|<span class="hljs-string">_Busy_</span>|</code></pre><p>If reading fails, the memory card will send a following 1-byte data error token
instead of a data packet:</p>
<pre class="hljs"><code><span class="hljs-built_in">Bit</span>
<span class="hljs-number">7</span>-<span class="hljs-number">4</span>     Always <span class="hljs-number">0</span>
<span class="hljs-number">3</span>       <span class="hljs-keyword">Out</span> <span class="hljs-keyword">Of</span> <span class="hljs-keyword">Range</span>
<span class="hljs-number">2</span>       Card ECC failed
<span class="hljs-number">1</span>       Card Controller <span class="hljs-literal">Error</span>
<span class="hljs-number">0</span>       <span class="hljs-keyword">Generic</span> <span class="hljs-literal">Error</span></code></pre><p>Single Block Write (Token=FEh)</p>
<pre class="hljs"><code>      __ _________ ________ ________ _____________
Write   |<span class="hljs-string">_CMD 18h_</span>|<span class="hljs-string">        </span>|<span class="hljs-string">_Packet_</span>|
      _______________ __ ___________ __        ___
Read                 |<span class="hljs-string">R1</span>|<span class="hljs-string">           </span>|<span class="hljs-string">DR</span>|<span class="hljs-string">_Busy_</span>|
                       -&gt;  <span class="hljs-variable">&lt;- 1+ bytes</span></code></pre><p>Multiple Blocks Write (Token=FCh)</p>
<pre class="hljs"><code>      __ _________ ________ ________ ____________ ____  _______________________
Write   |<span class="hljs-string">_CMD 19h_</span>|<span class="hljs-string">        </span>|<span class="hljs-string">_Packet_</span>|<span class="hljs-string">            </span>|<span class="hljs-string">_Pa/ /       </span>|<span class="hljs-string">FDh</span>|
      _______________ __ ___________ __        ______/ /      ______        ___
Read                 |<span class="hljs-string">R1</span>|<span class="hljs-string">           </span>|<span class="hljs-string">DR</span>|<span class="hljs-string">_Busy_</span>|<span class="hljs-string">      / /Busy_</span>|<span class="hljs-string">      </span>|<span class="hljs-string">_Busy_</span>|
                       -&gt;  <span class="hljs-variable">&lt;- 1+ bytes                            -&gt;</span> <span class="hljs-variable">&lt;- 1 byte</span></code></pre><p>Each written packet will make the memory card send a data response token (DR)
back in the next byte, this 1-byte token has a following format:</p>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">5</span>     Not Used
<span class="hljs-attribute">4</span>       Always <span class="hljs-number">0</span>
<span class="hljs-attribute">3</span>-<span class="hljs-number">1</span>     Status (<span class="hljs-number">2</span>=Data Accepted, <span class="hljs-number">5</span>=CRC Error, <span class="hljs-number">6</span>=Write Error)
<span class="hljs-attribute">0</span>       Always <span class="hljs-number">1</span></code></pre><h2 id="x16-vera-memory-and-io-map-vram"><a class="header-link" href="#x16-vera-memory-and-io-map-vram"></a>X16 VERA Memory and I/O Map (VRAM)</h2>
<h3 id="vera-memory-map"><a class="header-link" href="#vera-memory-map"></a>VERA Memory Map</h3>
<pre class="hljs"><code>Offset          Content
<span class="hljs-number">00000h</span>-<span class="hljs-number">1F9BFh</span>   Video RAM
<span class="hljs-number">1F9C0h</span>-<span class="hljs-number">1F9FFh</span>   PSG Registers
<span class="hljs-number">1FA00h</span>-<span class="hljs-number">1FBFFh</span>   Color Palette
<span class="hljs-number">1FC00h</span>-<span class="hljs-number">1FFFFh</span>   Object Attributes</code></pre><p>All of VERA I/O registers at 1F9C0h-1FFFFh are write-only and external to the
VRAM. Any writes will set both it and the VRAM at that location but reads will
only read back that VRAM content. Since the VRAM can have different values than
the actual register values on power-up and most of them are never initially
written to be consistent by the system on boot, it&#39;s required to initialize
those values first on start-up so any further reads will be consistent with
actual values.</p>
<h3 id="tile-map"><a class="header-link" href="#tile-map"></a>Tile Map</h3>
<p>Each tile map entry consists of a 16-bit value as such:</p>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">15</span>-<span class="hljs-number">12</span>   Palette Number (<span class="hljs-number">0</span>-<span class="hljs-number">15</span>)
<span class="hljs-attribute">11</span>      V-flip (<span class="hljs-number">0</span>=Normal, <span class="hljs-number">1</span>=Mirror vertically)
<span class="hljs-attribute">10</span>      H-flip (<span class="hljs-number">0</span>=Normal, <span class="hljs-number">1</span>=Mirror horizontally)
<span class="hljs-attribute">9</span>-<span class="hljs-number">0</span>     Character Number (<span class="hljs-number">000</span>h-<span class="hljs-number">3</span>FFh)</code></pre><p>In 1bpp tile mode, the entries are different depending on bit 3 of Lx_CONFIG
register. This bit controls how foreground and background colors are assigned.
If it is set to 0:</p>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">15</span>-<span class="hljs-number">12</span>   Background Color (<span class="hljs-number">0</span>-<span class="hljs-number">15</span>)
<span class="hljs-attribute">11</span>-<span class="hljs-number">8</span>    Foreground Color (<span class="hljs-number">0</span>-<span class="hljs-number">15</span>)
<span class="hljs-attribute">7</span>-<span class="hljs-number">0</span>     Character Number (<span class="hljs-number">00</span>h-FFh)</code></pre><p>If it is set to 1:</p>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
        <span class="hljs-attribute">Background</span> Color (<span class="hljs-number">0</span>)
<span class="hljs-attribute">15</span>-<span class="hljs-number">8</span>    Foreground Color (<span class="hljs-number">0</span>-<span class="hljs-number">255</span>)
<span class="hljs-attribute">7</span>-<span class="hljs-number">0</span>     Character Number (<span class="hljs-number">00</span>h-FFh)</code></pre><h3 id="tile-data-layers-and-obj"><a class="header-link" href="#tile-data-layers-and-obj"></a>Tile Data (Layers and OBJ)</h3>
<p>VERA strictly uses packed pixel format in every color depth setting. Its
smallest 8x1 &quot;bars&quot; unit can be described as follows:</p>
<pre class="hljs"><code>   <span class="hljs-attribute">Byte</span> <span class="hljs-number">0</span>        <span class="hljs-number">1</span>        <span class="hljs-number">2</span>        <span class="hljs-number">3</span>        <span class="hljs-number">4</span>        <span class="hljs-number">5</span>        <span class="hljs-number">6</span>        <span class="hljs-number">7</span>
    <span class="hljs-attribute">Bit</span> <span class="hljs-number">76543210</span> <span class="hljs-number">76543210</span> <span class="hljs-number">76543210</span> <span class="hljs-number">76543210</span> <span class="hljs-number">76543210</span> <span class="hljs-number">76543210</span> <span class="hljs-number">76543210</span> <span class="hljs-number">76543210</span>
<span class="hljs-attribute">1bpp</span>    abcdefgh
<span class="hljs-attribute">2bpp</span>    aabbccdd eeffgghh
<span class="hljs-attribute">4bpp</span>    aaaabbbb ccccdddd eeeeffff gggghhhh
<span class="hljs-attribute">8bpp</span>    aaaaaaaa bbbbbbbb cccccccc dddddddd eeeeeeee ffffffff gggggggg hhhhhhhh
<span class="hljs-attribute">Depth</span></code></pre><p>For each bar, the color ID for each pixel A to H from left to right are packed
together from left to right. The bit length of each color ID depends on the
color depth setting. Making each bar occupy 1, 2, 4 or 8 bytes total. A color
ID of 0 always mean transparent except in a certain 1bpp tile mode.</p>
<p>To make up tiles which can be up to 16x16 pixels in size for Layers, and up to
64x64 for OBJs, each bars are combined as follows. With X being a tile width in
pixels divided by 8 and Y being a tile height in pixels. For example, a tile
size of 32x16 pixels has X=4 and Y=16.</p>
<pre class="hljs"><code>Vertical Rows       Left-most    ...     Right-most
Upper Row   in bars    <span class="hljs-number">0</span>,      <span class="hljs-number">1</span>,      <span class="hljs-number">2</span>, ...,  <span class="hljs-keyword">X</span><span class="hljs-number">-1</span>
<span class="hljs-number">2</span>nd Row     in bars    <span class="hljs-keyword">X</span>,    <span class="hljs-keyword">X</span>+<span class="hljs-number">1</span>,    <span class="hljs-keyword">X</span>+<span class="hljs-number">2</span>, ..., <span class="hljs-number">2</span><span class="hljs-keyword">X</span><span class="hljs-number">-1</span>
...
Yth Row     in bars XY-<span class="hljs-keyword">X</span>, XY-<span class="hljs-keyword">X</span>+<span class="hljs-number">1</span>, XY-<span class="hljs-keyword">X</span>+<span class="hljs-number">2</span>, ..., XY<span class="hljs-number">-1</span></code></pre><h3 id="bitmap-data"><a class="header-link" href="#bitmap-data"></a>Bitmap Data</h3>
<p>In bitmap mode, the bitmap data format is the same as the tile data format with
a tile width of 320 or 640 pixels (depending on bit 0 of Lx_TILEBASE register)
and a tile height of 480 pixels.</p>
<h3 id="accessing-vram"><a class="header-link" href="#accessing-vram"></a>Accessing VRAM</h3>
<p><a href="#x16-vera-memory-access">X16 VERA Memory Access</a></p>
<h2 id="x16-vera-programmable-sound-generator-psg"><a class="header-link" href="#x16-vera-programmable-sound-generator-psg"></a>X16 VERA Programmable Sound Generator (PSG)</h2>
<p>VERA contains registers for its 16-channel programmable sound generator mapped
to the location of 1F9C0h in VRAM.
It contains a 4-byte entry for each of 16 channels:</p>
<pre class="hljs"><code><span class="hljs-attribute">Byte</span> <span class="hljs-number">0</span>-<span class="hljs-number">1</span>    Frequency; <span class="hljs-number">25000000</span>*n/<span class="hljs-number">2</span>^<span class="hljs-number">26</span> Hz (<span class="hljs-number">0</span>-<span class="hljs-number">65535</span>)
<span class="hljs-attribute">Byte</span> <span class="hljs-number">2</span>
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">7</span>     Output to Right Channel
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">6</span>     Output to Left Channel
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">5</span>-<span class="hljs-number">0</span>   Volume (<span class="hljs-number">0</span>=Silent, <span class="hljs-number">63</span>=Loudest)
<span class="hljs-attribute">Byte</span> <span class="hljs-number">3</span>
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">7</span>-<span class="hljs-number">6</span>   Waveform (<span class="hljs-number">0</span>=Pulse, <span class="hljs-number">1</span>=Sawtooth, <span class="hljs-number">2</span>=Triangle, <span class="hljs-number">3</span>=Noise)
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">5</span>-<span class="hljs-number">0</span>   Pulse Width (<span class="hljs-number">0</span>-<span class="hljs-number">63</span>)</code></pre><h3 id="volume"><a class="header-link" href="#volume"></a>Volume</h3>
<p>The output volume is not linear and has the meaning as follows:</p>
<pre class="hljs"><code><span class="hljs-attribute">00h</span>=0   <span class="hljs-attribute">08h</span>=2   <span class="hljs-attribute">10h</span>=4   <span class="hljs-attribute">18h</span>=6   <span class="hljs-attribute">20h</span>=10  <span class="hljs-attribute">28h</span>=16  <span class="hljs-attribute">30h</span>=26  <span class="hljs-attribute">38h</span>=42
<span class="hljs-attribute">01h</span>=1   <span class="hljs-attribute">09h</span>=2   <span class="hljs-attribute">11h</span>=4   <span class="hljs-attribute">19h</span>=7   <span class="hljs-attribute">21h</span>=11  <span class="hljs-attribute">29h</span>=17  <span class="hljs-attribute">31h</span>=28  <span class="hljs-attribute">39h</span>=44
<span class="hljs-attribute">02h</span>=1   <span class="hljs-attribute">0Ah</span>=2   <span class="hljs-attribute">12h</span>=4   <span class="hljs-attribute">1Ah</span>=7   <span class="hljs-attribute">22h</span>=11  <span class="hljs-attribute">2Ah</span>=18  <span class="hljs-attribute">32h</span>=29  <span class="hljs-attribute">3Ah</span>=47
<span class="hljs-attribute">03h</span>=1   <span class="hljs-attribute">0Bh</span>=3   <span class="hljs-attribute">13h</span>=4   <span class="hljs-attribute">1Bh</span>=7   <span class="hljs-attribute">23h</span>=12  <span class="hljs-attribute">2Bh</span>=19  <span class="hljs-attribute">33h</span>=31  <span class="hljs-attribute">3Bh</span>=50
<span class="hljs-attribute">04h</span>=2   <span class="hljs-attribute">0Ch</span>=3   <span class="hljs-attribute">14h</span>=5   <span class="hljs-attribute">1Ch</span>=8   <span class="hljs-attribute">24h</span>=13  <span class="hljs-attribute">2Ch</span>=21  <span class="hljs-attribute">34h</span>=33  <span class="hljs-attribute">3Ch</span>=52
<span class="hljs-attribute">05h</span>=2   <span class="hljs-attribute">0Dh</span>=3   <span class="hljs-attribute">15h</span>=5   <span class="hljs-attribute">1Dh</span>=8   <span class="hljs-attribute">25h</span>=14  <span class="hljs-attribute">2Dh</span>=22  <span class="hljs-attribute">35h</span>=35  <span class="hljs-attribute">3Dh</span>=56
<span class="hljs-attribute">06h</span>=2   <span class="hljs-attribute">0Eh</span>=3   <span class="hljs-attribute">16h</span>=5   <span class="hljs-attribute">1Eh</span>=9   <span class="hljs-attribute">26h</span>=14  <span class="hljs-attribute">2Eh</span>=23  <span class="hljs-attribute">36h</span>=37  <span class="hljs-attribute">3Eh</span>=59
<span class="hljs-attribute">07h</span>=2   <span class="hljs-attribute">0Fh</span>=3   <span class="hljs-attribute">17h</span>=6   <span class="hljs-attribute">1Fh</span>=9   <span class="hljs-attribute">27h</span>=15  <span class="hljs-attribute">2Fh</span>=25  <span class="hljs-attribute">37h</span>=39  <span class="hljs-attribute">3Fh</span>=63</code></pre><p>NOTE: All values can be approximated as 0.5 dB steps. Volume values are taken
from the official emulator source code and are not confirmed on real hardware
(?)</p>
<h3 id="waveform"><a class="header-link" href="#waveform"></a>Waveform</h3>
<p>For pulse waveform, an additional pulse width value w is used as a duty cycle.
A value of 63 will give an exact square wave with a 50% duty cycle. A value of
0 will give a ~0.8% duty cycle pulse. The pulse waveform is likely implemented
as follows:</p>
<pre class="hljs"><code>   _______           __
  |<span class="hljs-string">       </span>|<span class="hljs-string">         </span>|
__|<span class="hljs-string">       </span>|<span class="hljs-string">_________</span>|
 7 000       7777777 0
 F 012...w...9ABCDEF 0  Pulse cycle<span class="hljs-comment">#</span></code></pre><p>Noise uses some kind of LFSR (?) Official emulator implemented it with
<code>std::rand()</code>.</p>
<h2 id="x16-vera-color-palette"><a class="header-link" href="#x16-vera-color-palette"></a>X16 VERA Color Palette</h2>
<h3 id="color-palette-entries"><a class="header-link" href="#color-palette-entries"></a>Color Palette Entries</h3>
<p>VERA contains the data for 256 colors mapped to the location of 1FA00h in VRAM.
It contains a 2-byte entry for each of 256 colors:</p>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">15</span>-<span class="hljs-number">12</span>   Not Used
<span class="hljs-attribute">11</span>-<span class="hljs-number">8</span>    Red
<span class="hljs-attribute">7</span>-<span class="hljs-number">4</span>     Green
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     Blue</code></pre><h3 id="color-palette-indices"><a class="header-link" href="#color-palette-indices"></a>Color Palette Indices</h3>
<pre class="hljs"><code><span class="hljs-attribute">00h</span>      Backdrop Color (used when <span class="hljs-literal">all</span> Layer/OBJ pixels are transparent)
<span class="hljs-attribute">01h</span>-FFh  <span class="hljs-number">256</span>-color Palette (<span class="hljs-number">1</span>bpp mode and <span class="hljs-number">8</span>bpp mode)
<span class="hljs-attribute">01h</span>-FFh  Sixteen <span class="hljs-number">16</span>-color Palettes (<span class="hljs-number">2</span>bpp mode uses first four colors each)</code></pre><p>NOTE: Due to a hardware quirk, a palette number entry will also modify the
first 16 colors mapping in 8bpp mode as if it was 4bpp mode. So it is
recommended to set the palette number to 0 to still have access to all 256
colors.</p>
<h3 id="initial-palette"><a class="header-link" href="#initial-palette"></a>Initial Palette</h3>
<p>On reset (by either on hardware or a write to CTRL), the internal palette
memory is initialized to these values. It consists of 16 pre-defined colors,
16 gray ramp colors and 224 8x4x7 HSL ramp colors:</p>
<pre class="hljs"><code>    <span class="hljs-attribute">x0h</span> x<span class="hljs-number">1</span>h x<span class="hljs-number">2</span>h x<span class="hljs-number">3</span>h x<span class="hljs-number">4</span>h x<span class="hljs-number">5</span>h x<span class="hljs-number">6</span>h x<span class="hljs-number">7</span>h x<span class="hljs-number">8</span>h x<span class="hljs-number">9</span>h xAh xBh xCh xDh xEh xFh
<span class="hljs-attribute">0xh</span> <span class="hljs-number">000</span> FFF <span class="hljs-number">800</span> AFE C<span class="hljs-number">4</span>C <span class="hljs-number">0</span>C<span class="hljs-number">5</span> <span class="hljs-number">00</span>A EE<span class="hljs-number">7</span> D<span class="hljs-number">85</span> <span class="hljs-number">640</span> F<span class="hljs-number">77</span> <span class="hljs-number">333</span> <span class="hljs-number">777</span> AF<span class="hljs-number">6</span> <span class="hljs-number">08</span>F BBB
<span class="hljs-attribute">1xh</span> <span class="hljs-number">000</span> <span class="hljs-number">111</span> <span class="hljs-number">222</span> <span class="hljs-number">333</span> <span class="hljs-number">444</span> <span class="hljs-number">555</span> <span class="hljs-number">666</span> <span class="hljs-number">777</span> <span class="hljs-number">888</span> <span class="hljs-number">999</span> AAA BBB CCC DDD EEE FFF
<span class="hljs-attribute">2xh</span> <span class="hljs-number">211</span> <span class="hljs-number">433</span> <span class="hljs-number">644</span> <span class="hljs-number">866</span> A<span class="hljs-number">88</span> C<span class="hljs-number">99</span> FBB <span class="hljs-number">211</span> <span class="hljs-number">422</span> <span class="hljs-number">633</span> <span class="hljs-number">844</span> A<span class="hljs-number">55</span> C<span class="hljs-number">66</span> F<span class="hljs-number">77</span> <span class="hljs-number">200</span> <span class="hljs-number">411</span>
<span class="hljs-attribute">3xh</span> <span class="hljs-number">611</span> <span class="hljs-number">822</span> A<span class="hljs-number">22</span> C<span class="hljs-number">33</span> F<span class="hljs-number">33</span> <span class="hljs-number">200</span> <span class="hljs-number">400</span> <span class="hljs-number">600</span> <span class="hljs-number">800</span> A<span class="hljs-number">00</span> C<span class="hljs-number">00</span> F<span class="hljs-number">00</span> <span class="hljs-number">221</span> <span class="hljs-number">443</span> <span class="hljs-number">664</span> <span class="hljs-number">886</span>
<span class="hljs-attribute">4xh</span> AA<span class="hljs-number">8</span> CC<span class="hljs-number">9</span> FEB <span class="hljs-number">211</span> <span class="hljs-number">432</span> <span class="hljs-number">653</span> <span class="hljs-number">874</span> A<span class="hljs-number">95</span> CB<span class="hljs-number">6</span> FD<span class="hljs-number">7</span> <span class="hljs-number">210</span> <span class="hljs-number">431</span> <span class="hljs-number">651</span> <span class="hljs-number">862</span> A<span class="hljs-number">82</span> CA<span class="hljs-number">3</span>
<span class="hljs-attribute">5xh</span> FC<span class="hljs-number">3</span> <span class="hljs-number">210</span> <span class="hljs-number">430</span> <span class="hljs-number">640</span> <span class="hljs-number">860</span> A<span class="hljs-number">80</span> C<span class="hljs-number">90</span> FB<span class="hljs-number">0</span> <span class="hljs-number">121</span> <span class="hljs-number">343</span> <span class="hljs-number">564</span> <span class="hljs-number">786</span> <span class="hljs-number">9</span>A<span class="hljs-number">8</span> BC<span class="hljs-number">9</span> DFB <span class="hljs-number">121</span>
<span class="hljs-attribute">6xh</span> <span class="hljs-number">342</span> <span class="hljs-number">463</span> <span class="hljs-number">684</span> <span class="hljs-number">8</span>A<span class="hljs-number">5</span> <span class="hljs-number">9</span>C<span class="hljs-number">6</span> BF<span class="hljs-number">7</span> <span class="hljs-number">120</span> <span class="hljs-number">241</span> <span class="hljs-number">461</span> <span class="hljs-number">582</span> <span class="hljs-number">6</span>A<span class="hljs-number">2</span> <span class="hljs-number">8</span>C<span class="hljs-number">3</span> <span class="hljs-number">9</span>F<span class="hljs-number">3</span> <span class="hljs-number">120</span> <span class="hljs-number">240</span> <span class="hljs-number">360</span>
<span class="hljs-attribute">7xh</span> <span class="hljs-number">480</span> <span class="hljs-number">5</span>A<span class="hljs-number">0</span> <span class="hljs-number">6</span>C<span class="hljs-number">0</span> <span class="hljs-number">7</span>F<span class="hljs-number">0</span> <span class="hljs-number">121</span> <span class="hljs-number">343</span> <span class="hljs-number">465</span> <span class="hljs-number">686</span> <span class="hljs-number">8</span>A<span class="hljs-number">8</span> <span class="hljs-number">9</span>CA BFC <span class="hljs-number">121</span> <span class="hljs-number">242</span> <span class="hljs-number">364</span> <span class="hljs-number">485</span> <span class="hljs-number">5</span>A<span class="hljs-number">6</span>
<span class="hljs-attribute">8xh</span> <span class="hljs-number">6</span>C<span class="hljs-number">8</span> <span class="hljs-number">7</span>F<span class="hljs-number">9</span> <span class="hljs-number">020</span> <span class="hljs-number">141</span> <span class="hljs-number">162</span> <span class="hljs-number">283</span> <span class="hljs-number">2</span>A<span class="hljs-number">4</span> <span class="hljs-number">3</span>C<span class="hljs-number">5</span> <span class="hljs-number">3</span>F<span class="hljs-number">6</span> <span class="hljs-number">020</span> <span class="hljs-number">041</span> <span class="hljs-number">061</span> <span class="hljs-number">082</span> <span class="hljs-number">0</span>A<span class="hljs-number">2</span> <span class="hljs-number">0</span>C<span class="hljs-number">3</span> <span class="hljs-number">0</span>F<span class="hljs-number">3</span>
<span class="hljs-attribute">9xh</span> <span class="hljs-number">122</span> <span class="hljs-number">344</span> <span class="hljs-number">466</span> <span class="hljs-number">688</span> <span class="hljs-number">8</span>AA <span class="hljs-number">9</span>CC BFF <span class="hljs-number">122</span> <span class="hljs-number">244</span> <span class="hljs-number">366</span> <span class="hljs-number">488</span> <span class="hljs-number">5</span>AA <span class="hljs-number">6</span>CC <span class="hljs-number">7</span>FF <span class="hljs-number">022</span> <span class="hljs-number">144</span>
<span class="hljs-attribute">Axh</span> <span class="hljs-number">166</span> <span class="hljs-number">288</span> <span class="hljs-number">2</span>AA <span class="hljs-number">3</span>CC <span class="hljs-number">3</span>FF <span class="hljs-number">022</span> <span class="hljs-number">044</span> <span class="hljs-number">066</span> <span class="hljs-number">088</span> <span class="hljs-number">0</span>AA <span class="hljs-number">0</span>CC <span class="hljs-number">0</span>FF <span class="hljs-number">112</span> <span class="hljs-number">334</span> <span class="hljs-number">456</span> <span class="hljs-number">668</span>
<span class="hljs-attribute">Bxh</span> <span class="hljs-number">88</span>A <span class="hljs-number">9</span>AC BCF <span class="hljs-number">112</span> <span class="hljs-number">224</span> <span class="hljs-number">346</span> <span class="hljs-number">458</span> <span class="hljs-number">56</span>A <span class="hljs-number">68</span>C <span class="hljs-number">79</span>F <span class="hljs-number">002</span> <span class="hljs-number">114</span> <span class="hljs-number">126</span> <span class="hljs-number">238</span> <span class="hljs-number">24</span>A <span class="hljs-number">35</span>C
<span class="hljs-attribute">Cxh</span> <span class="hljs-number">36</span>F <span class="hljs-number">002</span> <span class="hljs-number">014</span> <span class="hljs-number">016</span> <span class="hljs-number">028</span> <span class="hljs-number">02</span>A <span class="hljs-number">03</span>C <span class="hljs-number">03</span>F <span class="hljs-number">112</span> <span class="hljs-number">334</span> <span class="hljs-number">546</span> <span class="hljs-number">768</span> <span class="hljs-number">98</span>A B<span class="hljs-number">9</span>C DBF <span class="hljs-number">112</span>
<span class="hljs-attribute">Dxh</span> <span class="hljs-number">324</span> <span class="hljs-number">436</span> <span class="hljs-number">648</span> <span class="hljs-number">85</span>A <span class="hljs-number">96</span>C B<span class="hljs-number">7</span>F <span class="hljs-number">102</span> <span class="hljs-number">214</span> <span class="hljs-number">416</span> <span class="hljs-number">528</span> <span class="hljs-number">62</span>A <span class="hljs-number">83</span>C <span class="hljs-number">93</span>F <span class="hljs-number">102</span> <span class="hljs-number">204</span> <span class="hljs-number">306</span>
<span class="hljs-attribute">Exh</span> <span class="hljs-number">408</span> <span class="hljs-number">50</span>A <span class="hljs-number">60</span>C <span class="hljs-number">70</span>F <span class="hljs-number">212</span> <span class="hljs-number">434</span> <span class="hljs-number">646</span> <span class="hljs-number">868</span> A<span class="hljs-number">8</span>A C<span class="hljs-number">9</span>C FBE <span class="hljs-number">211</span> <span class="hljs-number">423</span> <span class="hljs-number">635</span> <span class="hljs-number">847</span> A<span class="hljs-number">59</span>
<span class="hljs-attribute">Fxh</span> C<span class="hljs-number">6</span>B F<span class="hljs-number">7</span>D <span class="hljs-number">201</span> <span class="hljs-number">413</span> <span class="hljs-number">615</span> <span class="hljs-number">826</span> A<span class="hljs-number">28</span> C<span class="hljs-number">3</span>A F<span class="hljs-number">3</span>C <span class="hljs-number">201</span> <span class="hljs-number">403</span> <span class="hljs-number">604</span> <span class="hljs-number">806</span> A<span class="hljs-number">08</span> C<span class="hljs-number">09</span> F<span class="hljs-number">0</span>B</code></pre><p class="img-container"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAJgUlEQVR42u3YYXUUSxCG4Z57MNBIqJbQkbCRcFdCkAASshKIBJAAElgLSCAS5orYH9/l1PMYqKnuneQ9c4wxzhF0ntHx43Yc0fl1/snOf/4dnf/0ehvZB/g3Ov7Pn3t0/vtb9v5vP79H53/dn7M/v58/o/Mvl0t0/n59j86/3r5G5//Y2fv/ZwAA7QgAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAjzvGGGfyAeacw3zzzTfffPPN9wUAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAEAAAgAAEAAAAACAAAQAACAAAAA/vc+1JzRB6iq7Pzu+zc//x3ef12vvX//5kfnz+b7r9ut9f6+AABAQwIAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAADA446XOc/kA9Sc0QOo8AWk99/h/df93vv+zW89P/7+Vfjvb1V4fu/9fQEAgIYEAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAgMcd3769nskHqJrRA9hV0flrXUfn8ze/9/wdnr+ebs3vP/sPqGbz/cP37wsAADQkAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAADzuOH/tM/kA6/kePYCq7AXUHL33b37+O7z/x08zfP8Vnt99/+bnH34Bn9bVFwAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAIAAAAAEAAAgAAEAAAAACAAD42xz7UmfyAWbN6AFU8/nx89/Z+dd1633+NVrvP8P7x9//nd3/y7q3vv/0fF8AAKAhAQAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAOBxx+V1nMkHmJU9gPj8nZ3/tmZ0flWF77/C+zv/6P47O/+6nsPnP1vff37/7HxfAACgIQEAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAADgccfLr9cz+QBzz+gB3Nan6PxZ2f1HeL79w/uH37/7emt9/6OG/Tvvv30BAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAACAAAQAACAAAAABAAAIAAAgL/OMavO5ANUVfQAZnh+NZ8fP/+9o/Ova7U+f/Obzw+/f7fm758vAADQkAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAADwuGO+vJzJB5hV2RMIz4/vv3d0/H2t1vdvfvP54fdvflzh4+/997dmdr4vAADQkAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAADwuA+f6xJ9gFkVnV+1o/Ovzyt7/jN7/jv9+wvvP0fz+e/Z9+/21Pv9GzP7/r2Hf3/v79V6f18AAKAhAQAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAOBxx345z+QD3N9W9gRmha+g7N96/51d/3f2/avKnn+F7z++f/vzz75/T9fs++cLAAA0JAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAA87th1OZMPMGdFD6Caz8+f/47Ov95W7/MfvX9/czR//0f2/ftyX63vPz3fFwAAaEgAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAeNxxGa9n8gHmqNF7/o7O/z5XdH5V9vxrVu/9m5//Du+/rqv37998XwAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAgAAAAAQAACAAAAABAAAIAADgb3P8evlxJh9gz4oewLo9RedXeP8a4flzNt8/O3+H91/35973P5r//puff/r98wUAABoSAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAB73H2plkcYNKQbDAAAAAElFTkSuQmCC" alt="Initial palette colors arranged in a 16x16 grid as an above table"></p>
<h3 id="screen-border-color"><a class="header-link" href="#screen-border-color"></a>Screen Border Color</h3>
<p><a href="#x16-vera-display-composer">X16 VERA Display Composer</a>  </p>
<h2 id="x16-vera-sprites-objs"><a class="header-link" href="#x16-vera-sprites-objs"></a>X16 VERA Sprites (OBJs)</h2>
<h3 id="oam-object-attribute-memory"><a class="header-link" href="#oam-object-attribute-memory"></a>OAM (Object Attribute Memory)</h3>
<p>VERA contains the data for 128 OBJs mapped to the location of 1FC00h in VRAM.
OAM size is 1024 bytes which extends to the end of VRAM at 1FFFFh.
It contains an 8-byte entry for each of 128 OBJs:</p>
<pre class="hljs"><code><span class="hljs-attribute">Byte</span> <span class="hljs-number">0</span>-<span class="hljs-number">1</span>
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">15</span>    Color Depth (<span class="hljs-number">0</span>=<span class="hljs-number">4</span>bpp, <span class="hljs-number">1</span>=<span class="hljs-number">8</span>bpp)
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">14</span>-<span class="hljs-number">12</span> Not Used
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">11</span>-<span class="hljs-number">0</span>  Base Address (in <span class="hljs-number">32</span>-byte steps)
<span class="hljs-attribute">Byte</span> <span class="hljs-number">2</span>-<span class="hljs-number">3</span>    X-Coordinate (upper <span class="hljs-number">6</span> bits are ignored) (-<span class="hljs-number">384</span>..<span class="hljs-number">639</span>)
<span class="hljs-attribute">Byte</span> <span class="hljs-number">4</span>-<span class="hljs-number">5</span>    Y-Coordinate (upper <span class="hljs-number">6</span> bits are ignored) (-<span class="hljs-number">512</span>..<span class="hljs-number">511</span>)
<span class="hljs-attribute">Byte</span> <span class="hljs-number">6</span>
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">7</span>-<span class="hljs-number">4</span>   Collision Mask
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">3</span>-<span class="hljs-number">2</span>   Enable / Priority Relative to Layers
              <span class="hljs-attribute">0</span> = OBJ disabled
              <span class="hljs-attribute">1</span> = OBJ between backdrop and layer <span class="hljs-number">0</span>
              <span class="hljs-attribute">2</span> = OBJ between layer <span class="hljs-number">0</span> and layer <span class="hljs-number">1</span>
              <span class="hljs-attribute">3</span> = OBJ in front of layer <span class="hljs-number">1</span>
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">1</span>     V-flip (<span class="hljs-number">0</span>=Normal, <span class="hljs-number">1</span>=Mirror vertically)
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">0</span>     H-flip (<span class="hljs-number">0</span>=Normal, <span class="hljs-number">1</span>=Mirror horizontally)
<span class="hljs-attribute">Byte</span> <span class="hljs-number">7</span>
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">7</span>-<span class="hljs-number">6</span>   Sprite Height (<span class="hljs-number">0</span>=<span class="hljs-number">8</span>, <span class="hljs-number">1</span>=<span class="hljs-number">16</span>, <span class="hljs-number">2</span>=<span class="hljs-number">32</span>, <span class="hljs-number">3</span>=<span class="hljs-number">64</span> pixels)
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">5</span>-<span class="hljs-number">4</span>   Sprite Width (<span class="hljs-number">0</span>=<span class="hljs-number">8</span>, <span class="hljs-number">1</span>=<span class="hljs-number">16</span>, <span class="hljs-number">2</span>=<span class="hljs-number">32</span>, <span class="hljs-number">3</span>=<span class="hljs-number">64</span> pixels)
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">3</span>-<span class="hljs-number">0</span>   Palette Number (<span class="hljs-number">0</span>-<span class="hljs-number">15</span>)</code></pre><h3 id="sprite-collision"><a class="header-link" href="#sprite-collision"></a>Sprite Collision</h3>
<p>NOTE: All of the description in this section is purely based on the official
emulator source code and has not been confirmed on real hardware (?)</p>
<p>VERA has a feature where sprite collisions can be detected automatically on
hardware while rendering. It does this by having a collision buffer in addition
to a render buffer in a line. Each time a non-transparent pixel of an OBJ is
being drawn to the buffer, it will compare the collision mask bit field between
of that OBJ and the buffer. A collision is marked if one of bit positions
match. The implementation pseudocode is as follows:</p>
<pre class="hljs"><code><span class="hljs-keyword">For</span> each frame:
    cflag := <span class="hljs-number">0</span>
    Set <span class="hljs-keyword">all</span> Collision <span class="hljs-keyword">buffer</span> <span class="hljs-keyword">to</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">For</span> each OBJ:
        <span class="hljs-keyword">If</span> a non-transparent pixel <span class="hljs-keyword">is</span> being drawn:
            cflag |= Collision <span class="hljs-keyword">buffer</span> at target pixel &amp; OBJ<span class="hljs-symbol">&#x27;s</span> collision mask
            Collision <span class="hljs-keyword">buffer</span> at target pixel |= OBJ<span class="hljs-symbol">&#x27;s</span> collision mask
    ISR[<span class="hljs-number">7</span>:<span class="hljs-number">4</span>] = cflag
    <span class="hljs-keyword">If</span> cflag != <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> Sprite Collide IRQ <span class="hljs-keyword">is</span> enabled:
        <span class="hljs-keyword">Generate</span> Sprite Collide IRQ</code></pre><p>Note that the effect of sprites per line limit still applies here and enabled
OBJs that are on the line but are never displayed (off-screen) still adds to
this logic. Bits 4-7 of ISR and the Sprite Collide IRQ is only updated and
generated once per frame at the beginning of the VBlank.</p>
<p>CAUTION: Collisions are only detected on lines that are actually rendered.
This can be problematic in interlaced mode where some lines are skipped per
frame and potentially missing the collision.</p>
<h3 id="obj-priority-to-other-objs"><a class="header-link" href="#obj-priority-to-other-objs"></a>OBJ Priority to Other OBJs</h3>
<p>The OAM location dictates the order in which OBJs to be displayed on top. An
OBJ will always display on top of the other OBJs that have their OAM entries
following its. Thus making OBJ0 has the highest priority and OBJ127 has the
lowest priority.</p>
<h3 id="maximum-number-of-sprites-per-line"><a class="header-link" href="#maximum-number-of-sprites-per-line"></a>Maximum Number of Sprites per Line</h3>
<p>The total available OBJ rendering cycles per line are 801. The required
rendering cycles per OBJ are as follows:</p>
<pre class="hljs"><code><span class="hljs-attribute">Depth</span>       OBJ Width
            <span class="hljs-attribute">8px</span>   <span class="hljs-number">16</span>px  <span class="hljs-number">32</span>px  <span class="hljs-number">64</span>px
<span class="hljs-attribute">4bpp</span>        <span class="hljs-number">10</span>    <span class="hljs-number">19</span>    <span class="hljs-number">37</span>    <span class="hljs-number">73</span>    ; <span class="hljs-number">9</span>X+<span class="hljs-number">1</span>
<span class="hljs-attribute">8bpp</span>        <span class="hljs-number">11</span>    <span class="hljs-number">21</span>    <span class="hljs-number">41</span>    <span class="hljs-number">81</span>    ; <span class="hljs-number">10</span>X+<span class="hljs-number">1</span>
<span class="hljs-section">&lt;disabled/
not on line&gt;</span>          <span class="hljs-attribute">1</span>             ; OAM lookup cost</code></pre><p>Under best circumstances, up to 80 OBJs (with all of them being 4bpp 8x8) can
be displayed per screen line. The maximum number of OBJs per line is also
affected by off-screen OBJs. To avoid this, either move displayed OBJs to the
beginning of the OAM or set a priority of 0 (disabled) to undisplayed OBJs.</p>
<h1 id="x16-peripherals"><a class="header-link" href="#x16-peripherals"></a>X16 Peripherals</h1>
<p>This section describes all interfaces and peripherals external to the X16.</p>
<p><a href="#via-connections">VIA Connections</a><br><a href="#x16-ps2-interface-keyboardmouse">X16 PS/2 Interface (Keyboard/Mouse)</a><br><a href="#x16-joypad-interface-snes-controllers">X16 Joypad Interface (SNES Controllers)</a><br><a href="#x16-iec-interface-commodore-disk-drivesprinters">X16 IEC Interface (Commodore Disk Drives/Printers)</a><br><a href="#x16-vera-memory-card-interface">X16 VERA Memory Card Interface</a>  </p>
<h2 id="via-connections"><a class="header-link" href="#via-connections"></a>VIA Connections</h2>
<p>X16 uses two VIA chips for general purpose I/O and timers. These provide the
rest of interfaces not covered by VERA. Both two chips run at the system clock
(PHI2 input is connected to it) and can be accessed from the CPU bus. For
details about the chip itself and its registers, see:<br><a href="#via-versatile-interface-adapter">VIA Versatile Interface Adapter</a>  </p>
<h3 id="1st-via-9f0xh"><a class="header-link" href="#1st-via-9f0xh"></a>1st VIA (9F0xh)</h3>
<p>Every peripheral described in this section and the I2C bus are all wired to the
first VIA&#39;s I/O pins as follows. The IRQ out from this chip is connected to the
NMI line of the CPU.</p>
<pre class="hljs"><code><span class="hljs-attribute">PA0</span>     PS/<span class="hljs-number">2</span> Keyboard Data
<span class="hljs-attribute">PA1</span>     PS/<span class="hljs-number">2</span> Keyboard Clock
<span class="hljs-attribute">PA2</span>     Joypad Strobe (Both <span class="hljs-number">2</span> Ports) (-&gt; STB)
<span class="hljs-attribute">PA3</span>     Joypad Clock (Both <span class="hljs-number">2</span> Ports) (-&gt; CK<span class="hljs-number">1</span>/CK<span class="hljs-number">2</span>)
<span class="hljs-attribute">PA4</span>     Joypad <span class="hljs-number">4</span> Data (Port <span class="hljs-number">2</span>) (-&gt; IN<span class="hljs-number">4</span>) (?)
<span class="hljs-attribute">PA5</span>     Joypad <span class="hljs-number">3</span> Data (Port <span class="hljs-number">1</span>) (-&gt; IN<span class="hljs-number">3</span>) (?)
<span class="hljs-attribute">PA6</span>     Joypad <span class="hljs-number">2</span> Data (Port <span class="hljs-number">2</span>) (-&gt; IN<span class="hljs-number">2</span>) (?)
<span class="hljs-attribute">PA7</span>     Joypad <span class="hljs-number">1</span> Data (Port <span class="hljs-number">1</span>) (-&gt; IN<span class="hljs-number">1</span>) (?)
<span class="hljs-attribute">CA1</span>     Not Used (?)
<span class="hljs-attribute">CA2</span>     Not Used (?)
<span class="hljs-attribute">PB0</span>     PS/<span class="hljs-number">2</span> Mouse Data
<span class="hljs-attribute">PB1</span>     PS/<span class="hljs-number">2</span> Mouse Clock
<span class="hljs-attribute">PB2</span>     I<span class="hljs-number">2</span>C SDA
<span class="hljs-attribute">PB3</span>     IEC ATN Out
<span class="hljs-attribute">PB4</span>     IEC CLK Out
<span class="hljs-attribute">PB5</span>     IEC DATA Out
<span class="hljs-attribute">PB6</span>     IEC CLK In
<span class="hljs-attribute">PB7</span>     IEC DATA In
<span class="hljs-attribute">CB1</span>     Not Used (?)
<span class="hljs-attribute">CB2</span>     I<span class="hljs-number">2</span>C SCL</code></pre><p>Several internal system peripherals and memory are connected to the I2C Bus.
They are described in the following section:<br><a href="#x16-i2c-bus">X16 I2C Bus</a></p>
<h3 id="2nd-via-9f1xh"><a class="header-link" href="#2nd-via-9f1xh"></a>2nd VIA (9F1xh)</h3>
<p>Every I/O pin connections on the second VIA are not used and exposed through
the user port header. The IRQ out from this chip is connected to the IRQ line
of the CPU.</p>
<h2 id="x16-ps2-interface-keyboardmouse"><a class="header-link" href="#x16-ps2-interface-keyboardmouse"></a>X16 PS/2 Interface (Keyboard/Mouse)</h2>
<p>X16 uses PS/2 connectors for each keyboard and mouse input. It is a two-wire
serial interface similar to I2C, but the transfer protocol is incompatible,
slower and has +5V logic. The connector itself doesn&#39;t differentiate between
keyboard and mouse and in theory could be plugged to any of both. However, the
keyboard and mouse use different command sets and X16 (and PCs)&#39;s device
drivers are hard-coded to handle each one on its own labelled port.</p>
<p>For this interface, the clock signal is always driven by a device. Since the
clock line from both ports are connected to regular I/O ports of the VIA, there
is no way to interrupt the CPU to read an incoming serial data from devices.
However, the protocol itself allows the host to pull the clock line low to
signal devices that the host is busy. This will stop any active transfers from
them, inhibit them to not send any data and wait until the clock line is
released. So, a typical keyboard/mouse reading routine in X16 usually consists
of releasing a clock line (by setting PA1/PB1 direction to read), reading all
transferred data and then pulling a clock line low again after finishing to
prevent any lost scan codes when the system is not reading it.</p>
<h3 id="ps2-bus-access-read"><a class="header-link" href="#ps2-bus-access-read"></a>PS/2 Bus Access (Read)</h3>
<pre class="hljs"><code>     Start            Data Byte           Parity Stop
     <span class="hljs-variable">&lt;----&gt;</span><span class="hljs-variable">&lt;------------------------------&gt;</span><span class="hljs-variable">&lt;--&gt;</span><span class="hljs-variable">&lt;-----&gt;</span>
     ___   _   _   _   _   _   _   _   _   _   _   ___
CLK     |<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> 
     __     ___ ___ ___ ___ ___ ___ ___ ___ ___ ______
DATA   </span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|
      START  0   1   2   3   4   5   6   7  ODD STOP</code></pre><p>After all lines are released (make sure to release the data line first or both
at the same time to avoid accidentally signalling write mode), wait a bit until
the device start pulling the clock line low, then begin reading the data every
falling edge of the clock until stop bit is read. Repeat the reading process
again for next bytes. If the device never pulls the clock line low from having
no more data to send, simply time out the wait loop and pull the clock line low
to end the process.</p>
<h3 id="ps2-bus-access-write"><a class="header-link" href="#ps2-bus-access-write"></a>PS/2 Bus Access (Write)</h3>
<pre class="hljs"><code>      Start            Data Byte         Parity Stop Ack
     <span class="hljs-variable">&lt;------&gt;</span><span class="hljs-variable">&lt;------------------------------&gt;</span><span class="hljs-variable">&lt;--&gt;</span>--<span class="hljs-variable">&lt;------&gt;</span>
     _     _   _   _   _   _   _   _   _   _   _   _   ____
CLK   |<span class="hljs-string">___</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|
     ____     ___ ___ ___ ___ ___ ___ ___ ___ ___ _     ___
DATA     |<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string"> </span>|<span class="hljs-string">___</span>|
        START  0   1   2   3   4   5   6   7  ODD S ACK</code></pre><p>To write to the device, pull the clock line low to stop it from sending a data,
then send the start bit during this state to indicate write mode. Release the
clock line without changing the data line and wait a bit until the device start
pulling the clock line low and read this start bit. Then begin writing a data
every falling edge of the clock (the device will read it at the rising edge).
After the stop bit is written, release the data line for the device to send
acknowledge signal then read this at the falling edge of the clock. After this,
the device will usually send back a response data for the host to read.</p>
<h3 id="parity-bit"><a class="header-link" href="#parity-bit"></a>Parity Bit</h3>
<p>The PS/2 protocol contains a simple error checking in a form of parity bit. The
number of logic 1s in the data bit and parity bit must always added up to an
odd number. The parity bit can simply calculated by XOR-ing every data bits
then invert the result: <code>P = NOT(D.Bit(0) XOR D.Bit(1) XOR ... XOR D.Bit(7))</code></p>
<h3 id="device-self-test-bat"><a class="header-link" href="#device-self-test-bat"></a>Device Self-test (BAT)</h3>
<p>After power-on or a reset by the host. The device will initialize to default
settings and perform a self-test referred to as Basic Assurance Test (BAT). It
will ignore any write commands until this process is finished. After finishing,
it will either send AAh for success or FCh for error.</p>
<h3 id="keyboard-data-scancode-summary"><a class="header-link" href="#keyboard-data-scancode-summary"></a>Keyboard Data (Scancode) Summary</h3>
<p>A keyboard sends a data to the host in a byte sequence called scancodes to
indicate which keys are pressed/released. The following tables describe PC AT
scancode set which is the default and most supported set among modern
keyboards:</p>
<pre class="hljs"><code>nn              Normal <span class="hljs-built_in">key</span> pressed
F0h nn          Normal <span class="hljs-built_in">key</span> released
E0h nn          Special <span class="hljs-built_in">key</span> pressed
E0h F0h nn      Special <span class="hljs-built_in">key</span> released</code></pre><p>Sometimes, a key pressed command can be sent repeatedly as typematic repeating
keys. Its delay and repeat interval can be set by host write commands. This is
to distinguish between automatically-generated repeating keys from holding down
a key and actual repeated key pressing.</p>
<h3 id="normal-keyboard-scancodes-us-layout"><a class="header-link" href="#normal-keyboard-scancodes-us-layout"></a>Normal Keyboard Scancodes (US Layout)</h3>
<pre class="hljs"><code>    <span class="hljs-comment">0xh</span>     <span class="hljs-comment">1xh</span>     <span class="hljs-comment">2xh</span>     <span class="hljs-comment">3xh</span>     <span class="hljs-comment">4xh</span>     <span class="hljs-comment">5xh</span>     <span class="hljs-comment">6xh</span>     <span class="hljs-comment">7xh</span>     <span class="hljs-comment">8xh</span>
<span class="hljs-comment">x0h</span> &lt;<span class="hljs-comment">error</span>&gt; --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     <span class="hljs-comment">NUM</span><span class="hljs-literal">-</span><span class="hljs-comment">0</span>   --<span class="hljs-literal">-</span>
<span class="hljs-comment">x1h</span> <span class="hljs-comment">F9</span>      <span class="hljs-comment">LALT</span>    <span class="hljs-comment">C</span>       <span class="hljs-comment">N</span>       <span class="hljs-string">,</span>&lt;      --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     <span class="hljs-comment">NUM</span><span class="hljs-literal">-</span><span class="hljs-string">.</span>   --<span class="hljs-literal">-</span>
<span class="hljs-comment">x2h</span> --<span class="hljs-literal">-</span>     <span class="hljs-comment">LSHIFT</span>  <span class="hljs-comment">X</span>       <span class="hljs-comment">B</span>       <span class="hljs-comment">K</span>       <span class="hljs-comment">&#x27;&quot;</span>      --<span class="hljs-literal">-</span>     <span class="hljs-comment">NUM</span><span class="hljs-literal">-</span><span class="hljs-comment">2</span>   --<span class="hljs-literal">-</span>
<span class="hljs-comment">x3h</span> <span class="hljs-comment">F5</span>              <span class="hljs-comment">D</span>       <span class="hljs-comment">H</span>       <span class="hljs-comment">I</span>       --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     <span class="hljs-comment">NUM</span><span class="hljs-literal">-</span><span class="hljs-comment">5</span>   <span class="hljs-comment">F7</span>
<span class="hljs-comment">x4h</span> <span class="hljs-comment">F3</span>      <span class="hljs-comment">LCTRL</span>   <span class="hljs-comment">E</span>       <span class="hljs-comment">G</span>       <span class="hljs-comment">O</span>       <span class="hljs-title">[</span><span class="hljs-comment">{</span>      --<span class="hljs-literal">-</span>     <span class="hljs-comment">NUM</span><span class="hljs-literal">-</span><span class="hljs-comment">6</span>   <span class="hljs-comment">ALT</span><span class="hljs-literal">-</span><span class="hljs-comment">SYSRQ</span>
<span class="hljs-comment">x5h</span> <span class="hljs-comment">F1</span>      <span class="hljs-comment">Q</span>       <span class="hljs-comment">4$</span>      <span class="hljs-comment">Y</span>       <span class="hljs-comment">0)</span>      <span class="hljs-comment">=</span><span class="hljs-literal">+</span>      --<span class="hljs-literal">-</span>     <span class="hljs-comment">NUM</span><span class="hljs-literal">-</span><span class="hljs-comment">8</span>   --<span class="hljs-literal">-</span>
<span class="hljs-comment">x6h</span> <span class="hljs-comment">F2</span>      <span class="hljs-comment">1!</span>      <span class="hljs-comment">3#</span>      <span class="hljs-comment">6^</span>      <span class="hljs-comment">9(</span>      --<span class="hljs-literal">-</span>     <span class="hljs-comment">BS</span>      <span class="hljs-comment">ESC</span>     --<span class="hljs-literal">-</span>
<span class="hljs-comment">x7h</span> <span class="hljs-comment">F12</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     <span class="hljs-comment">NUMLOCK</span> --<span class="hljs-literal">-</span>
<span class="hljs-comment">x8h</span> --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     <span class="hljs-comment">CAPS</span>    --<span class="hljs-literal">-</span>     <span class="hljs-comment">F11</span>     --<span class="hljs-literal">-</span>
<span class="hljs-comment">x9h</span> <span class="hljs-comment">F10</span>     --<span class="hljs-literal">-</span>     <span class="hljs-comment">SPACE</span>   --<span class="hljs-literal">-</span>     <span class="hljs-string">.</span>&gt;      <span class="hljs-comment">RSHIFT</span>  <span class="hljs-comment">NUM</span><span class="hljs-literal">-</span><span class="hljs-comment">1</span>   <span class="hljs-comment">NUM</span><span class="hljs-literal">-</span><span class="hljs-comment">ADD</span> --<span class="hljs-literal">-</span>
<span class="hljs-comment">xAh</span> <span class="hljs-comment">F8</span>      <span class="hljs-comment">Z</span>       <span class="hljs-comment">V</span>       <span class="hljs-comment">M</span>       <span class="hljs-comment">/?</span>      <span class="hljs-comment">ENTER</span>   --<span class="hljs-literal">-</span>     <span class="hljs-comment">NUM</span><span class="hljs-literal">-</span><span class="hljs-comment">3</span>   --<span class="hljs-literal">-</span>
<span class="hljs-comment">xBh</span> <span class="hljs-comment">F6</span>      <span class="hljs-comment">S</span>       <span class="hljs-comment">F</span>       <span class="hljs-comment">J</span>       <span class="hljs-comment">L</span>       <span class="hljs-title">]</span><span class="hljs-comment">}</span>      <span class="hljs-comment">NUM</span><span class="hljs-literal">-</span><span class="hljs-comment">4</span>   <span class="hljs-comment">NUM</span><span class="hljs-literal">-</span><span class="hljs-comment">SUB</span> --<span class="hljs-literal">-</span>
<span class="hljs-comment">xCh</span> <span class="hljs-comment">F4</span>      <span class="hljs-comment">A</span>       <span class="hljs-comment">T</span>       <span class="hljs-comment">U</span>       <span class="hljs-comment">;:</span>      --<span class="hljs-literal">-</span>     <span class="hljs-comment">NUM</span><span class="hljs-literal">-</span><span class="hljs-comment">7</span>   <span class="hljs-comment">NUM</span><span class="hljs-literal">-</span><span class="hljs-comment">MUL</span> --<span class="hljs-literal">-</span>
<span class="hljs-comment">xDh</span> <span class="hljs-comment">TAB</span>     <span class="hljs-comment">W</span>       <span class="hljs-comment">R</span>       <span class="hljs-comment">7&amp;</span>      <span class="hljs-comment">P</span>       <span class="hljs-comment">\|</span>      --<span class="hljs-literal">-</span>     <span class="hljs-comment">NUM</span><span class="hljs-literal">-</span><span class="hljs-comment">9</span>   --<span class="hljs-literal">-</span>
<span class="hljs-comment">xEh</span> <span class="hljs-comment">`~</span>      <span class="hljs-comment">2@</span>      <span class="hljs-comment">5%</span>      <span class="hljs-comment">8*</span>      <span class="hljs-literal">-</span><span class="hljs-comment">_</span>      --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     <span class="hljs-comment">SCROLL</span>  --<span class="hljs-literal">-</span>
<span class="hljs-comment">xFh</span> --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span>     --<span class="hljs-literal">-</span></code></pre><h3 id="special-keyboard-scancodes"><a class="header-link" href="#special-keyboard-scancodes"></a>Special Keyboard Scancodes</h3>
<pre class="hljs"><code><span class="hljs-number">E0h</span> <span class="hljs-number">11h</span>     RALT / ALT-GR
<span class="hljs-number">E0h</span> <span class="hljs-number">14h</span>     RCTRL
<span class="hljs-number">E0h</span> <span class="hljs-number">1Fh</span>     LSUPER
<span class="hljs-number">E0h</span> <span class="hljs-number">27h</span>     RSUPER
<span class="hljs-number">E0h</span> <span class="hljs-number">2Fh</span>     MENU
<span class="hljs-number">E0h</span> <span class="hljs-number">3Fh</span>     SLEEP
<span class="hljs-number">E0h</span> <span class="hljs-number">37h</span>     POWER
<span class="hljs-number">E0h</span> <span class="hljs-number">4Ah</span>     NUM-<span class="hljs-keyword">DIV</span>
<span class="hljs-number">E0h</span> <span class="hljs-number">5Ah</span>     NUM-<span class="hljs-keyword">RET</span>
<span class="hljs-number">E0h</span> <span class="hljs-number">5Eh</span>     WAKE
<span class="hljs-number">E0h</span> <span class="hljs-number">69h</span>     END
<span class="hljs-number">E0h</span> <span class="hljs-number">6Bh</span>     LEFT
<span class="hljs-number">E0h</span> <span class="hljs-number">6Ch</span>     HOME
<span class="hljs-number">E0h</span> <span class="hljs-number">70h</span>     INSERT
<span class="hljs-number">E0h</span> <span class="hljs-number">71h</span>     DELETE
<span class="hljs-number">E0h</span> <span class="hljs-number">72h</span>     <span class="hljs-meta">DOWN</span>
<span class="hljs-number">E0h</span> <span class="hljs-number">74h</span>     RIGHT
<span class="hljs-number">E0h</span> <span class="hljs-number">75h</span>     <span class="hljs-meta">UP</span>
<span class="hljs-number">E0h</span> <span class="hljs-number">7Ah</span>     PG-DN
<span class="hljs-number">E0h</span> <span class="hljs-number">7Dh</span>     PG-<span class="hljs-meta">UP</span>
<span class="hljs-number">E0h</span> <span class="hljs-number">7Eh</span>     CTRL+BREAK</code></pre><p>For PRTSCR key, it is emulated as pressing LSHIFT+NUM-MUL with special key
byte E0h applied to all emulated keys (<code>E0h 12h E0h 7Ch</code>). This might explain
why it drops the first emulated key if SHIFT or CTRL is currently pressed.</p>
<p>For PAUSE key, it is emulated as a complete press of RCTRL+NUMLOCK combination
with byte E1h instead of usual E0h (<code>E1h 14h 77h E1h F0h 14h F0h 77h</code>). Doesn&#39;t
generate any scancodes when released.</p>
<p>The following are multimedia keys which not all keyboards have them:</p>
<pre class="hljs"><code><span class="hljs-number">E0h</span> <span class="hljs-number">15h</span>     Previous Track
<span class="hljs-number">E0h</span> <span class="hljs-number">21h</span>     Volume <span class="hljs-meta">Down</span>
<span class="hljs-number">E0h</span> <span class="hljs-number">23h</span>     Mute
<span class="hljs-number">E0h</span> <span class="hljs-number">2Bh</span>     Calculator
<span class="hljs-number">E0h</span> <span class="hljs-number">32h</span>     Volume <span class="hljs-meta">Up</span>
<span class="hljs-number">E0h</span> <span class="hljs-number">34h</span>     Play/<span class="hljs-keyword">Pause</span>
<span class="hljs-number">E0h</span> <span class="hljs-number">3Bh</span>     Stop
<span class="hljs-number">E0h</span> <span class="hljs-number">40h</span>     My Computer
<span class="hljs-number">E0h</span> <span class="hljs-number">48h</span>     E-Mail
<span class="hljs-number">E0h</span> <span class="hljs-number">4Dh</span>     Next Track
<span class="hljs-number">E0h</span> <span class="hljs-number">50h</span>     Media Select</code></pre><h3 id="mouse-modes"><a class="header-link" href="#mouse-modes"></a>Mouse Modes</h3>
<p>The PS/2 mouse has 3 different modes of operation which can be set by host
write commands. These are:</p>
<ul class="list">
<li>Stream Mode (default) - The mouse sends a movement data whenever it detects a
movement or button change if data reporting is enabled. The maximum rate it
will do this depends on the sample rate setting.</li>
<li>Remote Mode - The mouse never sends a movement data but still internally
samples and updates movements. The host can make it send movement data by
sending the Read Data (EBh) command.</li>
<li>Wrap Mode - The mouse echoes any written commands back and does nothing,
except ECh (Wrap Mode Disable) and FFh (Reset).</li>
</ul>
<h3 id="mouse-data"><a class="header-link" href="#mouse-data"></a>Mouse Data</h3>
<p>The standard PS/2 mouse (which doesn&#39;t have scroll wheels) sends the following
3-byte data:</p>
<pre class="hljs"><code>Byte 0
  Bit 7     Y Overflow (<span class="hljs-attribute">0</span>=<span class="hljs-literal">No</span> Overflow, <span class="hljs-attribute">1</span>=Overflow)
  Bit 6     X Overflow (<span class="hljs-attribute">0</span>=<span class="hljs-literal">No</span> Overflow, <span class="hljs-attribute">1</span>=Overflow)
  Bit 5     Y Sign (<span class="hljs-attribute">0</span>=Positive, <span class="hljs-attribute">1</span>=Negative)
  Bit 4     X Sign (<span class="hljs-attribute">0</span>=Positive, <span class="hljs-attribute">1</span>=Negative)
  Bit 3     <span class="hljs-keyword">Not</span> Used
  Bit 2     Middle Button (<span class="hljs-attribute">0</span>=Released, <span class="hljs-attribute">1</span>=Pressed)
  Bit 1     Right Button (<span class="hljs-attribute">0</span>=Released, <span class="hljs-attribute">1</span>=Pressed)
  Bit 0     Left Button (<span class="hljs-attribute">0</span>=Released, <span class="hljs-attribute">1</span>=Pressed)
Byte 1      X Movement
Byte 2      Y Movement</code></pre><p>X/Y&#39;s movement byte and sign bit together combines to a 9-bit two&#39;s complement
signed number. If a movement exceeds this range then its appropriate overflow
bit is set.</p>
<p>For a mouse with scroll wheels, it still sends the 3-byte data above to retain
compatibility with existing drivers. In order to read a scroll wheel data, an
extra command sequence needs to be performed to put the mouse in a new mode
where an extra byte is also sent in addition to the standard 3-byte data:</p>
<pre class="hljs"><code><span class="hljs-function"><span class="hljs-title">Byte</span></span> <span class="hljs-number">3</span>      Scrolling wheel movement change (<span class="hljs-number">-8.</span><span class="hljs-number">.7</span>)
            (upper <span class="hljs-number">4</span> bits are <span class="hljs-built_in">sign</span> extensions)

Commands:
  <span class="hljs-keyword">Set</span> sample <span class="hljs-comment">rate to 200</span>
  <span class="hljs-keyword">Set</span> <span class="hljs-comment">sample rate to 100</span>
  <span class="hljs-keyword">Set</span> <span class="hljs-comment">sample rate to 80</span>
  Send <span class="hljs-comment">Read ID command (F2h), the mouse should response with 03h instead of 00h</span></code></pre><p>or</p>
<pre class="hljs"><code><span class="hljs-attribute">Byte</span> <span class="hljs-number">3</span>
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">7</span>-<span class="hljs-number">6</span>   Not Used
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">5</span>     <span class="hljs-number">5</span>th Button (<span class="hljs-number">0</span>=Released, <span class="hljs-number">1</span>=Pressed)
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">4</span>     <span class="hljs-number">4</span>th Button (<span class="hljs-number">0</span>=Released, <span class="hljs-number">1</span>=Pressed)
  <span class="hljs-attribute">Bit</span> <span class="hljs-number">3</span>-<span class="hljs-number">0</span>   Scrolling wheel movement change (-<span class="hljs-number">8</span>..<span class="hljs-number">7</span>)

<span class="hljs-attribute">Commands</span>:
  <span class="hljs-attribute">Set</span> sample rate to <span class="hljs-number">200</span>
  <span class="hljs-attribute">Set</span> sample rate to <span class="hljs-number">200</span>
  <span class="hljs-attribute">Set</span> sample rate to <span class="hljs-number">80</span>
  <span class="hljs-attribute">Send</span> Read ID command (F<span class="hljs-number">2</span>h), the mouse should response with <span class="hljs-number">04</span>h instead of <span class="hljs-number">00</span>h</code></pre><p>There&#39;s also a two-axis scroll wheel mouse that uses the above format. For
this, vertical scrolls are reported as +/- 1 changes and horizontal scrolls are
reported as +/- 2 changes.</p>
<h3 id="host-write-commands"><a class="header-link" href="#host-write-commands"></a>Host Write Commands</h3>
<p>Most commands here will make the device send FAh back for a successful
acknowledgement or FEh (resend) if an invalid command or argument is received
or FCh if an error occurred, unless noted otherwise. For mouse, movement
counters will also be reset. All Not Used bits should always be 0.</p>
<p>Keyboard</p>
<pre class="hljs"><code>FFh         Reset - Keyboard will reset itself <span class="hljs-built_in">and</span> redo the self-test
FEh         Resend - Keyboard will resend the last data that<span class="hljs-comment">&#x27;s not this command</span>
FDh nn ..*  <span class="hljs-keyword">Set</span> <span class="hljs-keyword">Key</span> Type Make
FCh nn ..*  <span class="hljs-keyword">Set</span> <span class="hljs-keyword">Key</span> Type Make/Break
FBh nn ..*  <span class="hljs-keyword">Set</span> <span class="hljs-keyword">Key</span> Type Make/Typematic
              These <span class="hljs-number">3</span> commands are multi-<span class="hljs-type">byte</span>. nn indicates <span class="hljs-keyword">each</span> <span class="hljs-keyword">set</span> <span class="hljs-number">3</span> scancode
              <span class="hljs-keyword">to</span> <span class="hljs-keyword">set</span> mode flags <span class="hljs-keyword">to</span>. The keyboard will generate FAh <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span>
              scancode received <span class="hljs-built_in">and</span> will <span class="hljs-built_in">not</span> scan any keys during this process.
              This command <span class="hljs-built_in">is</span> terminated <span class="hljs-keyword">by</span> sending an invalid scancode
FAh*        <span class="hljs-keyword">Set</span> All Keys Make/Break/Typematic
F9h*        <span class="hljs-keyword">Set</span> All Keys Make
F8h*        <span class="hljs-keyword">Set</span> All Keys Make/Break
F7h*        <span class="hljs-keyword">Set</span> All Keys Make/Typematic
F6h         <span class="hljs-keyword">Set</span> <span class="hljs-keyword">Default</span> - Revert <span class="hljs-keyword">to</span> the <span class="hljs-keyword">default</span> settings <span class="hljs-keyword">on</span> power-<span class="hljs-keyword">on</span>/reset
              <span class="hljs-keyword">Default</span> settings are:
              Scancode <span class="hljs-keyword">set</span> <span class="hljs-number">2</span>, All Keys Make/Break/Typematic,
              Typematic Rate <span class="hljs-number">10.9</span> <span class="hljs-keyword">key</span>/s, Typematic Delay <span class="hljs-number">500</span>ms
F5h         Disable - Keyboard stops scanning <span class="hljs-built_in">and</span> loads <span class="hljs-keyword">default</span> settings
F4h         Enable - Keyboard starts scanning again
F3h nn      <span class="hljs-keyword">Set</span> Typematic Rate/Delay
              Bit <span class="hljs-number">7</span>     <span class="hljs-built_in">Not</span> Used
              Bit <span class="hljs-number">6</span>-<span class="hljs-number">5</span>   Delay; (n+<span class="hljs-number">1</span>)*<span class="hljs-number">250</span> ms
              Bit <span class="hljs-number">4</span>-<span class="hljs-number">0</span>   Rate; <span class="hljs-number">30</span>/<span class="hljs-number">2</span>^(n/<span class="hljs-number">8</span>) keys/s
F2h         Read ID - Keyboard responds <span class="hljs-keyword">with</span> a two-<span class="hljs-type">byte</span> ID
F0h nn      <span class="hljs-keyword">Set</span>/Read scancode <span class="hljs-keyword">set</span>
              <span class="hljs-number">0</span>    = Read (will respond <span class="hljs-keyword">with</span> FAh <span class="hljs-keyword">then</span> the current <span class="hljs-keyword">set</span>)
              <span class="hljs-number">1</span>..<span class="hljs-number">3</span> = <span class="hljs-keyword">Set</span> scancode <span class="hljs-keyword">set</span> <span class="hljs-number">1</span>-<span class="hljs-number">3</span>
EEh         Echo - Keyboard responds EEh back
EDh nn      <span class="hljs-keyword">Set</span>/Reset Indicators
              Bit <span class="hljs-number">7</span>-<span class="hljs-number">3</span>   <span class="hljs-built_in">Not</span> Used
              Bit <span class="hljs-number">2</span>     Caps Lock LED (<span class="hljs-number">0</span>=<span class="hljs-keyword">Off</span>, <span class="hljs-number">1</span>=<span class="hljs-keyword">On</span>)
              Bit <span class="hljs-number">1</span>     Num Lock LED (<span class="hljs-number">0</span>=<span class="hljs-keyword">Off</span>, <span class="hljs-number">1</span>=<span class="hljs-keyword">On</span>)
              Bit <span class="hljs-number">0</span>     Scroll Lock LED (<span class="hljs-number">0</span>=<span class="hljs-keyword">Off</span>, <span class="hljs-number">1</span>=<span class="hljs-keyword">On</span>)</code></pre><p><small>* Only has an effect when the keyboard is using scancode set 3</small></p>
<p>Mouse</p>
<pre class="hljs"><code><span class="hljs-attribute">FFh</span>         Reset - Mouse will reset itself and redo the self-test
<span class="hljs-attribute">FEh</span>         Resend - Mouse will resend the last data that&#x27;s not this command
<span class="hljs-attribute">F6h</span>         Set Default - Revert to the default settings <span class="hljs-literal">on</span> power-<span class="hljs-literal">on</span>/reset
              <span class="hljs-attribute">Default</span> settings are:
              <span class="hljs-attribute">Sample</span> Rate <span class="hljs-number">100</span>Hz, Resolution <span class="hljs-number">4</span> dot/mm, <span class="hljs-number">1</span>:<span class="hljs-number">1</span> Scaling,
              <span class="hljs-attribute">Stream</span> Mode, Data Reporting Disabled
<span class="hljs-attribute">F5h</span>         Disable Data Reporting
<span class="hljs-attribute">F4h</span>         Enable Data Reporting
              <span class="hljs-attribute">These</span> <span class="hljs-number">2</span> commands only has an effect in Stream mode but can be set
              <span class="hljs-attribute">in</span> any mode.
<span class="hljs-attribute">F3h</span> nn      Set Sample Rate; n=<span class="hljs-number">10</span>,<span class="hljs-number">20</span>,<span class="hljs-number">40</span>,<span class="hljs-number">60</span>,<span class="hljs-number">80</span>,<span class="hljs-number">100</span>,<span class="hljs-number">200</span> Hz
<span class="hljs-attribute">F2h</span>         Read ID - Mouse responds with FAh then a one-byte ID
<span class="hljs-attribute">F0h</span>         Set Remote Mode
<span class="hljs-attribute">EEh</span>         Set Wrap Mode
<span class="hljs-attribute">ECh</span>         Reset Wrap Mode
<span class="hljs-attribute">EBh</span>         Read Data - Mouse responds with FAh then send movement data
<span class="hljs-attribute">EAh</span>         Set Stream Mode
<span class="hljs-attribute">E9h</span>         Status Request - Mouse responds with following <span class="hljs-number">4</span>-byte data:
              <span class="hljs-attribute">Byte</span> <span class="hljs-number">0</span>    FAh (acknowledgement)
              <span class="hljs-attribute">Byte</span> <span class="hljs-number">1</span>
                <span class="hljs-attribute">Bit</span> <span class="hljs-number">7</span>   Not Used
                <span class="hljs-attribute">Bit</span> <span class="hljs-number">6</span>   Mode (<span class="hljs-number">0</span>=Stream, <span class="hljs-number">1</span>=Remote)
                <span class="hljs-attribute">Bit</span> <span class="hljs-number">5</span>   Data Reporting (<span class="hljs-number">0</span>=Disabled, <span class="hljs-number">1</span>=Enabled)
                <span class="hljs-attribute">Bit</span> <span class="hljs-number">4</span>   Scaling (<span class="hljs-number">0</span>=<span class="hljs-number">1</span>:<span class="hljs-number">1</span>, <span class="hljs-number">1</span>=<span class="hljs-number">2</span>:<span class="hljs-number">1</span>)
                <span class="hljs-attribute">Bit</span> <span class="hljs-number">3</span>   Not Used
                <span class="hljs-attribute">Bit</span> <span class="hljs-number">2</span>   Left Button (<span class="hljs-number">0</span>=Released, <span class="hljs-number">1</span>=Pressed)
                <span class="hljs-attribute">Bit</span> <span class="hljs-number">1</span>   Middle Button (<span class="hljs-number">0</span>=Released, <span class="hljs-number">1</span>=Pressed)
                <span class="hljs-attribute">Bit</span> <span class="hljs-number">0</span>   Right Button (<span class="hljs-number">0</span>=Released, <span class="hljs-number">1</span>=Pressed)
              <span class="hljs-attribute">Byte</span> <span class="hljs-number">2</span>    Resolution
              <span class="hljs-attribute">Byte</span> <span class="hljs-number">3</span>    Sample Rate
<span class="hljs-attribute">E8h</span> nn      Set Resolution (<span class="hljs-number">0</span>=<span class="hljs-number">1</span>, <span class="hljs-number">1</span>=<span class="hljs-number">2</span>, <span class="hljs-number">2</span>=<span class="hljs-number">4</span>, <span class="hljs-number">3</span>=<span class="hljs-number">8</span> dot/mm)
<span class="hljs-attribute">E7h</span>         Set <span class="hljs-number">2</span>:<span class="hljs-number">1</span> Scaling
<span class="hljs-attribute">E6h</span>         Set <span class="hljs-number">1</span>:<span class="hljs-number">1</span> Scaling</code></pre><h2 id="x16-joypad-interface-snes-controllers"><a class="header-link" href="#x16-joypad-interface-snes-controllers"></a>X16 Joypad Interface (SNES Controllers)</h2>
<p>X16 has 2 SNES-compatible joypad connectors for up to 4 connected joypads at
the same time. However, being connected to VIA, there is no auto-read feature
or even legacy auto-shift on read feature like in SNES. Instead, all read/write
operations have to be done manually in a bit-banging fashion.</p>
<h3 id="x16-joypad-access"><a class="header-link" href="#x16-joypad-access"></a>X16 Joypad Access</h3>
<p>The below timing diagram shows how to read a data from joypads that use typical
Parallel-Load Shift Registers. STB is set low in order to load all parallel
inputs into the shift register. Any CLK signals during STB low will be ignored.
Once STB is set high, any rising edge of CLK signal will shift the register out
by one bit. If nothing is connected to a port, the data at that port will
be pulled up and always read 1.</p>
<pre class="hljs"><code>     __       ________________________________
STB    |<span class="hljs-string">_____</span>|
     ___   _   _   _   _   _   _   _   _   ___
CLK    :|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|
     __:______ ___ ___ ___ ___ ___ ___ ___ ___
JOY1 __|<span class="hljs-string">______</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|___
     __:______ ___ ___ ___ ___ ___ ___ ___ ___
JOY2 __|<span class="hljs-string">______</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|___
     __:______ ___ ___ ___ ___ ___ ___ ___ ___
JOY3 __|<span class="hljs-string">______</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|___
     __:______ ___ ___ ___ ___ ___ ___ ___ ___
JOY4 __|<span class="hljs-string">______</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|___
         1st   2nd 3rd 4th 5th 6th 7th 8th ...</code></pre><p>Unlike SNES (and its predecessor NES), VIA doesn&#39;t invert joypad signals
internally. This means that any read and write data will be inverted compared
to SNES in software&#39;s point of view.</p>
<h3 id="standard-snes-joypad-bits"><a class="header-link" href="#standard-snes-joypad-bits"></a>Standard SNES Joypad Bits</h3>
<pre class="hljs"><code>1st         B Button        (<span class="hljs-attribute">0</span>=Pressed, <span class="hljs-attribute">1</span>=Released)
2nd         Y Button        (<span class="hljs-attribute">0</span>=Pressed, <span class="hljs-attribute">1</span>=Released)
3rd         Select Button   (<span class="hljs-attribute">0</span>=Pressed, <span class="hljs-attribute">1</span>=Released)
4th         Start Button    (<span class="hljs-attribute">0</span>=Pressed, <span class="hljs-attribute">1</span>=Released)
5th         D-Pad Up        (<span class="hljs-attribute">0</span>=Pressed, <span class="hljs-attribute">1</span>=Released)
6th         D-Pad Down      (<span class="hljs-attribute">0</span>=Pressed, <span class="hljs-attribute">1</span>=Released)
7th         D-Pad Left      (<span class="hljs-attribute">0</span>=Pressed, <span class="hljs-attribute">1</span>=Released)
8th         D-Pad Right     (<span class="hljs-attribute">0</span>=Pressed, <span class="hljs-attribute">1</span>=Released)
9th         A Button        (<span class="hljs-attribute">0</span>=Pressed, <span class="hljs-attribute">1</span>=Released)
10th        X Button        (<span class="hljs-attribute">0</span>=Pressed, <span class="hljs-attribute">1</span>=Released)
11th        L Button        (<span class="hljs-attribute">0</span>=Pressed, <span class="hljs-attribute">1</span>=Released)
12th        R Button        (<span class="hljs-attribute">0</span>=Pressed, <span class="hljs-attribute">1</span>=Released)
13th        ID Bit 3        (usually 1)
14th        ID Bit 2        (usually 1)
15th        ID Bit 1        (usually 1)
16th        ID Bit 0        (usually 1)
17th <span class="hljs-keyword">and</span> up Padding         (always 0) (<span class="hljs-keyword">or</span> 1 when<span class="hljs-built_in"> port </span>is <span class="hljs-keyword">not</span> connected)</code></pre><h3 id="other-snes-controllersdevices"><a class="header-link" href="#other-snes-controllersdevices"></a>Other SNES Controllers/Devices</h3>
<p>It&#39;s possible to connect any other devices aside of SNES controllers to the
port as long as they are electrically compatible and there&#39;s a software to read
them. Although note that as seen in VIA connections section, IO6 and IO7 (Pin 6
on each of the connectors) are not connected to anything. Which means it&#39;s
impossible to interface devices that use those lines. For documentation of
devices that connect to SNES controller ports during its lifetime, see SNES
Controllers section in Fullsnes:<br><a href="http://problemkaputt.de/fullsnes.htm">http://problemkaputt.de/fullsnes.htm</a><br><a href="http://problemkaputt.de/fullsnes.txt">http://problemkaputt.de/fullsnes.txt</a></p>
<h2 id="x16-iec-interface-commodore-disk-drivesprinters"><a class="header-link" href="#x16-iec-interface-commodore-disk-drivesprinters"></a>X16 IEC Interface (Commodore Disk Drives/Printers)</h2>
<p>X16 has one connector for Commodore Serial IEEE-488 Bus (shortly referred as
IEC Bus). Which is a cheaper serial version of IEEE-488 interface used
throughout Commodore&#39;s 8-bit computers since VIC-20 for disk drives and
printers. The interface is a 3-wire serial containing ATN line which works
similarly to CS line in SPI but is also used to send special commands to
select which device to send/receive a data after this or even switch roles
around. Allowing many devices to be on a same bus.</p>
<p>(under construction)</p>
<blockquote>
<p>At the time of writing, support for this bus is not even implemented yet in
Kernal. I have a feeling that it will likely be removed in the future so I&#39;m
not going to risk it and finish this section later.</p>
</blockquote>
<h1 id="x16-i2c-bus"><a class="header-link" href="#x16-i2c-bus"></a>X16 I2C Bus</h1>
<p>Aside of the main address/data bus, X16 also has an I2C bus which is a 2-wire
serial bus for communicating with some more low-cost and low pin count devices
that don&#39;t require fast data transfers.</p>
<h3 id="internal-i2c-devices"><a class="header-link" href="#internal-i2c-devices"></a>Internal I2C Devices</h3>
<p>Device 42h: <a href="#x16-system-management-controller">X16 System Management Controller</a><br>Device 6Fh: <a href="#mcp7940n-real-time-clock">MCP7940N Real-Time Clock</a>  </p>
<h2 id="x16-i2c-bus-access"><a class="header-link" href="#x16-i2c-bus-access"></a>X16 I2C Bus Access</h2>
<p>Despite having only one clock and one data line, the bus is capable of holding
many devices. Each device has a unique device address which the host has to
address them before reading/writing a data. When other devices detect that the
address isn&#39;t theirs, they will just ignore the whole data after until a stop
bit is sent or the clock line goes inactive. This allows the host to be able
to talk to only one device at a time.</p>
<p>The host always drive the clock line (SCL), but it&#39;s possible that the device
will keep pulling the clock line low to signal that it&#39;s still busy. The
maximum frequency is usually 400kHz. Below timing diagram shows how to
read/write a data for this bus:</p>
<pre class="hljs"><code>    Start        Device Address       R/W&#x27; Ack     Data Bytes      Ack   Stop
    <span class="hljs-variable">&lt;----&gt;</span><span class="hljs-variable">&lt;--------------------------&gt;</span><span class="hljs-variable">&lt;--&gt;</span><span class="hljs-variable">&lt;--&gt;</span><span class="hljs-variable">&lt;------------------&gt;</span><span class="hljs-variable">&lt;----&gt;</span><span class="hljs-variable">&lt;----&gt;</span>
    _____   _   _   _   _   _   _   _   _   _   _   _       _   _   _   ______
SCL      |<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">/ /</span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|
    __     ___ ___ ___ ___ ___ ___ ___ ___     ___ ___/ /_ ___ ___         ___
SDA   |<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___/ /_</span>|<span class="hljs-string">___</span>|<span class="hljs-string">___</span>|<span class="hljs-string">_______</span>|
     START  7   6   5   4   3   2   1   0  ACK  7   6 ...   1   0  ACK  STOP</code></pre><p>Data transfer starts with pulling the data line low to signal the start
condition to every devices in the bus. Then begin writing a data every
falling edge of the clock (the device will read it at the rising edge). After
each byte transferred, the device will send acknowledge bit back. Read this at
the rising edge of the clock to determine if addressed devices exist and
successfully received a byte. After all bytes are transferred, clock one more
bit and then release the clock line and data line after to signal the stop
condition. For read process (R/W&#39; bit is 1), the roles on the data line are
reversed after the first Ack: the device puts a data and the host sends
acknowledge bit instead. Sometimes a read data is infinite in length and
requires a no acknowledge (NoAck) bit to stop the device from sending more.</p>
<p>It is also possible to turn X16 into an I2C device since the VIA allows its CB2
pin, which is connected to the clock line, to be an input that generates an
interrupt on both signal edges. When an (external) host drives the SCK line, it
will generate NMI on the X16 to begin and resume the communication process any
time.</p>
<h2 id="x16-system-management-controller"><a class="header-link" href="#x16-system-management-controller"></a>X16 System Management Controller</h2>
<p>Device 42h is a system management controller. This device monitors power usages
and communicates with the power supply, front panel buttons and LEDs. It also
accepts I2C commands for a software control of those from the main system. The
chip used for this is an ATtiny84A microcontroller with a custom Arduino-based
firmware.</p>
<p>Since the microcontroller uses flash memory to store a firmware, it&#39;s possible
to program this system management controller externally. However the details
about this will not be covered in this document since it&#39;s considered outside
the X16 software development scope and the microcontroller itself is quite a
complex piece of hardware.</p>
<h3 id="transfer-sequences"><a class="header-link" href="#transfer-sequences"></a>Transfer Sequences</h3>
<pre class="hljs"><code><span class="hljs-keyword">Write</span> Command   <span class="hljs-literal">Start</span> <span class="hljs-number">84h</span> Ack <span class="hljs-tag">&lt;CMD&gt;</span> Ack <span class="hljs-tag">&lt;VAL&gt;</span> Ack <span class="hljs-literal">Stop</span></code></pre><h3 id="commands"><a class="header-link" href="#commands"></a>Commands</h3>
<pre class="hljs"><code>CMD     VAL     Description
<span class="hljs-number">01</span><span class="hljs-built_in">h</span>     <span class="hljs-number">00</span><span class="hljs-built_in">h</span>     Power Off
<span class="hljs-number">01</span><span class="hljs-built_in">h</span>     <span class="hljs-number">01</span><span class="hljs-built_in">h</span>     Hard Reset
<span class="hljs-number">02</span><span class="hljs-built_in">h</span>     <span class="hljs-number">00</span><span class="hljs-built_in">h</span>     Soft Reset
<span class="hljs-number">03</span><span class="hljs-built_in">h</span>     <span class="hljs-number">00</span><span class="hljs-built_in">h</span>     NMI
<span class="hljs-number">04</span><span class="hljs-built_in">h</span>     nnh     Power LED Brightness (<span class="hljs-number">0</span><span class="hljs-literal">-255</span>)
<span class="hljs-number">05</span><span class="hljs-built_in">h</span>     nnh     Activity LED Brightness (<span class="hljs-number">0</span><span class="hljs-literal">-255</span>)</code></pre><h2 id="mcp7940n-real-time-clock"><a class="header-link" href="#mcp7940n-real-time-clock"></a>MCP7940N Real-Time Clock</h2>
<p>Device 6Fh is a real-time clock chip that keeps the system time running across
power cycles and provides 64 bytes of battery-backed SRAM (which is called RTC
NVRAM in earlier sections) for any data storage.</p>
<h3 id="transfer-sequences-1"><a class="header-link" href="#transfer-sequences-1"></a>Transfer Sequences</h3>
<pre class="hljs"><code><span class="hljs-keyword">Write</span>           <span class="hljs-literal">Start</span> DEh Ack <span class="hljs-tag">&lt;ADDR&gt;</span> Ack <span class="hljs-tag">&lt;DATA&gt;</span> Ack ... <span class="hljs-tag">&lt;DATA&gt;</span> Ack <span class="hljs-literal">Stop</span>
Address <span class="hljs-keyword">Read</span>    <span class="hljs-literal">Start</span> DFh Ack <span class="hljs-tag">&lt;ADDR&gt;</span> NoAck <span class="hljs-literal">Stop</span>
<span class="hljs-keyword">Read</span>            <span class="hljs-literal">Start</span> DEh Ack <span class="hljs-tag">&lt;ADDR&gt;</span> Ack
                <span class="hljs-literal">Start</span> DFh Ack <span class="hljs-tag">&lt;DATA&gt;</span> Ack ... <span class="hljs-tag">&lt;DATA&gt;</span> NoAck <span class="hljs-literal">Stop</span></code></pre><p>Writing or reading a byte to this chip will automatically increment the address
set by last Write/Read commands. You can read the current address by issuing
Address Read command, which the chip will send it back in ADDR field.</p>
<p>Random reading requires an address to be set first with I2C write and then send
a start bit again without stopping the current sequence. This will signal the
chip to stop accepting data bits and prepare for data read process instead.
Then, send I2C read and start reading data bytes. Once finish, send NoAck
instead of Ack bit to end the transfer.</p>
<h3 id="multi-function-pin"><a class="header-link" href="#multi-function-pin"></a>Multi-function Pin</h3>
<blockquote>
<p>Is this pin actually connected to anywhere in X16? The current hardware seems
to not doing so. Not going to document this here until it&#39;s actually used...</p>
</blockquote>
<h3 id="power-down-and-power-up-timestamps"><a class="header-link" href="#power-down-and-power-up-timestamps"></a>Power-down and Power-up Timestamps</h3>
<p>This real-time clock chip also has a feature where it can detect when the
primary power going to it has went down or went back up again. And store
timestamps when each of those happened. This is useful for the system to check
when an unexpected power-off has occurred and/or how long it&#39;s been turned off.</p>
<h3 id="memory-map"><a class="header-link" href="#memory-map"></a>Memory Map</h3>
<pre class="hljs"><code>Offset      Content
<span class="hljs-number">00h</span>-<span class="hljs-number">1Fh</span>     Configuration Registers
<span class="hljs-number">20h</span>-<span class="hljs-number">5Fh</span>     <span class="hljs-number">64</span>-<span class="hljs-built_in">byte</span> Battery-Backed SRAM (NVRAM)
<span class="hljs-number">60h</span>-<span class="hljs-number">FFh</span>     <span class="hljs-keyword">Not</span> Used (the device will <span class="hljs-keyword">not</span> generate ACK)</code></pre><p>All Not Used bits in the registers are read as zero. Registers 09h, 10h and 17h
are reserved and should not be used.</p>
<h3 id="00h---rtcsec---timekeeping-seconds-rw"><a class="header-link" href="#00h---rtcsec---timekeeping-seconds-rw"></a>00h - RTCSEC - Timekeeping Seconds (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Start Oscillator (<span class="hljs-number">0</span>=Disabled, <span class="hljs-number">1</span>=Enabled)
<span class="hljs-attribute">6</span>-<span class="hljs-number">4</span>     BCD Tens Digit Seconds (<span class="hljs-number">0</span>-<span class="hljs-number">5</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Seconds (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><h3 id="01h---rtcmin---timekeeping-minutes-rw"><a class="header-link" href="#01h---rtcmin---timekeeping-minutes-rw"></a>01h - RTCMIN - Timekeeping Minutes (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Not Used
<span class="hljs-attribute">6</span>-<span class="hljs-number">4</span>     BCD Tens Digit Minutes (<span class="hljs-number">0</span>-<span class="hljs-number">5</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Minutes (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><h3 id="02h---rtchour---timekeeping-hours-rw"><a class="header-link" href="#02h---rtchour---timekeeping-hours-rw"></a>02h - RTCHOUR - Timekeeping Hours (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Not Used
<span class="hljs-attribute">6</span>       Hour Format (<span class="hljs-number">0</span>=<span class="hljs-number">24</span>-hour, <span class="hljs-number">1</span>=<span class="hljs-number">12</span>-hour)
<span class="hljs-attribute">5</span>       AM/PM (<span class="hljs-number">0</span>=AM, <span class="hljs-number">1</span>=PM) (<span class="hljs-number">12</span>-hour only)
<span class="hljs-attribute">5</span>-<span class="hljs-number">4</span>     BCD Tens Digit Hours (<span class="hljs-number">0</span>-<span class="hljs-number">2</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Hours (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><p>For 12-hour clock, BCD Ten Hours value only goes up to 1. Which means bit 5 is
never used and repurposed to store AM/PM flag.</p>
<h3 id="03h---rtcwkday---timekeeping-weekday-rw"><a class="header-link" href="#03h---rtcwkday---timekeeping-weekday-rw"></a>03h - RTCWKDAY - Timekeeping Weekday (R/W)</h3>
<pre class="hljs"><code>Bit
7-6     <span class="hljs-keyword">Not</span> Used
5       Oscillator Status (<span class="hljs-attribute">0</span>=Disabled/Stopped, <span class="hljs-attribute">1</span>=Enabled/Running) (Read-only)
4       Power Failure Status (<span class="hljs-attribute">1</span>=Power lost)
3       Battery Backup <span class="hljs-builtin-name">Enable</span> (<span class="hljs-attribute">0</span>=Disabled, <span class="hljs-attribute">1</span>=Enabled)
2-0     Day of Week (1-7)</code></pre><p>Power Failure Status indicates that the primary power to this chip had been
lost and a power-down timestamp has been loaded (see registers 18h-1Bh).
Writing to this register will reset this bit and the entire power-down
timestamp registers. Allowing any new power-down events to be recorded again
(any newer power-down events will not overwrite the old timestamp).</p>
<p>Day of Week value meanings are user-defined. For X16 System, a value of 1
means Sunday (?)</p>
<h3 id="04h---rtcdate---timekeeping-date-rw"><a class="header-link" href="#04h---rtcdate---timekeeping-date-rw"></a>04h - RTCDATE - Timekeeping Date (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">6</span>     Not Used
<span class="hljs-attribute">5</span>-<span class="hljs-number">4</span>     BCD Tens Digit Date (<span class="hljs-number">0</span>-<span class="hljs-number">3</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Date (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><h3 id="05h---rtcmth---timekeeping-month-rw"><a class="header-link" href="#05h---rtcmth---timekeeping-month-rw"></a>05h - RTCMTH - Timekeeping Month (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">6</span>     Not Used
<span class="hljs-attribute">5</span>       Leap Year (<span class="hljs-number">1</span>=Leap Year) (Read-Only)
<span class="hljs-attribute">4</span>       BCD Tens Digit Month (<span class="hljs-number">0</span>-<span class="hljs-number">1</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Month (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><h3 id="06h---rtcyear---timekeeping-year-rw"><a class="header-link" href="#06h---rtcyear---timekeeping-year-rw"></a>06h - RTCYEAR - Timekeeping Year (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">4</span>     BCD Tens Digit Year (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Year (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><p>The RTC chip can only stores two digits of years and treats year xx00 as not
being a leap year per Gregorian calendar rules. This gives a correct date
keeping up to year 2399, assuming the chip still survives. Of course.</p>
<h3 id="07h---control---control-rw"><a class="header-link" href="#07h---control---control-rw"></a>07h - CONTROL - Control (R/W)</h3>
<pre class="hljs"><code>Bit
7       General Purpose Output (<span class="hljs-attribute">0</span>=Low, <span class="hljs-attribute">1</span>=High)
6       Square Wave Output (<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
5       Alarm 1 <span class="hljs-builtin-name">Enable</span> (<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
4       Alarm 0 <span class="hljs-builtin-name">Enable</span> (<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
3       External Oscillator Input (<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
2       Coarse Trim Mode (<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
1-0     Square Wave Output Frequency
          <span class="hljs-keyword">If</span> Coarse Trim is disabled:
            0 = 1 Hz (trimmed)
            1 = 4096 Hz (trimmed)
            2 = 8192 Hz (trimmed)
            3 = 32768 Hz (<span class="hljs-keyword">not</span> trimmed)
          <span class="hljs-keyword">Else</span>: 64 Hz (trimmed)</code></pre><h3 id="08h---osctrim---oscillator-digital-trim-rw"><a class="header-link" href="#08h---osctrim---oscillator-digital-trim-rw"></a>08h - OSCTRIM - Oscillator Digital Trim (R/W)</h3>
<pre class="hljs"><code>Bit
7       Trim Sign (<span class="hljs-attribute">1</span>=Subtract-&gt;Faster, <span class="hljs-attribute">0</span>=Add-&gt;Slower)
6-0     Trim Value (<span class="hljs-attribute">0</span>=Disable Trimming)</code></pre><p>The values can be treated as one&#39;s complement number n which will add/subtract
2n cycles every minute normally or at 128Hz when Coarse Trim is enabled.</p>
<h3 id="0ah---alm0sec---alarm-0-seconds-rw"><a class="header-link" href="#0ah---alm0sec---alarm-0-seconds-rw"></a>0Ah - ALM0SEC - Alarm 0 Seconds (R/W)</h3>
<h3 id="11h---alm1sec---alarm-1-seconds-rw"><a class="header-link" href="#11h---alm1sec---alarm-1-seconds-rw"></a>11h - ALM1SEC - Alarm 1 Seconds (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Not Used
<span class="hljs-attribute">6</span>-<span class="hljs-number">4</span>     BCD Tens Digit Seconds (<span class="hljs-number">0</span>-<span class="hljs-number">5</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Seconds (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><h3 id="0bh---alm0min---alarm-0-minutes-rw"><a class="header-link" href="#0bh---alm0min---alarm-0-minutes-rw"></a>0Bh - ALM0MIN - Alarm 0 Minutes (R/W)</h3>
<h3 id="12h---alm1min---alarm-1-minutes-rw"><a class="header-link" href="#12h---alm1min---alarm-1-minutes-rw"></a>12h - ALM1MIN - Alarm 1 Minutes (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Not Used
<span class="hljs-attribute">6</span>-<span class="hljs-number">4</span>     BCD Tens Digit Minutes (<span class="hljs-number">0</span>-<span class="hljs-number">5</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Minutes (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><h3 id="0ch---alm0hour---alarm-0-hours-rw"><a class="header-link" href="#0ch---alm0hour---alarm-0-hours-rw"></a>0Ch - ALM0HOUR - Alarm 0 Hours (R/W)</h3>
<h3 id="13h---alm1hour---alarm-1-hours-rw"><a class="header-link" href="#13h---alm1hour---alarm-1-hours-rw"></a>13h - ALM1HOUR - Alarm 1 Hours (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Not Used
<span class="hljs-attribute">6</span>       Hour Format (<span class="hljs-number">0</span>=<span class="hljs-number">24</span>-hour, <span class="hljs-number">1</span>=<span class="hljs-number">12</span>-hour)
<span class="hljs-attribute">5</span>       AM/PM (<span class="hljs-number">0</span>=AM, <span class="hljs-number">1</span>=PM) (<span class="hljs-number">12</span>-hour only)
<span class="hljs-attribute">5</span>-<span class="hljs-number">4</span>     BCD Tens Digit Hours (<span class="hljs-number">0</span>-<span class="hljs-number">2</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Hours (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><h3 id="0dh---alm0wkday---alarm-0-weekday--mask-rw"><a class="header-link" href="#0dh---alm0wkday---alarm-0-weekday--mask-rw"></a>0Dh - ALM0WKDAY - Alarm 0 Weekday / Mask (R/W)</h3>
<h3 id="14h---alm1wkday---alarm-1-weekday--mask-rw"><a class="header-link" href="#14h---alm1wkday---alarm-1-weekday--mask-rw"></a>14h - ALM1WKDAY - Alarm 1 Weekday / Mask (R/W)</h3>
<pre class="hljs"><code>Bit
<span class="hljs-number">7</span>       Alarm Interrupt Output Polarity (<span class="hljs-number">0</span><span class="hljs-operator">=</span>Low, <span class="hljs-number">1</span><span class="hljs-operator">=</span>High)
<span class="hljs-number">6</span><span class="hljs-number">-4</span>     Alarm Mask
          <span class="hljs-number">0</span> <span class="hljs-operator">=</span> Seconds <span class="hljs-keyword">match</span>
          <span class="hljs-number">1</span> <span class="hljs-operator">=</span> Minutes <span class="hljs-keyword">match</span>
          <span class="hljs-number">2</span> <span class="hljs-operator">=</span> Hours <span class="hljs-keyword">match</span> (chip automatically does <span class="hljs-number">12</span><span class="hljs-operator">/</span><span class="hljs-number">24</span><span class="hljs-operator">-</span><span class="hljs-keyword">hour</span> conversion)
          <span class="hljs-number">3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">Day</span> <span class="hljs-keyword">of</span> Week <span class="hljs-keyword">match</span>
          <span class="hljs-number">4</span> <span class="hljs-operator">=</span> <span class="hljs-type">Date</span> <span class="hljs-keyword">match</span>
          <span class="hljs-number">5</span><span class="hljs-number">-6</span> <span class="hljs-operator">=</span> Reserved
          <span class="hljs-number">7</span> <span class="hljs-operator">=</span> Seconds, Minutes, <span class="hljs-keyword">Hour</span>, <span class="hljs-keyword">Day</span> <span class="hljs-keyword">of</span> Week, <span class="hljs-type">Date</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">Month</span> <span class="hljs-keyword">match</span>
<span class="hljs-number">3</span>       Alarm Interrupt Flag (<span class="hljs-number">0</span><span class="hljs-operator">=</span><span class="hljs-keyword">None</span>, <span class="hljs-number">1</span><span class="hljs-operator">=</span>Interrupt Request)
<span class="hljs-number">2</span><span class="hljs-number">-0</span>     <span class="hljs-keyword">Day</span> <span class="hljs-keyword">of</span> Week (<span class="hljs-number">1</span><span class="hljs-number">-7</span>)</code></pre><p>Writing to this register will reset Alarm Interrupt Flag bit. Alarm Interrupt
Output Polarity bit is shared and writable in Alarm 0 counterpart only.</p>
<h3 id="0eh---alm0date---alarm-0-date-rw"><a class="header-link" href="#0eh---alm0date---alarm-0-date-rw"></a>0Eh - ALM0DATE - Alarm 0 Date (R/W)</h3>
<h3 id="15h---alm1date---alarm-1-date-rw"><a class="header-link" href="#15h---alm1date---alarm-1-date-rw"></a>15h - ALM1DATE - Alarm 1 Date (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">6</span>     Not Used
<span class="hljs-attribute">5</span>-<span class="hljs-number">4</span>     BCD Tens Digit Date (<span class="hljs-number">0</span>-<span class="hljs-number">3</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Date (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><h3 id="0fh---alm0mth---alarm-0-month-rw"><a class="header-link" href="#0fh---alm0mth---alarm-0-month-rw"></a>0Fh - ALM0MTH - Alarm 0 Month (R/W)</h3>
<h3 id="16h---alm1mth---alarm-1-month-rw"><a class="header-link" href="#16h---alm1mth---alarm-1-month-rw"></a>16h - ALM1MTH - Alarm 1 Month (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">5</span>     Not Used
<span class="hljs-attribute">4</span>       BCD Tens Digit Month (<span class="hljs-number">0</span>-<span class="hljs-number">1</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Month (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><h3 id="18h---pwrdnmin---power-down-minutes-rw"><a class="header-link" href="#18h---pwrdnmin---power-down-minutes-rw"></a>18h - PWRDNMIN - Power Down Minutes (R/W)</h3>
<h3 id="1ch---pwrupmin---power-up-minutes-rw"><a class="header-link" href="#1ch---pwrupmin---power-up-minutes-rw"></a>1Ch - PWRUPMIN - Power Up Minutes (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Not Used
<span class="hljs-attribute">6</span>-<span class="hljs-number">4</span>     BCD Tens Digit Minutes (<span class="hljs-number">0</span>-<span class="hljs-number">5</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Minutes (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><h3 id="19h---pwrdnhour---power-down-hours-rw"><a class="header-link" href="#19h---pwrdnhour---power-down-hours-rw"></a>19h - PWRDNHOUR - Power Down Hours (R/W)</h3>
<h3 id="1dh---pwruphour---power-up-hours-rw"><a class="header-link" href="#1dh---pwruphour---power-up-hours-rw"></a>1Dh - PWRUPHOUR - Power Up Hours (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Not Used
<span class="hljs-attribute">6</span>       Hour Format (<span class="hljs-number">0</span>=<span class="hljs-number">24</span>-hour, <span class="hljs-number">1</span>=<span class="hljs-number">12</span>-hour)
<span class="hljs-attribute">5</span>       AM/PM (<span class="hljs-number">0</span>=AM, <span class="hljs-number">1</span>=PM) (<span class="hljs-number">12</span>-hour only)
<span class="hljs-attribute">5</span>-<span class="hljs-number">4</span>     BCD Tens Digit Hours (<span class="hljs-number">0</span>-<span class="hljs-number">2</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Hours (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><h3 id="1ah---pwrdndate---power-down-date-rw"><a class="header-link" href="#1ah---pwrdndate---power-down-date-rw"></a>1Ah - PWRDNDATE - Power Down Date (R/W)</h3>
<h3 id="1eh---pwrupdate---power-up-date-rw"><a class="header-link" href="#1eh---pwrupdate---power-up-date-rw"></a>1Eh - PWRUPDATE - Power Up Date (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">6</span>     Not Used
<span class="hljs-attribute">5</span>-<span class="hljs-number">4</span>     BCD Tens Digit Date (<span class="hljs-number">0</span>-<span class="hljs-number">3</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Date (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><h3 id="1bh---pwrdnmth---power-down-month--weekday-rw"><a class="header-link" href="#1bh---pwrdnmth---power-down-month--weekday-rw"></a>1Bh - PWRDNMTH - Power Down Month / Weekday (R/W)</h3>
<h3 id="1fh---pwrupmth---power-up-month--weekday-rw"><a class="header-link" href="#1fh---pwrupmth---power-up-month--weekday-rw"></a>1Fh - PWRUPMTH - Power Up Month / Weekday (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">5</span>     Day of Week (<span class="hljs-number">1</span>-<span class="hljs-number">7</span>)
<span class="hljs-attribute">4</span>       BCD Tens Digit Month (<span class="hljs-number">0</span>-<span class="hljs-number">1</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     BCD Ones Digit Month (<span class="hljs-number">0</span>-<span class="hljs-number">9</span>)</code></pre><h1 id="x16-timings"><a class="header-link" href="#x16-timings"></a>X16 Timings</h1>
<h2 id="x16-timing-oscillators"><a class="header-link" href="#x16-timing-oscillators"></a>X16 Timing Oscillators</h2>
<h3 id="system-timings"><a class="header-link" href="#system-timings"></a>System Timings</h3>
<pre class="hljs"><code><span class="hljs-attribute">System</span> Oscillator       <span class="hljs-number">8</span>.<span class="hljs-number">000000</span>MHz
<span class="hljs-attribute">System</span> Clock            <span class="hljs-number">8</span>.<span class="hljs-number">000000</span>MHz (<span class="hljs-number">8</span>MHz/<span class="hljs-number">1</span>)
<span class="hljs-attribute">CPU</span> Clock               <span class="hljs-number">8</span>.<span class="hljs-number">000000</span>MHz (<span class="hljs-number">8</span>MHz/<span class="hljs-number">1</span>)
<span class="hljs-attribute">RTC</span> Crystal             <span class="hljs-number">32</span>.<span class="hljs-number">76800</span>kHz</code></pre><h3 id="vera-timings"><a class="header-link" href="#vera-timings"></a>VERA Timings</h3>
<pre class="hljs"><code><span class="hljs-attribute">VERA</span> Oscillator         <span class="hljs-number">25</span>.<span class="hljs-number">00000</span>MHz
<span class="hljs-attribute">Progressive</span> Dot Clock   <span class="hljs-number">25</span>.<span class="hljs-number">00000</span>MHz (<span class="hljs-number">25</span>MHz/<span class="hljs-number">1</span>)
<span class="hljs-attribute">Interlaced</span> Dot Clock    <span class="hljs-number">12</span>.<span class="hljs-number">50000</span>MHz (<span class="hljs-number">25</span>MHz/<span class="hljs-number">2</span>)
<span class="hljs-attribute">L</span>/C Color Clock         <span class="hljs-number">3</span>.<span class="hljs-number">571429</span>MHz (<span class="hljs-number">25</span>MHz/<span class="hljs-number">7</span>) (?)
<span class="hljs-attribute">Progressive</span> Line Rate   <span class="hljs-number">31</span>.<span class="hljs-number">25000</span>kHz (<span class="hljs-number">25</span>MHz/<span class="hljs-number">800</span>)
<span class="hljs-attribute">Interlaced</span> Line Rate    <span class="hljs-number">15</span>.<span class="hljs-number">62500</span>kHz (<span class="hljs-number">25</span>MHz/(<span class="hljs-number">800</span>*<span class="hljs-number">2</span>))
<span class="hljs-attribute">Progressive</span> Frame Rate  <span class="hljs-number">59</span>.<span class="hljs-number">523810</span>Hz (<span class="hljs-number">25</span>MHz/(<span class="hljs-number">525</span>*<span class="hljs-number">800</span>))
<span class="hljs-attribute">Interlaced</span> Frame Rate   <span class="hljs-number">29</span>.<span class="hljs-number">761905</span>Hz (<span class="hljs-number">25</span>MHz/(<span class="hljs-number">525</span>*<span class="hljs-number">800</span>*<span class="hljs-number">2</span>))
<span class="hljs-attribute">PSG</span>+FIFO Sample Rate    <span class="hljs-number">48</span>.<span class="hljs-number">82813</span>kHz (<span class="hljs-number">25</span>MHz/<span class="hljs-number">512</span>)
<span class="hljs-attribute">SPI</span> Fast Clock          <span class="hljs-number">12</span>.<span class="hljs-number">50000</span>MHz (<span class="hljs-number">25</span>MHz/<span class="hljs-number">2</span>)
<span class="hljs-attribute">SPI</span> Slow Clock          <span class="hljs-number">390</span>.<span class="hljs-number">6250</span>kHz (<span class="hljs-number">25</span>MHz/<span class="hljs-number">64</span>)</code></pre><h3 id="ym2151-timings"><a class="header-link" href="#ym2151-timings"></a>YM2151 Timings</h3>
<pre class="hljs"><code><span class="hljs-attribute">YM2151</span> Oscillator       <span class="hljs-number">3</span>.<span class="hljs-number">579545</span>MHz
<span class="hljs-attribute">YM2151</span> Sample Rate      <span class="hljs-number">55</span>.<span class="hljs-number">93039</span>kHz (<span class="hljs-number">3</span>.<span class="hljs-number">58</span>MHz/<span class="hljs-number">64</span>)</code></pre><p>NOTE: Although it&#39;s exactly NTSC color clock, it&#39;s actually never used by VERA
to generate NTSC video signals (?)</p>
<h2 id="x16-video-timings"><a class="header-link" href="#x16-video-timings"></a>X16 Video Timings</h2>
<h3 id="horizontal-timings"><a class="header-link" href="#horizontal-timings"></a>Horizontal Timings</h3>
<pre class="hljs"><code>Scanline Length    <span class="hljs-number"> 800 </span>dot cycles
                    =<span class="hljs-number"> 256 </span>CPU cycles (progressive)
                    =<span class="hljs-number"> 512 </span>CPU cycles (interlaced)</code></pre><h3 id="detailed-timings"><a class="header-link" href="#detailed-timings"></a>Detailed Timings</h3>
<p>(H=Horizontal, V=Vertical, F=Field)</p>
<p>Progressive Output</p>
<pre class="hljs"><code><span class="hljs-attribute">H</span>=0 <span class="hljs-attribute">V</span>=0             End of VBlank
<span class="hljs-attribute">H</span>=0..639  <span class="hljs-attribute">V</span>=0..479  Draw Picture
<span class="hljs-attribute">H</span>=0 <span class="hljs-attribute">V</span>=480           Begin of VBlank (VBlank IRQ, collision latch)
    <span class="hljs-attribute">V</span>=524           Last Line
<span class="hljs-attribute">H</span>=0 <span class="hljs-attribute">V</span>=IRQLINE       Generate Line IRQ</code></pre><p>Interlaced Output</p>
<pre class="hljs"><code><span class="hljs-attribute">H</span>=0 <span class="hljs-attribute">V</span>=0             End of VBlank, toggle field (?)
<span class="hljs-attribute">H</span>=0..639  <span class="hljs-attribute">V</span>=0..239  Draw Picture
<span class="hljs-attribute">H</span>=0 <span class="hljs-attribute">V</span>=240           Begin of VBlank (VBlank IRQ, collision latch)
    <span class="hljs-attribute">V</span>=261           Last Line
    <span class="hljs-attribute">V</span>=262 <span class="hljs-attribute">F</span>=1       Extra Line
<span class="hljs-attribute">H</span>=0 <span class="hljs-attribute">V</span>=IRQLINE/2     Generate Line IRQ</code></pre><h1 id="via-versatile-interface-adapter"><a class="header-link" href="#via-versatile-interface-adapter"></a>VIA Versatile Interface Adapter</h1>
<p>I/O port addresses below are 4-bit RSx address line values. For X16, which uses
two VIAs, these addresses are mapped directly to 9F0xh for the first one and
9F1xh for the second one.</p>
<p><a href="#via-peripheral-data-ports">VIA Peripheral Data Ports</a><br><a href="#via-data-transfer-controls">VIA Data Transfer Controls</a><br><a href="#via-timer-1">VIA Timer 1</a><br><a href="#via-timer-2">VIA Timer 2</a><br><a href="#via-shift-register">VIA Shift Register</a><br><a href="#via-interrupts">VIA Interrupts</a>  </p>
<h2 id="via-peripheral-data-ports"><a class="header-link" href="#via-peripheral-data-ports"></a>VIA Peripheral Data Ports</h2>
<h3 id="0h---prb---port-b-inputoutput-rw"><a class="header-link" href="#0h---prb---port-b-inputoutput-rw"></a>0h - PRB - Port B Input/Output (R/W)</h3>
<h3 id="1h---pra---port-a-inputoutput-rw"><a class="header-link" href="#1h---pra---port-a-inputoutput-rw"></a>1h - PRA - Port A Input/Output (R/W)</h3>
<h3 id="fh---pra2---port-a-inputoutput-without-handshaking-rw"><a class="header-link" href="#fh---pra2---port-a-inputoutput-without-handshaking-rw"></a>Fh - PRA2 - Port A Input/Output Without Handshaking (R/W)</h3>
<p>Write to port output or read from port input. A bit value of 0 means
physical logic 0 input/output and a bit value of 1 means physical logic 1
input/output. This register is internally separated to one for input (IRx) and
another for output (ORx). The corresponding behavior between this register and
physical pin output for each bit n is as described below:</p>
<pre class="hljs"><code>Data Dir.   Latching    Write Behavior              Read Behavior              
<span class="hljs-comment">-------------------------------------------------------------------------------</span>
DDRx        Disabled    Only output <span class="hljs-keyword">register</span> <span class="hljs-keyword">is</span>     Pxn pin<span class="hljs-symbol">&#x27;s</span> level <span class="hljs-keyword">is</span> read <span class="hljs-keyword">to</span>
<span class="hljs-built_in">bit</span> n = <span class="hljs-number">0</span>               set. Pxn pin remain Hi-Z    <span class="hljs-built_in">bit</span> n
(Input)     <span class="hljs-comment">-------------------------------------------------------------------</span>
            Enabled     Only output <span class="hljs-keyword">register</span> <span class="hljs-keyword">is</span>     Input <span class="hljs-keyword">register</span> <span class="hljs-built_in">bit</span> n which
                        set. Pxn pin remain Hi-Z    <span class="hljs-keyword">is</span> latched at last Cx1
                                                    transition <span class="hljs-keyword">is</span> read
<span class="hljs-comment">-------------------------------------------------------------------------------</span>
DDRx        Disabled    Pxn pin<span class="hljs-symbol">&#x27;s</span> output level <span class="hljs-keyword">is</span>   Pxn pin<span class="hljs-symbol">&#x27;s</span> level <span class="hljs-keyword">is</span> read <span class="hljs-keyword">to</span>
<span class="hljs-built_in">bit</span> n = <span class="hljs-number">1</span>               set <span class="hljs-keyword">to</span> <span class="hljs-built_in">bit</span> n<span class="hljs-symbol">&#x27;s</span> value        <span class="hljs-built_in">bit</span> n
(Output)    <span class="hljs-comment">-------------------------------------------------------------------</span>
            Enabled     Pxn pin<span class="hljs-symbol">&#x27;s</span> output level <span class="hljs-keyword">is</span>   Input <span class="hljs-keyword">register</span> <span class="hljs-built_in">bit</span> n which
                        set <span class="hljs-keyword">to</span> <span class="hljs-built_in">bit</span> n<span class="hljs-symbol">&#x27;s</span> value        <span class="hljs-keyword">is</span> latched at last Cx1
                                                    transition <span class="hljs-keyword">is</span> read</code></pre><p>Latching is controlled by ACR bit 0-1&#39;s value (for Port A and B respectively).</p>
<h3 id="2h---ddrb---port-b-data-direction-rw"><a class="header-link" href="#2h---ddrb---port-b-data-direction-rw"></a>2h - DDRB - Port B Data Direction (R/W)</h3>
<h3 id="3h---ddra---port-a-data-direction-rw"><a class="header-link" href="#3h---ddra---port-a-data-direction-rw"></a>3h - DDRA - Port A Data Direction (R/W)</h3>
<p>Set the data direction for each port. For each bit n of DDRx register: a value
of 0 (input) means Pxn pin is released to high Z state, allowing other devices
to drive it; a value of 1 (output) means Pxn pin is driven to the current
output register value of the same port and bit.</p>
<p>As explained in PRx registers, when these registers are written to change from
input to output, all corresponding pins will output what&#39;s in the output
register which can be changed even when the direction was set to input.</p>
<h2 id="via-data-transfer-controls"><a class="header-link" href="#via-data-transfer-controls"></a>VIA Data Transfer Controls</h2>
<h3 id="bh---acr---auxiliary-control-register-rw"><a class="header-link" href="#bh---acr---auxiliary-control-register-rw"></a>Bh - ACR - Auxiliary Control Register (R/W)</h3>
<pre class="hljs"><code><span class="hljs-keyword">Bit
</span><span class="hljs-number">7</span>       <span class="hljs-built_in">T1</span> PB7 Output (<span class="hljs-number">0</span>=<span class="hljs-keyword">Disable, </span><span class="hljs-number">1</span>=Enable)
<span class="hljs-number">6</span>       <span class="hljs-built_in">T1</span> Timer Control
          <span class="hljs-number">0</span> = Run Once Every <span class="hljs-built_in">T1</span> Load, PB7 One <span class="hljs-keyword">Shot </span>Output
          <span class="hljs-number">1</span> = Run Continuously, PB7 Square Wave Output
<span class="hljs-number">5</span>       <span class="hljs-built_in">T2</span> Timer Control (<span class="hljs-number">0</span>=<span class="hljs-keyword">Normal, </span><span class="hljs-number">1</span>=<span class="hljs-keyword">Clocked </span><span class="hljs-keyword">by </span>PB6)
<span class="hljs-number">4</span><span class="hljs-number">-2</span>     <span class="hljs-keyword">Shift </span>Register Control
          <span class="hljs-number">0</span> = <span class="hljs-keyword">Shifting </span><span class="hljs-keyword">Disabled
</span>          <span class="hljs-number">1</span> = <span class="hljs-keyword">Shift </span>In <span class="hljs-built_in">At</span> <span class="hljs-built_in">T2</span> Rate
          <span class="hljs-number">2</span> = <span class="hljs-keyword">Shift </span>In <span class="hljs-built_in">At</span> PHI2 <span class="hljs-keyword">Clock
</span>          <span class="hljs-number">3</span> = <span class="hljs-keyword">Shift </span>In <span class="hljs-built_in">At</span> CB1 Input <span class="hljs-keyword">Clock
</span>          <span class="hljs-number">4</span> = <span class="hljs-keyword">Shift </span>Out Free-running <span class="hljs-built_in">At</span> <span class="hljs-built_in">T2</span> Rate
          <span class="hljs-number">5</span> = <span class="hljs-keyword">Shift </span>Out <span class="hljs-built_in">At</span> <span class="hljs-built_in">T2</span> Rate
          <span class="hljs-number">6</span> = <span class="hljs-keyword">Shift </span>Out <span class="hljs-built_in">At</span> PHI2 <span class="hljs-keyword">Clock
</span>          <span class="hljs-number">7</span> = <span class="hljs-keyword">Shift </span>Out <span class="hljs-built_in">At</span> CB1 Input <span class="hljs-keyword">Clock
</span><span class="hljs-number">1</span>       Latch Port <span class="hljs-keyword">B </span>(<span class="hljs-number">0</span>=<span class="hljs-keyword">Disable, </span><span class="hljs-number">1</span>=Latch <span class="hljs-built_in">At</span> CB1 Transition)
<span class="hljs-number">0</span>       Latch Port A (<span class="hljs-number">0</span>=<span class="hljs-keyword">Disable, </span><span class="hljs-number">1</span>=Latch <span class="hljs-built_in">At</span> CA1 Transition)</code></pre><p>If T1 PB7 Output is enabled, PB7 pin&#39;s output is overridden to always output
a level according to Timer 1&#39;s operation. Although DDRB bit 7 setting can
still make PB7 pin to be an input.</p>
<h3 id="ch---pcr---peripheral-control-register-rw"><a class="header-link" href="#ch---pcr---peripheral-control-register-rw"></a>Ch - PCR - Peripheral Control Register (R/W)</h3>
<pre class="hljs"><code><span class="hljs-variable">Bit</span>
<span class="hljs-number">7</span><span class="hljs-operator">-</span><span class="hljs-number">5</span>     <span class="hljs-variable">CB2</span> <span class="hljs-built_in">Control</span>
          <span class="hljs-number">0</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">Input</span><span class="hljs-operator">,</span> <span class="hljs-variable">Generate</span> <span class="hljs-variable">at</span> <span class="hljs-variable">Falling</span> <span class="hljs-variable">Edge</span>
          <span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-variable">Independent</span> <span class="hljs-built_in">Interrupt</span> <span class="hljs-built_in">Input</span><span class="hljs-operator">,</span> <span class="hljs-variable">Generate</span> <span class="hljs-variable">at</span> <span class="hljs-variable">Falling</span> <span class="hljs-variable">Edge</span>
          <span class="hljs-number">2</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">Input</span><span class="hljs-operator">,</span> <span class="hljs-variable">Generate</span> <span class="hljs-variable">at</span> <span class="hljs-variable">Rising</span> <span class="hljs-variable">Edge</span>
          <span class="hljs-number">3</span> <span class="hljs-operator">=</span> <span class="hljs-variable">Independent</span> <span class="hljs-built_in">Interrupt</span> <span class="hljs-built_in">Input</span><span class="hljs-operator">,</span> <span class="hljs-variable">Generate</span> <span class="hljs-variable">at</span> <span class="hljs-variable">Rising</span> <span class="hljs-variable">Edge</span>
          <span class="hljs-number">4</span> <span class="hljs-operator">=</span> <span class="hljs-variable">Handshake</span> <span class="hljs-variable">Output</span>
          <span class="hljs-number">5</span> <span class="hljs-operator">=</span> <span class="hljs-variable">Pulse</span> <span class="hljs-variable">Output</span>
          <span class="hljs-number">6</span> <span class="hljs-operator">=</span> <span class="hljs-variable">Low</span> <span class="hljs-variable">Output</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Always</span> <span class="hljs-variable">output</span> <span class="hljs-number">0</span><span class="hljs-punctuation">)</span>
          <span class="hljs-number">7</span> <span class="hljs-operator">=</span> <span class="hljs-variable">High</span> <span class="hljs-variable">Output</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Always</span> <span class="hljs-variable">output</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span>
<span class="hljs-number">4</span>       <span class="hljs-variable">CB1</span> <span class="hljs-built_in">Interrupt</span> <span class="hljs-built_in">Control</span>
          <span class="hljs-number">0</span> <span class="hljs-operator">=</span> <span class="hljs-variable">Generate</span> <span class="hljs-built_in">Interrupt</span> <span class="hljs-variable">at</span> <span class="hljs-variable">Falling</span> <span class="hljs-variable">Edge</span>
          <span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-variable">Generate</span> <span class="hljs-built_in">Interrupt</span> <span class="hljs-variable">at</span> <span class="hljs-variable">Rising</span> <span class="hljs-variable">Edge</span>
<span class="hljs-number">3</span><span class="hljs-operator">-</span><span class="hljs-number">1</span>     <span class="hljs-variable">CA2</span> <span class="hljs-built_in">Control</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Same</span> <span class="hljs-variable">as</span> <span class="hljs-variable">CB2</span><span class="hljs-punctuation">)</span>
<span class="hljs-number">0</span>       <span class="hljs-variable">CA1</span> <span class="hljs-built_in">Interrupt</span> <span class="hljs-built_in">Control</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">Same</span> <span class="hljs-variable">as</span> <span class="hljs-variable">CB1</span><span class="hljs-punctuation">)</span></code></pre><p>Cx2 pin can be set to input (released) or output (driven) through this
register. Cx1 pin is always an input pin. Independent interrupt input doesn&#39;t
depend on handshake control&#39;s state and reading/writing to PRx will not clear
interrupt flag.</p>
<h3 id="handshake-control"><a class="header-link" href="#handshake-control"></a>Handshake Control</h3>
<p>VIA provides a way to signal and control data transfers between the processor
and devices with handshake lines though CAx pins for port A and CBx pins for
port B. Handshake controls can be enabled or disabled by configuring related
control bits in PCR and IER.</p>
<p>For write handshake control, any writes to PRx will generate a &quot;data ready&quot;
signal on Cx2. This will notify the device to read the written data and send
&quot;data taken&quot; signal in return to Cx1. As shown in the below timing diagram:</p>
<pre class="hljs"><code><span class="hljs-code">              _   _   _   _   _   _   _   _   _   _   _   _   _   _   _</span>
PHI2        <span class="hljs-emphasis">_| |_</span>| |<span class="hljs-emphasis">_| |_</span>| |<span class="hljs-emphasis">_| / / |_</span>| |<span class="hljs-emphasis">_| |_</span>| |<span class="hljs-emphasis">_| / / |_</span>| |<span class="hljs-emphasis">_| |_</span>| |_|
<span class="hljs-code">                ___                                         ___</span>
PRx Write   <span class="hljs-emphasis">___|   |__</span><span class="hljs-emphasis">_____</span><span class="hljs-emphasis">____/ /__</span><span class="hljs-emphasis">_____</span><span class="hljs-emphasis">_____</span><span class="hljs-emphasis">_____</span>/ /<span class="hljs-emphasis">_____</span>|   |<span class="hljs-emphasis">_____</span>__
<span class="hljs-code">            _________                    __________/ /___________</span>
Cx2 (Hand-           |<span class="hljs-emphasis">_____</span><span class="hljs-emphasis">____/ /__</span><span class="hljs-emphasis">____|                        |__</span><span class="hljs-emphasis">___
shake Out)  __</span><span class="hljs-emphasis">_____</span><span class="hljs-emphasis">__     __</span><span class="hljs-emphasis">___/ /__</span><span class="hljs-emphasis">_____</span><span class="hljs-emphasis">_____</span><span class="hljs-emphasis">_____</span>/ /<span class="hljs-emphasis">_____</span><span class="hljs-emphasis">_____</span>_     _
Cx2                  |<span class="hljs-emphasis">___|                                       |__</span>_|
(Pulse Out) <span class="hljs-emphasis">_____</span><span class="hljs-emphasis">_____</span><span class="hljs-emphasis">_____</span><span class="hljs-emphasis">____/ /__</span><span class="hljs-emphasis">____      __</span><span class="hljs-emphasis">___/ /__</span><span class="hljs-emphasis">_____</span><span class="hljs-emphasis">_____</span><span class="hljs-emphasis">_____</span>
Cx1                                     |<span class="hljs-emphasis">____|__</span><span class="hljs-emphasis">___/ /__</span><span class="hljs-emphasis">___|
            __</span><span class="hljs-emphasis">_____</span><span class="hljs-emphasis">_____</span><span class="hljs-emphasis">_____</span><span class="hljs-emphasis">__/ /__</span><span class="hljs-emphasis">____                          __</span><span class="hljs-emphasis">___
IRQB                                    |__</span><span class="hljs-emphasis">_____</span><span class="hljs-emphasis">___/ /__</span><span class="hljs-emphasis">_____</span>____|
(IER.1/4=1)</code></pre><p>For read handshake control (port A only), when a &quot;data ready&quot; signal from the
device is received on CA1, it will generate an interrupt if enabled. This will
interrupt the processor to read an incoming byte in PRA at any time. Any reads
from PRA will generate a &quot;data taken&quot; signal on CA2 to notify the device.</p>
<pre class="hljs"><code>              _   _   _   _   _   _   _   _   _   _   _   _   _
PHI2        _|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> / / </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> / / </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|
            ____      _____/ /_____________________/ /_____
CA1             |<span class="hljs-string">____</span>|<span class="hljs-string">_____/ /_____</span>|<span class="hljs-string">                       </span>|___
            ____                        ___________/ /_____
IRQB            |<span class="hljs-string">__________/ /_________</span>|<span class="hljs-string">                   </span>|___
(IER.1=1)                           ___
PRA Read    _______________/ /_____|<span class="hljs-string">   </span>|<span class="hljs-string">___________/ /_________
            _______________/ /_________                     ___
CA2 (Hand-                             </span>|<span class="hljs-string">___________/ /_____</span>|
shake Out)  _______________/ /_________     _______/ /_________
CA2                                    |<span class="hljs-string">___</span>|
(Pulse Out)</code></pre><h2 id="via-timer-1"><a class="header-link" href="#via-timer-1"></a>VIA Timer 1</h2>
<p>Timer 1 is a 16-bit counter which counts down at a rate of PHI2. When the
counter reaches 0, IFR bit 6 is set and generate an interrupt if it&#39;s enabled.
After this, it will either not generate any more interrupts or reload the
counter with a latched value depending on the modes described below. Timer 1
can also be configured to toggle output on PB7 pin with ACR bit 7 setting.</p>
<h3 id="4h5h---t1lt1h---t1-counter-rw"><a class="header-link" href="#4h5h---t1lt1h---t1-counter-rw"></a>4h/5h - T1L/T1H - T1 Counter (R/W)</h3>
<p>Reads will return the current counter value and clear IFR bit 6 if the lower 8
bits are read. Writes will set the latch (reload) value. If the upper 8 bits
are written, also reload the counter with a new value, start the counting and
clear IFR bit 6. When restarting the counter with a new reload value, it&#39;s
recommended to write to 4h first then write to 5h.</p>
<h3 id="6h7h---t1llt1lh---t1-latch-rw"><a class="header-link" href="#6h7h---t1llt1lh---t1-latch-rw"></a>6h/7h - T1LL/T1LH - T1 Latch (R/W)</h3>
<p>Reads will return the latch (reload) value but doesn&#39;t clear IFR bit 6. Writes
will set the latch value. If the upper 8 bits are written, clear IFR bit 6 only
(no counter reload like in T1H).</p>
<h3 id="timer-1-one-shot-mode-acr-bit-6--0"><a class="header-link" href="#timer-1-one-shot-mode-acr-bit-6--0"></a>Timer 1 One-shot Mode (ACR bit 6 = 0)</h3>
<pre class="hljs"><code>              _   _   _   _   _   _   _   _    _    _    _
PHI2        _|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> / / </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">__</span>|<span class="hljs-string"> </span>|<span class="hljs-string">__</span>|<span class="hljs-string"> </span>|<span class="hljs-string">__</span>|
               :___:                          :
T1H Write   ___|<span class="hljs-string">   </span>|<span class="hljs-string">___________/ /________________________
            ___________________/ /____________:
IRQB               :                          </span>|___________
(IER.6=1)   _______:                          :___________
PB7 Out            |<span class="hljs-string">___________/ /____________</span>|
(ACR.7=1)   _______:___ ___ ___   _ ___ ___ ____ ____ ____
Counter     _______|<span class="hljs-string">_N_</span>|<span class="hljs-string">N-1</span>|<span class="hljs-string">N-2/ / </span>|<span class="hljs-string">_1_</span>|<span class="hljs-string">_0_</span>|<span class="hljs-string">FFFF</span>|<span class="hljs-string">_N__</span>|<span class="hljs-string">N-1_
(if T1)     _______:___ ___ ___   _ ___ ___ ____ ____ ____
Counter     _______</span>|<span class="hljs-string">_N_</span>|<span class="hljs-string">N-1</span>|<span class="hljs-string">N-2/ / </span>|<span class="hljs-string">_1_</span>|<span class="hljs-string">_0_</span>|<span class="hljs-string">FFFF</span>|<span class="hljs-string">FFFE</span>|FFFD
(if T2)            <span class="hljs-variable">&lt;-------N+1.5 cycles------&gt;</span></code></pre><h3 id="timer-1-free-running-mode-acr-bit-6--1"><a class="header-link" href="#timer-1-free-running-mode-acr-bit-6--1"></a>Timer 1 Free-running Mode (ACR bit 6 = 1)</h3>
<pre class="hljs"><code>              _   _   _   _   _   _   _   _   _   _   _   _
PHI2        _|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> / / </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> / / </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|
                ___:                 :                 :
T1H Write   ___|<span class="hljs-string">   </span>|<span class="hljs-string">_______/ /_____________/ /_____________
            _______________/ /_______:        _________:
IRQB               :                 </span>|<span class="hljs-string">_____/ /         </span>|___
(IER.6=1)   _______:                 :_____/ /_________:
PB7 Out            |<span class="hljs-string">_______/ /_______</span>|<span class="hljs-string">                 </span>|___
(ACR.7=1)          <span class="hljs-variable">&lt;--N+1.5 cycles--&gt;</span><span class="hljs-variable">&lt;--N+2.5 cycles--&gt;</span></code></pre><h2 id="via-timer-2"><a class="header-link" href="#via-timer-2"></a>VIA Timer 2</h2>
<p>Timer 2 is also a 16-bit counter which counts down at a rate of PHI2 or PB6
input. When the counter reaches 0, IFR bit 5 is set and generate an interrupt
if it&#39;s enabled. Timer 2 is one-shot mode only and works the same as Timer 1
except the counter reloads to FFFFh instead and there&#39;s no PB7 output.</p>
<h3 id="8h9h---t2lt2h---t2-counter-rw"><a class="header-link" href="#8h9h---t2lt2h---t2-counter-rw"></a>8h/9h - T2L/T2H - T2 Counter (R/W)</h3>
<p>Reads will return the current counter value and clear IFR bit 5 if the lower 8
bits are read. Writes will set the latch (reload) value. If the upper 8 bits
are written, also reload the counter with a new value, start the counting and
clear IFR bit 5. When restarting the counter with a new reload value, it&#39;s
recommended to write to 8h first then write to 9h.</p>
<h3 id="timer-2-pulse-counting-mode-acr-bit-5--1"><a class="header-link" href="#timer-2-pulse-counting-mode-acr-bit-5--1"></a>Timer 2 Pulse Counting Mode (ACR bit 5 = 1)</h3>
<pre class="hljs"><code>                ___
T1H Write   ___|<span class="hljs-string">   </span>|<span class="hljs-string">_________________/ /___________________
            _____________   ___   ___/ /_   ___   ___   ___
PB6 Input          :     </span>|<span class="hljs-string">_</span>|<span class="hljs-string">   </span>|<span class="hljs-string">_</span>|<span class="hljs-string">       </span>|<span class="hljs-string">_</span>|<span class="hljs-string">   </span>|<span class="hljs-string">_</span>|<span class="hljs-string">   </span>|<span class="hljs-string">_</span>|
            _________________________/ /_______:     :
IRQB               :     :     :         :     |<span class="hljs-string">___________
(IER.5=1)   _______:_____:_____:_____   _:_____:_____:_____
Counter     _______</span>|<span class="hljs-string">__N__</span>|<span class="hljs-string">_N-1_</span>|<span class="hljs-string">_N-2_/ / </span>|<span class="hljs-string">__1__</span>|<span class="hljs-string">__0__</span>|FFFF_</code></pre><h2 id="via-shift-register"><a class="header-link" href="#via-shift-register"></a>VIA Shift Register</h2>
<h3 id="ah---sr----shift-register-rw"><a class="header-link" href="#ah---sr----shift-register-rw"></a>Ah - SR  - Shift Register (R/W)</h3>
<p>The shift register contains an 8-bit buffer which is used to perform
bidirectional serial transfers on CB2 pin with automatic clocking from either
CB1 pin input or internal counters, depending on the current ACR setting.
It also has a counter to keep track of the current shifting state and notify
when a byte is transferred. Each shift clock will shift in/out the lowest bit
of shift register&#39;s content.</p>
<p>CAUTION: In every modes that involve using Timer 2 as a shift clock source,
only the lower 8 bits of it are reloaded and counted.</p>
<h3 id="shifting-disabled-acr-bit-2-4--0"><a class="header-link" href="#shifting-disabled-acr-bit-2-4--0"></a>Shifting Disabled (ACR bit 2-4 = 0)</h3>
<p>No shifting occurs, shift register can be read/written freely. Both CB1 and CB2
pins are not overridden and controlled by PCR or handshake control as normal.
IFR bit 2 is always cleared.</p>
<h3 id="shift-in-at-t2-rate-acr-bit-2-4--1"><a class="header-link" href="#shift-in-at-t2-rate-acr-bit-2-4--1"></a>Shift In At T2 Rate (ACR bit 2-4 = 1)</h3>
<pre class="hljs"><code>                     <span class="hljs-variable">&lt;--N+2 cycles--&gt;</span><span class="hljs-variable">&lt;--N+2 cycles--&gt;</span><span class="hljs-variable">&lt;-13N+26 cycles-&gt;</span>
          _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _
PHI2    _|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> / / </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> / / </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> / / </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|
            ___      :               :               :               :     :
SR Read ___|<span class="hljs-string">   </span>|<span class="hljs-string">_______________/ /_____________/ /_____________/ /_____________
/Write  _____________:               :_________/ /___:               :_________
CB1 Out              </span>|<span class="hljs-string">_________/ /___</span>|<span class="hljs-string">               </span>|<span class="hljs-string">_________/ /___</span>|<span class="hljs-string">     :
(Clock) ___________________ ___/ /_________ ___/ /_________ ___/ /_________:___
CB2 In  ___________________</span>|<span class="hljs-string">___/ /_________</span>|<span class="hljs-string">___/ /_________</span>|<span class="hljs-string">___/ /_________</span>|___
(Data)                             0              xxx        1 ...    7    :
        _______________________/ /_____________/ /_____________/ /_________: 
IRQB                                                                       |<span class="hljs-string">___
(IER.2=1)</span></code></pre><p>In this mode, the shift clock is controlled by Timer 2 counter. Each read/write
to the shift register will reset the shift counter and eight bits are shifted
in from CB2 pin from bit 0 to bit 7. At the same time, a shift clock signal is
output to CB1 pin for the device to change the data at the falling edge of it.
(the chip reads at every rising edge). After all bits are shifted, the shifting
is disabled and IFR bit 2 is set.</p>
<h3 id="shift-in-at-phi2-clock-acr-bit-2-4--2"><a class="header-link" href="#shift-in-at-phi2-clock-acr-bit-2-4--2"></a>Shift In At PHI2 Clock (ACR bit 2-4 = 2)</h3>
<pre class="hljs"><code>          _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _
PHI2    _|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> / / </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|
            ___      :   :   :                                   :       :
SR Read ___|<span class="hljs-string">   </span>|<span class="hljs-string">_______________________________/ /_____________________________
/Write  _____________:   :___:    ___     ___     ___     ___    :_____________
CB1 Out              </span>|<span class="hljs-string">___</span>|<span class="hljs-string">   </span>|<span class="hljs-string">___</span>|<span class="hljs-string">   </span>|<span class="hljs-string">___</span>|<span class="hljs-string">   </span>|<span class="hljs-string">_/ /   </span>|<span class="hljs-string">___</span>|<span class="hljs-string">   </span>|<span class="hljs-string">___</span>|<span class="hljs-string">       :
(Clock) ______________ _______ _______ _______ / /____ _______ _______ ________
CB2 In  ______________</span>|<span class="hljs-string">_______</span>|<span class="hljs-string">_______</span>|<span class="hljs-string">_______</span>|<span class="hljs-string">/ /____</span>|<span class="hljs-string">_______</span>|<span class="hljs-string">_______</span>|________
(Data)                    0       1       2    ...        6       7      :
        _________________________________________________________________: 
IRQB                                                                     |<span class="hljs-string">_____
(IER.2=1)</span></code></pre><p>Same as Shift In At T2 Rate but the clock output is driven by PHI2 clock
directly at half the frequency.</p>
<h3 id="shift-in-at-cb1-input-clock-acr-bit-2-4--3"><a class="header-link" href="#shift-in-at-cb1-input-clock-acr-bit-2-4--3"></a>Shift In At CB1 Input Clock (ACR bit 2-4 = 3)</h3>
<pre class="hljs"><code>          _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _
PHI2    _| |_| |_| <span class="hljs-regexp">/ /</span> |_| |_| <span class="hljs-regexp">/ /</span> |_| <span class="hljs-regexp">/ /</span> |_| |_| <span class="hljs-regexp">/ /</span> |_| |_| <span class="hljs-regexp">/ /</span> |_| |_| |_|
        _____            ______<span class="hljs-regexp">/ /</span>_            ____<span class="hljs-regexp">/ /</span>___            __________
CB1 In       |_____<span class="hljs-regexp">/ /</span>__|          |___<span class="hljs-regexp">/ /</span>____|          |_____<span class="hljs-regexp">/ /</span>__|  :
(Clock) _______ ___<span class="hljs-regexp">/ /</span>____ ____<span class="hljs-regexp">/ /</span>___ _<span class="hljs-regexp">/ /</span>______ __<span class="hljs-regexp">/ /</span>_____ ___<span class="hljs-regexp">/ /</span>_____:_______
CB2 In  _______|___<span class="hljs-regexp">/ /</span>____|____<span class="hljs-regexp">/ /</span>___| <span class="hljs-regexp">/ /</span>______|__<span class="hljs-regexp">/ /</span>_____|___<span class="hljs-regexp">/ /</span>_____|_______
(Data)              <span class="hljs-number">0</span>         xxx         <span class="hljs-number">1</span>         xxx      <span class="hljs-number">2</span> ...  <span class="hljs-number">7</span>  :
        ___________<span class="hljs-regexp">/ /</span>_________<span class="hljs-regexp">/ /</span>____ <span class="hljs-regexp">/ /</span>_________<span class="hljs-regexp">/ /</span>_________<span class="hljs-regexp">/ /</span>_____:
IRQB                                                                   |_______
(IER.<span class="hljs-number">2</span>=<span class="hljs-number">1</span>)</code></pre><p>Same as Shift In At T2 Rate but shifting is driven by CB1 input clock and there
is no need to read/write to the shift register to start shifting.</p>
<h3 id="shift-out-free-running-at-t2-rate-acr-bit-2-4--4"><a class="header-link" href="#shift-out-free-running-at-t2-rate-acr-bit-2-4--4"></a>Shift Out Free-running At T2 Rate (ACR bit 2-4 = 4)</h3>
<pre class="hljs"><code>                         &lt;----<span class="hljs-number">2</span>N+<span class="hljs-number">4</span> cycles---&gt;&lt;---<span class="hljs-number">14</span>N+<span class="hljs-number">28</span> cycles--&gt;
          _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _
PHI2    _| |_| |_| |_| |_| |_| <span class="hljs-regexp">/ /</span> |_| <span class="hljs-regexp">/ /</span> |_| |_| <span class="hljs-regexp">/ /</span> |_| <span class="hljs-regexp">/ /</span> |_| |_| <span class="hljs-regexp">/ /</span> |_|
            ___          :           :       :           :       :           :
SR <span class="hljs-keyword">Read</span> ___|   |_______________<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_________<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_________<span class="hljs-regexp">/ /</span>_____
<span class="hljs-regexp">/Write  _________________:           :_/</span> <span class="hljs-regexp">/___:           :_/</span> /___:           :_
CB1 Out                  |_____<span class="hljs-regexp">/ /</span>___|       |_____<span class="hljs-regexp">/ /</span>___|       |_____<span class="hljs-regexp">/ /</span>___| 
(Clock) ___________________ ___<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_____ ___<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_____ ___<span class="hljs-regexp">/ /</span>_____
CB2 Out ___________________|___<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_____|___<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_____|___<span class="hljs-regexp">/ /</span>_____
(Data)                               <span class="hljs-number">0</span>               <span class="hljs-number">1</span>     ...  <span class="hljs-number">7</span>        <span class="hljs-number">0</span></code></pre><p>Same as Shift Out At T2 Rate but the shifting will never stop and interrupt is
never generated. Shift register&#39;s content is rotated right instead which will
put 8 bits of data out to CB2 pin repetitively. This is useful as a pulse
generator or crude PWM/PDM output when running at maximum Timer 2 speed (N=1).</p>
<h3 id="shift-out-at-t2-rate-acr-bit-2-4--5"><a class="header-link" href="#shift-out-at-t2-rate-acr-bit-2-4--5"></a>Shift Out At T2 Rate (ACR bit 2-4 = 5)</h3>
<pre class="hljs"><code>                         &lt;----<span class="hljs-number">2</span>N+<span class="hljs-number">4</span> cycles---&gt;&lt;-------<span class="hljs-number">13</span>N+<span class="hljs-number">26</span> cycles------&gt;
          _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _
PHI2    _| |_| |_| |_| |_| |_| <span class="hljs-regexp">/ /</span> |_| <span class="hljs-regexp">/ /</span> |_| |_| <span class="hljs-regexp">/ /</span> |_| |_| <span class="hljs-regexp">/ /</span> |_| |_| |_|
            ___          :           :       :           :               :
SR <span class="hljs-keyword">Read</span> ___|   |_______________<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_________<span class="hljs-regexp">/ /</span>_________<span class="hljs-regexp">/ /</span>_____________
<span class="hljs-regexp">/Write  _________________:           :_/</span> <span class="hljs-regexp">/___:           :_____/</span> /       :_____
CB1 Out                  |_____<span class="hljs-regexp">/ /</span>___|       |_____<span class="hljs-regexp">/ /</span>___|     <span class="hljs-regexp">/ /</span>_______|
(Clock) ___________________ ___<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_____ ___<span class="hljs-regexp">/ /</span>_________<span class="hljs-regexp">/ /</span>_____________
CB2 Out ___________________|___<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_____|___<span class="hljs-regexp">/ /</span>_________<span class="hljs-regexp">/ /</span>_____________
(Data)                               <span class="hljs-number">0</span>                 <span class="hljs-number">1</span>       ...   <span class="hljs-number">7</span>   :
        _______________________<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_________<span class="hljs-regexp">/ /</span>_________<span class="hljs-regexp">/ /</span>_______: 
IRQB                                                                     |_____
(IER.<span class="hljs-number">2</span>=<span class="hljs-number">1</span>)</code></pre><p>In this mode, the shift clock is controlled by Timer 2 counter. Each read/write
to the shift register will reset the shift counter and eight bits are shifted
out to CB2 pin from bit 0 to bit 7. At the same time, a shift clock signal is
output to CB1 pin for the device to read the data at the rising edge of it.
After all bits are shifted, the shifting is disabled, IFR bit 2 is set and CB2
output will remain at the last bit&#39;s level.</p>
<h3 id="shift-out-at-phi2-clock-acr-bit-2-4--6"><a class="header-link" href="#shift-out-at-phi2-clock-acr-bit-2-4--6"></a>Shift Out At PHI2 Clock (ACR bit 2-4 = 6)</h3>
<pre class="hljs"><code>          _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _
PHI2    _|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> / / </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|<span class="hljs-string"> </span>|<span class="hljs-string">_</span>|
            ___      :   :   :                                           :
SR Read ___|<span class="hljs-string">   </span>|<span class="hljs-string">_______________________________/ /_____________________________
/Write  _____________:   :___:    ___     ___     ___     ___     ___    :_____
CB1 Out              </span>|<span class="hljs-string">___</span>|<span class="hljs-string">   </span>|<span class="hljs-string">___</span>|<span class="hljs-string">   </span>|<span class="hljs-string">___</span>|<span class="hljs-string">   </span>|<span class="hljs-string">_/ /   </span>|<span class="hljs-string">___</span>|<span class="hljs-string">   </span>|<span class="hljs-string">___</span>|<span class="hljs-string">   </span>|<span class="hljs-string">___</span>|
(Clock) ______________ _______ _______ _______ / /____ _______ _______ ________
CB2 Out ______________|<span class="hljs-string">_______</span>|<span class="hljs-string">_______</span>|<span class="hljs-string">_______</span>|<span class="hljs-string">/ /____</span>|<span class="hljs-string">_______</span>|<span class="hljs-string">_______</span>|________
(Data)                    0       1       2    ...        5       6      : 7
        _________________________________________________________________: 
IRQB                                                                     |<span class="hljs-string">_____
(IER.2=1)</span></code></pre><p>Same as Shift Out At T2 Rate but the clock output is driven by PHI2 clock
directly at half the frequency.</p>
<h3 id="shift-out-at-cb1-input-clock-acr-bit-2-4--7"><a class="header-link" href="#shift-out-at-cb1-input-clock-acr-bit-2-4--7"></a>Shift Out At CB1 Input Clock (ACR bit 2-4 = 7)</h3>
<pre class="hljs"><code>          _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _   _
PHI2    _| |_| |_| |_| |_| <span class="hljs-regexp">/ /</span> |_| <span class="hljs-regexp">/ /</span> |_| <span class="hljs-regexp">/ /</span> |_| <span class="hljs-regexp">/ /</span> |_| |_| <span class="hljs-regexp">/ /</span> |_| |_| |_|
            ___        :               :                   : :
SR <span class="hljs-keyword">Read</span> ___|   |___________<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_________<span class="hljs-regexp">/ /</span>_____________
<span class="hljs-regexp">/Write  _____________  :         __/</span> <span class="hljs-regexp">/_:           /</span> /___  : :       __________
CB1 In               |_____<span class="hljs-regexp">/ /</span>__|      |___<span class="hljs-regexp">/ /</span>____|      |_____<span class="hljs-regexp">/ /</span>__|
(Clock) _______________:___<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_:___<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_____:___<span class="hljs-regexp">/ /</span>_____________
CB2 Out _______________|___<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_|___<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_____|___<span class="hljs-regexp">/ /</span>_____________
(Data)                          <span class="hljs-number">0</span>            <span class="hljs-number">1</span>     ...  <span class="hljs-number">6</span>    :  <span class="hljs-number">7</span>
        ___________________<span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>____ <span class="hljs-regexp">/ /</span>_____<span class="hljs-regexp">/ /</span>_______:
IRQB                                                         |_<span class="hljs-regexp">/ /</span>_____________
(IER.<span class="hljs-number">2</span>=<span class="hljs-number">1</span>)</code></pre><p>Same as Shift Out At T2 Rate but shifting is driven by CB1 input clock.</p>
<h2 id="via-interrupts"><a class="header-link" href="#via-interrupts"></a>VIA Interrupts</h2>
<h3 id="dh---ifr---interrupt-flags-register-rw"><a class="header-link" href="#dh---ifr---interrupt-flags-register-rw"></a>Dh - IFR - Interrupt Flags Register (R/W)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Interrupt Request; <span class="hljs-number">1</span> if there&#x27;s any set bits in IER AND IFR
<span class="hljs-attribute">6</span>       Timer <span class="hljs-number">1</span> Timeout Flag (<span class="hljs-number">0</span>=None, <span class="hljs-number">1</span>=Interrupt Request)
<span class="hljs-attribute">5</span>       Timer <span class="hljs-number">2</span> Timeout Flag (<span class="hljs-number">0</span>=None, <span class="hljs-number">1</span>=Interrupt Request)
<span class="hljs-attribute">4</span>       CB<span class="hljs-number">1</span> Transition Flag (<span class="hljs-number">0</span>=None, <span class="hljs-number">1</span>=Interrupt Request)
<span class="hljs-attribute">3</span>       CB<span class="hljs-number">2</span> Transition Flag (<span class="hljs-number">0</span>=None, <span class="hljs-number">1</span>=Interrupt Request)
<span class="hljs-attribute">2</span>       Byte Shifted Flag (<span class="hljs-number">0</span>=None, <span class="hljs-number">1</span>=Interrupt Request)
<span class="hljs-attribute">1</span>       CA<span class="hljs-number">1</span> Transition Flag (<span class="hljs-number">0</span>=None, <span class="hljs-number">1</span>=Interrupt Request)
<span class="hljs-attribute">0</span>       CA<span class="hljs-number">2</span> Transition Flag (<span class="hljs-number">0</span>=None, <span class="hljs-number">1</span>=Interrupt Request)</code></pre><p>Bit 7 directly corresponds to the output of IRQB pin, which is used to quickly
check if this chip is the one generating an interrupt. It can only be cleared
when all enabled and active interrupt flags are cleared. The other flags can
only be cleared by:</p>
<pre class="hljs"><code>Timer <span class="hljs-number">1</span> Timeout:    <span class="hljs-keyword">Read</span> T1L <span class="hljs-keyword">or</span> <span class="hljs-keyword">write</span> T1H <span class="hljs-keyword">or</span> <span class="hljs-keyword">write</span> T1LH
Timer <span class="hljs-number">2</span> Timeout:    <span class="hljs-keyword">Read</span> T2L <span class="hljs-keyword">or</span> <span class="hljs-keyword">write</span> T2H
Cx1 Transition:     <span class="hljs-keyword">Read</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">write</span> PRx
Cx2 Transition:     <span class="hljs-keyword">Read</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">write</span> PRx (Dependent) / <span class="hljs-keyword">Write</span> <span class="hljs-keyword">to</span> IFR (Independent)
Byte Shifted:       <span class="hljs-keyword">Read</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">write</span> SR</code></pre><h3 id="eh---ier---interrupt-enable-register-rw"><a class="header-link" href="#eh---ier---interrupt-enable-register-rw"></a>Eh - IER - Interrupt Enable Register (R/W)</h3>
<pre class="hljs"><code>Bit
7       Enable/<span class="hljs-builtin-name">Disable</span> Selected Bits (<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
6       Timer 1 Timeout Interrupt (<span class="hljs-attribute">0</span>=Unselect, <span class="hljs-attribute">1</span>=Select)
5       Timer 2 Timeout Interrupt (<span class="hljs-attribute">0</span>=Unselect, <span class="hljs-attribute">1</span>=Select)
4       CB1 Transition Interrupt (<span class="hljs-attribute">0</span>=Unselect, <span class="hljs-attribute">1</span>=Select)
3       CB2 Transition Interrupt (<span class="hljs-attribute">0</span>=Unselect, <span class="hljs-attribute">1</span>=Select)
2       Byte Shifted Interrupt (<span class="hljs-attribute">0</span>=Unselect, <span class="hljs-attribute">1</span>=Select)
1       CA1 Transition Interrupt (<span class="hljs-attribute">0</span>=Unselect, <span class="hljs-attribute">1</span>=Select)
0       CA2 Transition Interrupt (<span class="hljs-attribute">0</span>=Unselect, <span class="hljs-attribute">1</span>=Select)</code></pre><p>Enable/Disable is only applied to selected bits of that write data. For
example, writing E0h will enable Timer 1 and 2 interrupts and leave the
rest unchanged. On read, Enable/Disable bit will always be 1.</p>
<h1 id="ym2151-fm-operator-type-m-opm"><a class="header-link" href="#ym2151-fm-operator-type-m-opm"></a>YM2151 FM Operator Type-M (OPM)</h1>
<h3 id="overview"><a class="header-link" href="#overview"></a>Overview</h3>
<p><a href="#ym2151-address-map">YM2151 Address Map</a><br><a href="#ym2151-block-diagram">YM2151 Block Diagram</a>  </p>
<h3 id="functions"><a class="header-link" href="#functions"></a>Functions</h3>
<p><a href="#ym2151-control-registers">YM2151 Control Registers</a><br><a href="#ym2151-timers">YM2151 Timers</a><br><a href="#ym2151-channels-and-slots">YM2151 Channels and Slots</a><br><a href="#ym2151-phase-generator">YM2151 Phase Generator</a><br><a href="#ym2151-adsr-envelope">YM2151 ADSR Envelope</a><br><a href="#ym2151-low-frequency-oscillator-lfo">YM2151 Low Frequency Oscillator (LFO)</a><br><a href="#ym2151-noise-generator">YM2151 Noise Generator</a></p>
<h2 id="ym2151-address-map"><a class="header-link" href="#ym2151-address-map"></a>YM2151 Address Map</h2>
<p>All registers are write-only. Reads from any address will return a separate
status register. For more details, see:<br><a href="#x16-ym2151-access">X16 YM2151 Access</a></p>
<pre class="hljs"><code>Offset      Bits                Content                                    
            |<span class="hljs-number">7</span> <span class="hljs-number">6</span> <span class="hljs-number">5</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span> <span class="hljs-number">2</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span>|                                           
<span class="hljs-number">00</span>h         |###############|   Not Used
<span class="hljs-number">01</span>h         |     TEST      |   Test Registers
<span class="hljs-number">02</span>h<span class="hljs-number">-07</span>h     |###############|   Not Used
<span class="hljs-number">08</span>h         |#| Slot  |Chan.|   Key On / Off
<span class="hljs-number">09</span>h<span class="hljs-number">-0</span>Eh     |###############|   Not Used
<span class="hljs-number">0</span>Fh         |N|###|  NFRQ   |   Noise Enable / Frequency
<span class="hljs-number">10</span>h         |     CLKA1     |   Timer A Reload
<span class="hljs-number">11</span>h         |###########|A2 |   Timer A Reload
<span class="hljs-number">12</span>h         |     CLKB      |   Timer B Reload
<span class="hljs-number">13</span>h         |###############|   Not Used
<span class="hljs-number">14</span>h         |C|#|RST|IRQ|LOD|   Timer Control
<span class="hljs-number">15</span>h<span class="hljs-number">-17</span>h     |###############|   Not Used
<span class="hljs-number">18</span>h         |     LFRQ      |   LFO Frequency
<span class="hljs-number">19</span>h         |    PMD/AMD    |   Phase / Amplitude Modulation Depth
<span class="hljs-number">1</span>Ah         |###############|   Not Used
<span class="hljs-number">1</span>Bh         |CT |#######| W |   Control Output / LFO Waveform
<span class="hljs-number">1</span>Ch<span class="hljs-number">-1</span>Fh     |###############|   Not Used
<span class="hljs-number">20</span>h<span class="hljs-number">-27</span>h     |R|L| FB  | CON |   Channel <span class="hljs-number">0.</span><span class="hljs-number">.7</span> Output / Feedback / Connection
<span class="hljs-number">28</span>h<span class="hljs-number">-2</span>Fh     |#|     KC      |   Channel <span class="hljs-number">0.</span><span class="hljs-number">.7</span> Key Code
<span class="hljs-number">30</span>h<span class="hljs-number">-37</span>h     |    KF     |###|   Channel <span class="hljs-number">0.</span><span class="hljs-number">.7</span> Key Fraction
<span class="hljs-number">38</span>h<span class="hljs-number">-3</span>Fh     |#| PMS |###|AMS|   Channel <span class="hljs-number">0.</span><span class="hljs-number">.7</span> Phase / AM Sensitivity
<span class="hljs-number">40</span>h<span class="hljs-number">-5</span>Fh     |#| DT1 |  MUL  |   Slot <span class="hljs-number">0.</span><span class="hljs-number">.31</span> Detune <span class="hljs-number">1</span> / Phase Multiply
<span class="hljs-number">60</span>h<span class="hljs-number">-7</span>Fh     |#|     TL      |   Slot <span class="hljs-number">0.</span><span class="hljs-number">.31</span> Total Level
<span class="hljs-number">80</span>h<span class="hljs-number">-9</span>Fh     |KS |#|   AR    |   Slot <span class="hljs-number">0.</span><span class="hljs-number">.31</span> Key Scaling / Attack Rate
A0h-BFh     |A|###|   D1R   |   Slot <span class="hljs-number">0.</span><span class="hljs-number">.31</span> AMS Enable / Decay <span class="hljs-number">1</span> Rate
C0h-DFh     |DT2|#|   D2R   |   Slot <span class="hljs-number">0.</span><span class="hljs-number">.31</span> Detune <span class="hljs-number">2</span> / Decay <span class="hljs-number">2</span> Rate
E0h-FFh     |  D1L  |  RR   |   Slot <span class="hljs-number">0.</span><span class="hljs-number">.31</span> Decay <span class="hljs-number">1</span> Level / Release Rate
            |<span class="hljs-number">7</span> <span class="hljs-number">6</span> <span class="hljs-number">5</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span> <span class="hljs-number">2</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span>|</code></pre><h2 id="ym2151-block-diagram"><a class="header-link" href="#ym2151-block-diagram"></a>YM2151 Block Diagram</h2>
<p>YM2151 is a sound synthesizer chip. It employs a phase modulation synthesis
(marketed as frequency modulation) where the output of a wave generator is
added to another wave generator&#39;s input phase. This can simply be implemented
as modifying the current wave table index. It provides flexible routing between
them with 8 connection presets, which some of them also has additive synthesis.
In addition of the main synthesizer core, it also provides a low-frequency
oscillator (LFO), a noise generator, interrupt timers and general-purpose
output/control pins.</p>
<h3 id="overall-block-diagram"><a class="header-link" href="#overall-block-diagram"></a>Overall Block Diagram</h3>
<pre class="hljs"><code> ______________________         __________        CLKA,   Timer   |<span class="hljs-string"> External
</span>|<span class="hljs-string"> LFO    _______   PMD </span>|<span class="hljs-string">       </span>|<span class="hljs-string"> Channel  </span>|<span class="hljs-string">       CLKB   Control  </span>|
|<span class="hljs-string">       </span>|<span class="hljs-string">  LFO  </span>|<span class="hljs-string">   v  </span>|<span class="hljs-string">LFO PM </span>|<span class="hljs-string"> 0..7     </span>||<span class="hljs-string">        </span>|<span class="hljs-string">       </span>|<span class="hljs-string">     </span>|<span class="hljs-string">     To Amp.
</span>|<span class="hljs-string"> LFRQ-&gt;</span>|<span class="hljs-string"> Waves </span>|<span class="hljs-string">-&gt;(x)-</span>|<span class="hljs-string">------&gt;</span>|<span class="hljs-string"> _______  </span>||<span class="hljs-string">CSM    _v_______v_    </span>|<span class="hljs-string">     &amp; Mixer
</span>|<span class="hljs-string">       </span>|<span class="hljs-string"> Table </span>|<span class="hljs-string">      </span>|<span class="hljs-string">LFO AM </span>||<span class="hljs-string"> Slot  </span>|<span class="hljs-string"> </span>||<span class="hljs-string">Keyon </span>|<span class="hljs-string">           </span>|<span class="hljs-string">   </span>|<span class="hljs-string">         ^
</span>|<span class="hljs-string"> W----&gt;</span>|<span class="hljs-string">_______</span>|<span class="hljs-string">-&gt;(x)-</span>|<span class="hljs-string">------&gt;</span>||<span class="hljs-string"> 0..31 </span>|||<span class="hljs-string">&lt;------</span>|<span class="hljs-string">   Timer   </span>|<span class="hljs-string">---</span>|<span class="hljs-string">-&gt;/IRQ   </span>|
|<span class="hljs-string">           ^       ^  </span>|<span class="hljs-string">Noise  </span>||<span class="hljs-string">_______</span>||||<span class="hljs-string">      </span>|<span class="hljs-string">___________</span>|<span class="hljs-string">   </span>|<span class="hljs-string">         </span>|
|<span class="hljs-string">           </span>|<span class="hljs-string">      AMD </span>|<span class="hljs-string">Source </span>|<span class="hljs-string"> </span>|<span class="hljs-string">_______</span>|||<span class="hljs-string">                      </span>|<span class="hljs-string">         </span>|
|<span class="hljs-string">           &#x27;----------</span>|<span class="hljs-string">-------</span>|<span class="hljs-string">__________</span>|<span class="hljs-string">---. L/R Out    CT1,2--</span>|<span class="hljs-string">-&gt;CT1,2  </span>|
|<span class="hljs-string">______________________</span>|<span class="hljs-string">        </span>|<span class="hljs-string">__________</span>|<span class="hljs-string">  </span>|<span class="hljs-string">        _________  </span>|<span class="hljs-string">   ______</span>|_
                                           ___v____   |<span class="hljs-string"> Encoder </span>|<span class="hljs-string"> </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> YM3012 </span>|
                                          |<span class="hljs-string"> Accum. </span>|<span class="hljs-string">  </span>|<span class="hljs-string"> /Serial </span>|<span class="hljs-string">-</span>|<span class="hljs-string">-&gt;</span>|<span class="hljs-string">  D/A   </span>|
                                          |<span class="hljs-string"> /Mixer </span>|<span class="hljs-string">-&gt;</span>|<span class="hljs-string"> Shifter </span>|<span class="hljs-string"> </span>|<span class="hljs-string">  </span>|<span class="hljs-string">________</span>|
Internal                                  |<span class="hljs-string">________</span>|<span class="hljs-string">  </span>|<span class="hljs-string">_________</span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span></code></pre><h3 id="channel-block-diagram"><a class="header-link" href="#channel-block-diagram"></a>Channel Block Diagram</h3>
<pre class="hljs"><code>           AMS           ______ 
            |<span class="hljs-string">       .--&gt;</span>|<span class="hljs-string"> Slot </span>|<span class="hljs-string">&lt;-----------.
            </span>|<span class="hljs-string">       </span>|<span class="hljs-string">   </span>|<span class="hljs-string">  M1  </span>|<span class="hljs-string">            </span>|
            |<span class="hljs-string">   .---</span>|<span class="hljs-string">--&gt;</span>|<span class="hljs-string">______</span>|<span class="hljs-string">------+---&gt;(x)&lt;---FB
            v   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">    ______      _v______
[LFO AM]--&gt;(x)--</span>|<span class="hljs-string">---+--&gt;</span>|<span class="hljs-string"> Slot </span>|<span class="hljs-string">&lt;---</span>|<span class="hljs-string">        </span>|<span class="hljs-string">              L
                </span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">  C1  </span>|<span class="hljs-string">    </span>|<span class="hljs-string"> Router </span>|<span class="hljs-string">&lt;---CON   .---:---&gt;[L Output]
  KC, KF--&gt;(+)--+---</span>|<span class="hljs-string">--&gt;</span>|<span class="hljs-string">______</span>|<span class="hljs-string">---&gt;</span>|<span class="hljs-string"> /Mixer </span>|<span class="hljs-string">          </span>|
            ^   |<span class="hljs-string">   </span>|<span class="hljs-string">    ______     </span>|<span class="hljs-string">  (See  </span>|<span class="hljs-string">          </span>|
            |<span class="hljs-string">   </span>|<span class="hljs-string">   +--&gt;</span>|<span class="hljs-string"> Slot </span>|<span class="hljs-string">&lt;---</span>|<span class="hljs-string">  Slot  </span>|<span class="hljs-string">          </span>|<span class="hljs-string">   R
[LFO PM]--&gt;(x)  </span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">  M2  </span>|<span class="hljs-string">    </span>|<span class="hljs-string"> Con.s) </span>|<span class="hljs-string">----------+---:---&gt;[R Output]
            ^   +---</span>|<span class="hljs-string">--&gt;</span>|<span class="hljs-string">______</span>|<span class="hljs-string">---&gt;</span>|<span class="hljs-string">________</span>|
            |<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">    ______       </span>|<span class="hljs-string">    ^
            </span>|<span class="hljs-string">   </span>|<span class="hljs-string">   &#x27;--&gt;</span>|<span class="hljs-string"> Slot </span>|<span class="hljs-string">&lt;-----&#x27;    </span>|
            |<span class="hljs-string">   </span>|<span class="hljs-string">       </span>|<span class="hljs-string">  C2  </span>|<span class="hljs-string">           </span>|
           PMS  &#x27;------&gt;|<span class="hljs-string">______</span>|<span class="hljs-string">-----------&#x27;</span></code></pre><h3 id="slot-block-diagram"><a class="header-link" href="#slot-block-diagram"></a>Slot Block Diagram</h3>
<pre class="hljs"><code>DT2---.  [PM&#x27;d KC]               MUL         [Mod. Input]
  ____v__    |<span class="hljs-string">    _______         </span>|<span class="hljs-string">    _______    </span>|<span class="hljs-string">    _______
 </span>|<span class="hljs-string">  DT2  </span>|<span class="hljs-string">   v   </span>|<span class="hljs-string"> Freq. </span>|<span class="hljs-string">        v   </span>|<span class="hljs-string"> Phase </span>|<span class="hljs-string">   v   </span>|<span class="hljs-string"> Sine  </span>|
 |<span class="hljs-string"> Table </span>|<span class="hljs-string">-&gt;(+)-&gt;</span>|<span class="hljs-string"> Table </span>|<span class="hljs-string">-&gt;(+)-&gt;(x)-&gt;</span>|<span class="hljs-string">  Gen. </span>|<span class="hljs-string">-&gt;(+)-&gt;</span>|<span class="hljs-string"> Table </span>|
 |<span class="hljs-string">_______</span>|<span class="hljs-string">       </span>|<span class="hljs-string">_______</span>|<span class="hljs-string">   ^        </span>|<span class="hljs-string">_______</span>|<span class="hljs-string">       </span>|<span class="hljs-string">_______</span>|
                          ___|<span class="hljs-string">___                        </span>|
KC, KF-------+----------&gt;|<span class="hljs-string">  DT1  </span>|<span class="hljs-string">                       v
             </span>|<span class="hljs-string">           </span>|<span class="hljs-string"> Table </span>|<span class="hljs-string">&lt;----DT1   .---------&gt;(+)
        _____v_____      </span>|<span class="hljs-string">_______</span>|<span class="hljs-string">           </span>|<span class="hljs-string">           </span>|
       |<span class="hljs-string"> Envelope  </span>|<span class="hljs-string">                         </span>|<span class="hljs-string">    _______v______
Keyon-&gt;</span>|<span class="hljs-string"> Generator </span>|<span class="hljs-string">-&gt;(+)-&gt;(+)---------------+   </span>|<span class="hljs-string">  Att. dB To  </span>|
       |<span class="hljs-string">___________</span>|<span class="hljs-string">   ^    ^                </span>|<span class="hljs-string">   </span>|<span class="hljs-string"> Linear Table </span>|
AR, D1R,     ^         |<span class="hljs-string">    </span>|<span class="hljs-string"> AMS En.        </span>|<span class="hljs-string">   </span>|<span class="hljs-string">______________</span>|
D1L, D2R,----&#x27;         |<span class="hljs-string">    &#x27;----:----[AMS]  </span>|<span class="hljs-string">           </span>|
RR, KS                 TL                    |<span class="hljs-string">           o
.............................................</span>|<span class="hljs-string">............\
: Slot 31 Only            _______            </span>|<span class="hljs-string">         NE :o--&gt;[Output]
: (Ch.7 C2)              </span>|<span class="hljs-string"> Noise </span>|<span class="hljs-string">           v            :
:              NFRQ-----&gt;</span>|<span class="hljs-string">  Gen. </span>|<span class="hljs-string">---------&gt;(x)----------o:
:                        </span>|<span class="hljs-string">_______</span>|<span class="hljs-string">-----&gt;[Noise LFO Src.]  :
:.........................................................:</span></code></pre><h3 id="slot-connections-algorithms"><a class="header-link" href="#slot-connections-algorithms"></a>Slot Connections (Algorithms)</h3>
<p>CON = 0</p>
<pre class="hljs"><code>      .-----------.  PG             PG             PG
      v    .----. |   v    .----.    v    .----.    v    .----.
PG--&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| M1 |-+-&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| C1 |--&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| M2 |--&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| C2 |--&gt;OUT
           <span class="hljs-string">&#x27;----&#x27;</span>          <span class="hljs-string">&#x27;----&#x27;</span>         <span class="hljs-string">&#x27;----&#x27;</span>         <span class="hljs-string">&#x27;----&#x27;</span></code></pre><p>CON = 1</p>
<pre class="hljs"><code>      .-----------.  PG             PG
      v    .----. |   v    .----.    v    .----.
PG--&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| M1 |-+-&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| M2 |--&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| C2 |--&gt;OUT
           <span class="hljs-string">&#x27;----&#x27;</span>     ^    <span class="hljs-string">&#x27;----&#x27;</span>         <span class="hljs-string">&#x27;----&#x27;</span>
           .----.     |
PG--------&gt;| C1 |-----<span class="hljs-string">&#x27;
           &#x27;</span>----<span class="hljs-string">&#x27;</span></code></pre><p>CON = 2</p>
<pre class="hljs"><code>      <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span>
      <span class="hljs-comment">v</span>    <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span> <span class="hljs-comment">|</span>
<span class="hljs-comment">PG</span>--&gt;<span class="hljs-comment">(</span><span class="hljs-literal">+</span><span class="hljs-comment">)</span>--&gt;<span class="hljs-comment">|</span> <span class="hljs-comment">M1</span> <span class="hljs-comment">|</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span>  <span class="hljs-comment">PG</span>
           <span class="hljs-comment">&#x27;</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">&#x27;</span>    <span class="hljs-comment">PG</span>              <span class="hljs-comment">|</span> <span class="hljs-comment">/</span>
           <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span>     <span class="hljs-comment">v</span>    <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span>    <span class="hljs-comment">vL</span>   <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span>
<span class="hljs-comment">PG</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span>&gt;<span class="hljs-comment">|</span> <span class="hljs-comment">C1</span> <span class="hljs-comment">|</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">(</span><span class="hljs-literal">+</span><span class="hljs-comment">)</span>--&gt;<span class="hljs-comment">|</span> <span class="hljs-comment">M2</span> <span class="hljs-comment">|</span>--&gt;<span class="hljs-comment">(</span><span class="hljs-literal">+</span><span class="hljs-comment">)</span>--&gt;<span class="hljs-comment">|</span> <span class="hljs-comment">C2</span> <span class="hljs-comment">|</span>--&gt;<span class="hljs-comment">OUT</span>
           <span class="hljs-comment">&#x27;</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">&#x27;</span>          <span class="hljs-comment">&#x27;</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">&#x27;</span>         <span class="hljs-comment">&#x27;</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">&#x27;</span></code></pre><p>CON = 3</p>
<pre class="hljs"><code>      .-----------.  PG             PG
      v    .----. |   v    .----.    v    .----.
PG--&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| M1 |-+-&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| C1 |--&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| C2 |--&gt;OUT
           <span class="hljs-string">&#x27;----&#x27;</span>          <span class="hljs-string">&#x27;----&#x27;</span>    ^    <span class="hljs-string">&#x27;----&#x27;</span>
                           .----.    |
PG------------------------&gt;| M2 |----<span class="hljs-string">&#x27;
                           &#x27;</span>----<span class="hljs-string">&#x27;</span></code></pre><p>CON = 4</p>
<pre class="hljs"><code>      .-----------.  PG
      v    .----. |   v    .----.
PG--&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| M1 |-+-&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| C1 |--&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>OUT
           <span class="hljs-string">&#x27;----&#x27;</span>    PG    <span class="hljs-string">&#x27;----&#x27;</span>    ^
           .----.     v    .----.    |
PG--------&gt;| M2 |---&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| C2 |----<span class="hljs-string">&#x27;
           &#x27;</span>----<span class="hljs-string">&#x27;          &#x27;</span>----<span class="hljs-string">&#x27;</span></code></pre><p>CON = 5</p>
<pre class="hljs"><code>      .-----------.  PG
      v    .----. |   v    .----.
PG--&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| M1 |-+-&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| C1 |--&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>OUT
           <span class="hljs-string">&#x27;----&#x27;</span> |  PG    <span class="hljs-string">&#x27;----&#x27;</span>    ^
                  |   v    .----.    |
                  +-&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| M2 |--&gt;(+)
                  |  PG    <span class="hljs-string">&#x27;----&#x27;</span>    ^
                  |   v    .----.    |
                  +-&gt;<span class="hljs-function"><span class="hljs-params">(+)</span>--&gt;</span>| C2 |----<span class="hljs-string">&#x27;
                           &#x27;</span>----<span class="hljs-string">&#x27;</span></code></pre><p>CON = 6, CON = 7</p>
<pre class="hljs"><code>      <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span>  <span class="hljs-comment">PG</span>                                <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span>
      <span class="hljs-comment">v</span>    <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span> <span class="hljs-comment">|</span>   <span class="hljs-comment">v</span>    <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span>                      <span class="hljs-comment">v</span>    <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span> <span class="hljs-comment">|</span>
<span class="hljs-comment">PG</span>--&gt;<span class="hljs-comment">(</span><span class="hljs-literal">+</span><span class="hljs-comment">)</span>--&gt;<span class="hljs-comment">|</span> <span class="hljs-comment">M1</span> <span class="hljs-comment">|</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span><span class="hljs-literal">-</span>&gt;<span class="hljs-comment">(</span><span class="hljs-literal">+</span><span class="hljs-comment">)</span>--&gt;<span class="hljs-comment">|</span> <span class="hljs-comment">C1</span> <span class="hljs-comment">|</span>--&gt;<span class="hljs-comment">(</span><span class="hljs-literal">+</span><span class="hljs-comment">)</span>--&gt;<span class="hljs-comment">OUT</span>    <span class="hljs-comment">PG</span>--&gt;<span class="hljs-comment">(</span><span class="hljs-literal">+</span><span class="hljs-comment">)</span>--&gt;<span class="hljs-comment">|</span> <span class="hljs-comment">M1</span> <span class="hljs-comment">|</span><span class="hljs-literal">-</span><span class="hljs-literal">+</span><span class="hljs-literal">-</span>&gt;<span class="hljs-comment">(</span><span class="hljs-literal">+</span><span class="hljs-comment">)</span>--&gt;<span class="hljs-comment">OUT</span>
           <span class="hljs-comment">&#x27;</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">&#x27;</span>          <span class="hljs-comment">&#x27;</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">&#x27;</span>    <span class="hljs-comment">^</span>                      <span class="hljs-comment">&#x27;</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">&#x27;</span>     <span class="hljs-comment">^</span>
                           <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span>    <span class="hljs-comment">|</span>                      <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span>     <span class="hljs-comment">|</span>
<span class="hljs-comment">PG</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span>&gt;<span class="hljs-comment">|</span> <span class="hljs-comment">M2</span> <span class="hljs-comment">|</span>--&gt;<span class="hljs-comment">(</span><span class="hljs-literal">+</span><span class="hljs-comment">)</span>          <span class="hljs-comment">PG</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span>&gt;<span class="hljs-comment">|</span> <span class="hljs-comment">C1</span> <span class="hljs-comment">|</span>--<span class="hljs-literal">-</span>&gt;<span class="hljs-comment">(</span><span class="hljs-literal">+</span><span class="hljs-comment">)</span>
                           <span class="hljs-comment">&#x27;</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">&#x27;</span>    <span class="hljs-comment">^</span>                      <span class="hljs-comment">&#x27;</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">&#x27;</span>     <span class="hljs-comment">^</span>
                           <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span>    <span class="hljs-comment">|</span>                      <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span>     <span class="hljs-comment">|</span>
<span class="hljs-comment">PG</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span>&gt;<span class="hljs-comment">|</span> <span class="hljs-comment">C2</span> <span class="hljs-comment">|</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">&#x27;</span>           <span class="hljs-comment">PG</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span>&gt;<span class="hljs-comment">|</span> <span class="hljs-comment">M2</span> <span class="hljs-comment">|</span>--<span class="hljs-literal">-</span>&gt;<span class="hljs-comment">(</span><span class="hljs-literal">+</span><span class="hljs-comment">)</span>
                           <span class="hljs-comment">&#x27;</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">&#x27;</span>                           <span class="hljs-comment">&#x27;</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">&#x27;</span>     <span class="hljs-comment">^</span>
                                                            <span class="hljs-string">.</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-string">.</span>     <span class="hljs-comment">|</span>
                                                 <span class="hljs-comment">PG</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span>&gt;<span class="hljs-comment">|</span> <span class="hljs-comment">C2</span> <span class="hljs-comment">|</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">&#x27;</span>
                                                            <span class="hljs-comment">&#x27;</span>--<span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">&#x27;</span></code></pre><h2 id="ym2151-control-registers"><a class="header-link" href="#ym2151-control-registers"></a>YM2151 Control Registers</h2>
<h3 id="01h---test-registers"><a class="header-link" href="#01h---test-registers"></a>01h - Test Registers</h3>
<pre class="hljs"><code>Bit
7       Internal Data Byte Select (<span class="hljs-attribute">0</span>=Lower, <span class="hljs-attribute">1</span>=Upper) (undocumented)
6       Internal Data <span class="hljs-builtin-name">Enable</span> (<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable) (undocumented)
5       Halt Envelope Generator (<span class="hljs-attribute">1</span>=Halt) (undocumented)
4       Negate Output Data (<span class="hljs-attribute">0</span>=Normal, <span class="hljs-attribute">1</span>=Negate) (undocumented)
3       Halt Phase Generator <span class="hljs-keyword">and</span> LFO (<span class="hljs-attribute">1</span>=Halt) (undocumented)
2       Manually<span class="hljs-built_in"> Clock </span>All Timers <span class="hljs-keyword">and</span> LFO (undocumented)
1       Halt <span class="hljs-keyword">and</span> Reset LFO (<span class="hljs-attribute">1</span>=Halt)
0       Envelope Generator Speed (<span class="hljs-attribute">0</span>=Normal, <span class="hljs-attribute">1</span>=Double) (undocumented)</code></pre><p>As the name implies, this register is used for testing purposes. It is set to 0
on reset/startup and the software should never change it. Only bit 1 is
mentioned in the application manual as a way to reset LFO to the start of the
waveform by writing 1 then 0 to it.</p>
<p>Enabling internal data will replace the read status register with the following
value, the lower and upper 8 bits of this can be selected with bit 7:</p>
<pre class="hljs"><code><span class="hljs-type">Bit</span>
<span class="hljs-number">15</span>      Phase Generator <span class="hljs-type">Serial</span> Data
<span class="hljs-number">14</span>      Envelope Generator <span class="hljs-type">Serial</span> Data
<span class="hljs-number">13</span><span class="hljs-number">-0</span>    <span class="hljs-keyword">Current</span> Processed Slot<span class="hljs-string">&#x27;s Output Level</span></code></pre><h3 id="1bh---control-output"><a class="header-link" href="#1bh---control-output"></a>1Bh - Control Output</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       CT<span class="hljs-number">2</span>, Output <span class="hljs-literal">on</span> Pin <span class="hljs-number">9</span> (<span class="hljs-number">0</span>=Low, <span class="hljs-number">1</span>=High)
<span class="hljs-attribute">6</span>       CT<span class="hljs-number">1</span>, Output <span class="hljs-literal">on</span> Pin <span class="hljs-number">8</span> (<span class="hljs-number">0</span>=Low, <span class="hljs-number">1</span>=High)
<span class="hljs-attribute">5</span>-<span class="hljs-number">2</span>     Not Used
<span class="hljs-attribute">1</span>-<span class="hljs-number">0</span>     LFO Waveform (see LFO section)</code></pre><p>CT1 and CT2 outputs correspond to physical pins of the same name on the chip.
These are used for general-purpose output. For X16, those pins are not
connected to anything. (?)</p>
<h2 id="ym2151-timers"><a class="header-link" href="#ym2151-timers"></a>YM2151 Timers</h2>
<h3 id="10h11h---timer-a-reload"><a class="header-link" href="#10h11h---timer-a-reload"></a>10h/11h - Timer A Reload</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">15</span>-<span class="hljs-number">10</span>   Not Used
<span class="hljs-attribute">9</span>-<span class="hljs-number">8</span>     Timer A Reload (lower <span class="hljs-number">2</span> bits) (CLKA<span class="hljs-number">2</span>)
<span class="hljs-attribute">7</span>-<span class="hljs-number">0</span>     Timer A Reload (upper <span class="hljs-number">8</span> bits) (CLKA<span class="hljs-number">1</span>)</code></pre><p>Set Timer A reload value. Note that this is not a little endian integer, as the
upper byte defines the lower 2 bits, making the value <code>n = (CLKA1*4)+CLKA2</code>.
The overflow frequency is <code>clk/64/(1024-n)</code> Hz.</p>
<h3 id="12h---timer-b-reload-clkb"><a class="header-link" href="#12h---timer-b-reload-clkb"></a>12h - Timer B Reload (CLKB)</h3>
<p>Set Timer B reload value. All 8 bits are used. The overflow frequency is
<code>clk/1024/(256-CLKB)</code> Hz.</p>
<h3 id="14h---timer-control"><a class="header-link" href="#14h---timer-control"></a>14h - Timer Control</h3>
<pre class="hljs"><code>Bit
7       CSM (<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
6       <span class="hljs-keyword">Not</span> Used
5       Timer B Overflow Reset (<span class="hljs-attribute">1</span>=Reset)
4       Timer A Overflow Reset (<span class="hljs-attribute">1</span>=Reset)
3       Timer B<span class="hljs-built_in"> IRQ </span>(<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
2       Timer A<span class="hljs-built_in"> IRQ </span>(<span class="hljs-attribute">0</span>=Disable, <span class="hljs-attribute">1</span>=Enable)
1       Timer B Start (<span class="hljs-attribute">0</span>=Stop, <span class="hljs-attribute">1</span>=Start)
0       Timer A Start (<span class="hljs-attribute">0</span>=Stop, <span class="hljs-attribute">1</span>=Start)</code></pre><p>Starting a timer (changing from 0 to 1) will automatically load the reload
value to the counter. When CSM is enabled, every slots&#39; envelope generator will
do a key-on every time Timer A overflows.</p>
<h2 id="ym2151-channels-and-slots"><a class="header-link" href="#ym2151-channels-and-slots"></a>YM2151 Channels and Slots</h2>
<p>YM2151 has a total of 32 slots which independently has its own phase generator
and ADSR envelope generator. However, it groups each 4 of them into 8 channels
(giving the &quot;4-op&quot; terminology). Each channel has defined connections between
slots to output to a single channel output. Some of parameters such as main
frequency and connection is defined per-channel. The 4 slots in each channel
has a name given to each of them as functions (or operators). The assignment
for each slot is as follows:</p>
<pre class="hljs"><code><span class="hljs-attribute">Slot</span> No.          <span class="hljs-number">0</span>..<span class="hljs-number">7</span>      |      <span class="hljs-number">8</span>..<span class="hljs-number">15</span>     |     <span class="hljs-number">16</span>..<span class="hljs-number">23</span>     |     <span class="hljs-number">24</span>..<span class="hljs-number">31</span>
<span class="hljs-attribute">Channel</span> No. <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> |<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> |<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> |<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span>
<span class="hljs-attribute">Function</span>           M<span class="hljs-number">1</span>       |       M<span class="hljs-number">2</span>       |       C<span class="hljs-number">1</span>       |       C<span class="hljs-number">2</span></code></pre><h3 id="20h27h---channel-07-output--feedback--connection"><a class="header-link" href="#20h27h---channel-07-output--feedback--connection"></a>20h..27h - Channel 0..7 Output / Feedback / Connection</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Output to Right Channel
<span class="hljs-attribute">6</span>       Output to Left Channel
<span class="hljs-attribute">5</span>-<span class="hljs-number">3</span>     M<span class="hljs-number">1</span> Self-feedback (FB) (<span class="hljs-number">0</span>=No Feedback, <span class="hljs-number">7</span>=Max)
<span class="hljs-attribute">2</span>-<span class="hljs-number">0</span>     Slot Connection (CON) (<span class="hljs-number">0</span>-<span class="hljs-number">7</span>)</code></pre><p>Self-feedback is done by taking M1&#39;s output, multiply with <code>pi*2^(FB-5)</code>, then
add it back with M1&#39;s input in the next sample. This will alter the waveform
as shown in a following example:</p>
<pre class="hljs"><code> .<span class="hljs-string">&#x27;.     .&#x27;</span>.        <span class="hljs-attribute">FB</span>=0, <span class="hljs-attribute">TL</span>=0
/   \   /   \       <span class="hljs-literal">No</span> feedback, Sine wave output
     <span class="hljs-string">&#x27;.&#x27;</span>     <span class="hljs-string">&#x27;.&#x27;</span>    

<span class="hljs-string">&#x27;.      &#x27;</span>.          <span class="hljs-attribute">FB</span>=4, <span class="hljs-attribute">TL</span>=0
  <span class="hljs-string">&#x27;-.     &#x27;</span>-.       Filtered Saw wave output
     <span class="hljs-string">&#x27;./     &#x27;</span>./    
  _       _
+/ +! \!+/ +! \!    <span class="hljs-attribute">FB</span>=7, <span class="hljs-attribute">TL</span>=0
!- !+ -+!- !+ -+    Overflow, Noise-like output
+\ +!_/!+\ +!_/!   </code></pre><p>For details about slot connections, see:<br><a href="#ym2151-block-diagram">YM2151 Block Diagram</a>  </p>
<h2 id="ym2151-phase-generator"><a class="header-link" href="#ym2151-phase-generator"></a>YM2151 Phase Generator</h2>
<h3 id="28h2fh---channel-07-key-code-kc"><a class="header-link" href="#28h2fh---channel-07-key-code-kc"></a>28h..2Fh - Channel 0..7 Key Code (KC)</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Not Used
<span class="hljs-attribute">6</span>-<span class="hljs-number">4</span>     Octave
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     Note</code></pre><p>Note means a 12-tone interval. The relation between bit 0-3 value and a key
code value is as follows:</p>
<pre class="hljs"><code><span class="hljs-attribute">0h</span>=0/C# <span class="hljs-attribute">4h</span>=3/E  <span class="hljs-attribute">8h</span>=6/G  <span class="hljs-attribute">Ch</span>=9 /A#
<span class="hljs-attribute">1h</span>=1/D  <span class="hljs-attribute">5h</span>=4/F  <span class="hljs-attribute">9h</span>=7/G# <span class="hljs-attribute">Dh</span>=10/B
<span class="hljs-attribute">2h</span>=2/D# <span class="hljs-attribute">6h</span>=5/F# <span class="hljs-attribute">Ah</span>=8/A  <span class="hljs-attribute">Eh</span>=11/C
<span class="hljs-attribute">3h</span>=2/D# <span class="hljs-attribute">7h</span>=5/F# <span class="hljs-attribute">Bh</span>=8/A  <span class="hljs-attribute">Fh</span>=11/C ; This row are invalid values, <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> use</code></pre><p>Every mentions of key code or KC in this document will be referred as a
continuous value after invalid &quot;gaps&quot; removal. Which means that its lower 3
bits can only be 0-11. Any calculations on the chip that modifies this value
will automatically adjust the result to be in a valid form, similar to how BCD
digits are handled.</p>
<h3 id="30h37h---channel-07-key-fraction"><a class="header-link" href="#30h37h---channel-07-key-fraction"></a>30h..37h - Channel 0..7 Key Fraction</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">2</span>     Key Fraction (KF); n*<span class="hljs-number">100</span>/<span class="hljs-number">64</span> cents
<span class="hljs-attribute">1</span>-<span class="hljs-number">0</span>     Not Used</code></pre><p>The entire register byte can be seen as an 8-bit fraction part of Note value
with lower 2 bits always being zero. This register and key code&#39;s value will
be used as an input to the phase generator of every mapped slots of this
channel.</p>
<h3 id="frequency-register-notes"><a class="header-link" href="#frequency-register-notes"></a>Frequency Register Notes</h3>
<p>Since the chip internally works in linear phase steps but has note+cents
exponential frequency definition. It combines KF register and a Note value set
in KC register to produce an index to a lookup table. The lookup table has
phase step values in such a way that a Note value of 0 and a KF of 0 means
C# note + 0 cents, when the chip runs at 3579545Hz clock (which is luckily the
case for X16).</p>
<p>The output frequency can be calculated as <code>LUT[Note*64+KF]*(2^Octave)</code> Hz. And
the phase step can be calculated as <code>clk*n/2^26</code> Hz.</p>
<h3 id="40h5fh---slot-031-detune-1--phase-multiply"><a class="header-link" href="#40h5fh---slot-031-detune-1--phase-multiply"></a>40h..5Fh - Slot 0..31 Detune 1 / Phase Multiply</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Not Used
<span class="hljs-attribute">6</span>       Detune <span class="hljs-number">1</span> (DT<span class="hljs-number">1</span>) Sign (<span class="hljs-number">0</span>=Positive, <span class="hljs-number">1</span>=Negative)
<span class="hljs-attribute">5</span>-<span class="hljs-number">4</span>     Detune <span class="hljs-number">1</span> (DT<span class="hljs-number">1</span>) Amount (<span class="hljs-number">0</span>-<span class="hljs-number">3</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     Phase Multiply (MUL) (<span class="hljs-number">0</span>=<span class="hljs-number">0</span>.<span class="hljs-number">5</span>x, <span class="hljs-number">1</span>=<span class="hljs-number">1</span>x..<span class="hljs-number">15</span>=<span class="hljs-number">15</span>x)</code></pre><p>Detune 1 values can be treated as a 3-bit one&#39;s complement number. This will
apply a tiny change to the phase step in each slot&#39;s phase generator. Resulting
in a slight inharmonic, strings-like timbre to the voice. The amount to
add/subtract to the phase step also depends on the current Key Code value as
shown in the following table:</p>
<pre class="hljs"><code>KC[6..2]    +/- Phase Step      +/- Cents (approx.)
OCT NOTE    0   1   2   3       0       1       2       3     DT1[1..0]
--------------------------------------------------------------
 0  0<span class="hljs-string">-2</span>     0   0   1   2       0.000   0.000   5.025  10.036
 0  3<span class="hljs-string">-5</span>     0   0   1   2       0.000   0.000   4.225   8.440
 0  6<span class="hljs-string">-8</span>     0   0   1   2       0.000   0.000   3.555   7.103
 0  9<span class="hljs-string">-11</span>    0   0   1   2       0.000   0.000   2.989   5.972
 1  0<span class="hljs-string">-2</span>     0   1   2   2       0.000   2.515   5.025   5.025
 1  3<span class="hljs-string">-5</span>     0   1   2   3       0.000   2.114   4.225   6.334
 1  6<span class="hljs-string">-8</span>     0   1   2   3       0.000   1.778   3.555   5.330
 1  9<span class="hljs-string">-11</span>    0   1   2   3       0.000   1.495   2.989   4.481
 2  0<span class="hljs-string">-2</span>     0   1   2   4       0.000   1.258   2.515   5.025
 2  3<span class="hljs-string">-5</span>     0   1   3   4       0.000   1.057   3.170   4.225
 2  6<span class="hljs-string">-8</span>     0   1   3   4       0.000   0.889   2.667   3.555
 2  9<span class="hljs-string">-11</span>    0   1   3   5       0.000   0.748   2.242   3.735
 3  0<span class="hljs-string">-2</span>     0   2   4   5       0.000   1.258   2.515   3.143
 3  3<span class="hljs-string">-5</span>     0   2   4   6       0.000   1.057   2.114   3.170
 3  6<span class="hljs-string">-8</span>     0   2   4   6       0.000   0.889   1.778   2.667
 3  9<span class="hljs-string">-11</span>    0   2   5   7       0.000   0.748   1.869   2.615
 4  0<span class="hljs-string">-2</span>     0   2   5   8       0.000   0.629   1.572   2.515
 4  3<span class="hljs-string">-5</span>     0   3   6   8       0.000   0.793   1.586   2.114
 4  6<span class="hljs-string">-8</span>     0   3   6   9       0.000   0.667   1.334   2.001
 4  9<span class="hljs-string">-11</span>    0   3   7  10       0.000   0.561   1.308   1.869
 5  0<span class="hljs-string">-2</span>     0   4   8  11       0.000   0.629   1.258   1.729
 5  3<span class="hljs-string">-5</span>     0   4   8  12       0.000   0.529   1.057   1.586
 5  6<span class="hljs-string">-8</span>     0   4   9  13       0.000   0.445   1.001   1.445
 5  9<span class="hljs-string">-11</span>    0   5  10  14       0.000   0.467   0.935   1.308
 6  0<span class="hljs-string">-2</span>     0   5  11  16       0.000   0.393   0.865   1.258
 6  3<span class="hljs-string">-5</span>     0   6  12  17       0.000   0.397   0.793   1.123
 6  6<span class="hljs-string">-8</span>     0   6  13  19       0.000   0.334   0.723   1.056
 6  9<span class="hljs-string">-11</span>    0   7  14  20       0.000   0.327   0.654   0.935
 7  0<span class="hljs-string">-2</span>     0   8  16  22       0.000   0.315   0.629   0.865
 7  3<span class="hljs-string">-5</span>     0   8  16  22       0.000   0.264   0.529   0.727
 7  6<span class="hljs-string">-8</span>     0   8  16  22       0.000   0.222   0.445   0.612
 7  9<span class="hljs-string">-11</span>    0   8  16  22       0.000   0.187   0.374   0.514</code></pre><p>NOTE: KC here is a Key Code value <em>after</em> LFO and DT2 adjustment. See Slot
Block Diagram section for more details.</p>
<p>Phase Multiply value will multiply the final phase step value by the specified
multiple. A value of 0 is special and means 0.5x instead of 0x. This puts the
slot&#39;s wave output in a different (sub-)harmonic compared to other slots of the
same channel.</p>
<h3 id="c0hdfh---slot-031-detune-2"><a class="header-link" href="#c0hdfh---slot-031-detune-2"></a>C0h..DFh - Slot 0..31 Detune 2</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">6</span>     Detune <span class="hljs-number">2</span> (DT<span class="hljs-number">2</span>) (<span class="hljs-number">0</span>-<span class="hljs-number">3</span>)
<span class="hljs-attribute">5</span>       Not Used
<span class="hljs-attribute">4</span>-<span class="hljs-number">0</span>     Decay <span class="hljs-number">2</span> Rate (D<span class="hljs-number">2</span>R) (see ADSR Envelope section)</code></pre><p>Detune 2 will apply a substantial change to the <em>key code</em> in each slot&#39;s phase
generator. The amount to add/subtract to the key code are mostly inharmonic,
which is useful for certain sound effects and percussions, as shown in the
following table:</p>
<pre class="hljs"><code><span class="hljs-attribute">DT2</span>     + KC;KF     + Cents     x Frequency
<span class="hljs-attribute">0</span>       <span class="hljs-number">0</span>;<span class="hljs-number">00</span>        <span class="hljs-number">0</span>           <span class="hljs-number">1</span>.<span class="hljs-number">000</span>
<span class="hljs-attribute">1</span>       <span class="hljs-number">6</span>;<span class="hljs-number">00</span>        <span class="hljs-number">600</span>         <span class="hljs-number">1</span>.<span class="hljs-number">414</span>
<span class="hljs-attribute">2</span>       <span class="hljs-number">7</span>;<span class="hljs-number">52</span>        <span class="hljs-number">781</span>         <span class="hljs-number">1</span>.<span class="hljs-number">570</span>
<span class="hljs-attribute">3</span>       <span class="hljs-number">9</span>;<span class="hljs-number">32</span>        <span class="hljs-number">950</span>         <span class="hljs-number">1</span>.<span class="hljs-number">731</span></code></pre><h2 id="ym2151-adsr-envelope"><a class="header-link" href="#ym2151-adsr-envelope"></a>YM2151 ADSR Envelope</h2>
<p>YM2151&#39;s envelope can be summarized as follows:</p>
<pre class="hljs"><code> dB
  0 -|<span class="hljs-string">     ,</span>|<span class="hljs-string">   </span>|<span class="hljs-string">              </span>|
     |<span class="hljs-string">    / </span>|<span class="hljs-string">`. </span>|<span class="hljs-string">              </span>|
D1L -|<span class="hljs-string">   /  </span>|<span class="hljs-string">  `</span>|<span class="hljs-string">--            </span>|
     |<span class="hljs-string">  /   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">  ``--..      </span>|
     |<span class="hljs-string"> /    </span>|<span class="hljs-string">   </span>|<span class="hljs-string">        ``--..</span>|
-96 -|<span class="hljs-string">/     </span>|<span class="hljs-string">   </span>|<span class="hljs-string">              </span>|<span class="hljs-string">\
     </span>|<span class="hljs-string">  AR   D1R      D2R      </span>|RR
   Keyon                    Keyoff  Time-&gt;</code></pre><h3 id="08h---key-on--off"><a class="header-link" href="#08h---key-on--off"></a>08h - Key On / Off</h3>
<pre class="hljs"><code><span class="hljs-variable">Bit</span>
<span class="hljs-number">7</span>       <span class="hljs-built_in">Not</span> <span class="hljs-variable">Used</span>
<span class="hljs-number">6</span>       <span class="hljs-variable">C2</span> <span class="hljs-built_in">Function</span> <span class="hljs-built_in">Slot</span> <span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-operator">=</span><span class="hljs-built_in">Key</span> <span class="hljs-built_in">Off</span><span class="hljs-operator">,</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-built_in">Key</span> <span class="hljs-built_in">On</span><span class="hljs-punctuation">)</span>
<span class="hljs-number">5</span>       <span class="hljs-variable">M2</span> <span class="hljs-built_in">Function</span> <span class="hljs-built_in">Slot</span> <span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-operator">=</span><span class="hljs-built_in">Key</span> <span class="hljs-built_in">Off</span><span class="hljs-operator">,</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-built_in">Key</span> <span class="hljs-built_in">On</span><span class="hljs-punctuation">)</span>
<span class="hljs-number">4</span>       <span class="hljs-variable">C1</span> <span class="hljs-built_in">Function</span> <span class="hljs-built_in">Slot</span> <span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-operator">=</span><span class="hljs-built_in">Key</span> <span class="hljs-built_in">Off</span><span class="hljs-operator">,</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-built_in">Key</span> <span class="hljs-built_in">On</span><span class="hljs-punctuation">)</span>
<span class="hljs-number">3</span>       <span class="hljs-variable">M1</span> <span class="hljs-built_in">Function</span> <span class="hljs-built_in">Slot</span> <span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-operator">=</span><span class="hljs-built_in">Key</span> <span class="hljs-built_in">Off</span><span class="hljs-operator">,</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-built_in">Key</span> <span class="hljs-built_in">On</span><span class="hljs-punctuation">)</span>
<span class="hljs-number">2</span><span class="hljs-operator">-</span><span class="hljs-number">0</span>     <span class="hljs-variable">Channel</span> <span class="hljs-built_in">Number</span> <span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-operator">-</span><span class="hljs-number">7</span><span class="hljs-punctuation">)</span></code></pre><p>Sends a Key On or a Key Off signal to each mapped slots of the specified
Channel Number. An off to on transition will reset the slot&#39;s Envelope
Generator state to Attack (but won&#39;t change the envelope value to lowest). And
an on to off transition will change it to Release. </p>
<p>The mapping between each Channel Number/Function Slot combination and the
target Slot Number is as follows, in this register&#39;s perspective:</p>
<pre class="hljs"><code><span class="hljs-attribute">CH</span> No. (Bit <span class="hljs-number">2</span>-<span class="hljs-number">0</span>)       <span class="hljs-number">0</span>       |       <span class="hljs-number">1</span>       |       <span class="hljs-number">2</span>       |       <span class="hljs-number">3</span>
<span class="hljs-attribute">Reg</span>. Bit         <span class="hljs-number">6</span>   <span class="hljs-number">5</span>   <span class="hljs-number">4</span>   <span class="hljs-number">3</span> | <span class="hljs-number">6</span>   <span class="hljs-number">5</span>   <span class="hljs-number">4</span>   <span class="hljs-number">3</span> | <span class="hljs-number">6</span>   <span class="hljs-number">5</span>   <span class="hljs-number">4</span>   <span class="hljs-number">3</span> | <span class="hljs-number">6</span>   <span class="hljs-number">5</span>   <span class="hljs-number">4</span>   <span class="hljs-number">3</span>
<span class="hljs-attribute">Function</span>         C<span class="hljs-number">2</span>  M<span class="hljs-number">2</span>  C<span class="hljs-number">1</span>  M<span class="hljs-number">1</span>| C<span class="hljs-number">2</span>  M<span class="hljs-number">2</span>  C<span class="hljs-number">1</span>  M<span class="hljs-number">1</span>| C<span class="hljs-number">2</span>  M<span class="hljs-number">2</span>  C<span class="hljs-number">1</span>  M<span class="hljs-number">1</span>| C<span class="hljs-number">2</span>  M<span class="hljs-number">2</span>  C<span class="hljs-number">1</span>  M<span class="hljs-number">1</span>
<span class="hljs-attribute">Slot</span> No.         <span class="hljs-number">24</span>  <span class="hljs-number">8</span>   <span class="hljs-number">16</span>  <span class="hljs-number">0</span> | <span class="hljs-number">25</span>  <span class="hljs-number">9</span>   <span class="hljs-number">17</span>  <span class="hljs-number">1</span> | <span class="hljs-number">26</span>  <span class="hljs-number">10</span>  <span class="hljs-number">18</span>  <span class="hljs-number">2</span> | <span class="hljs-number">27</span>  <span class="hljs-number">11</span>  <span class="hljs-number">19</span>  <span class="hljs-number">3</span>

<span class="hljs-attribute">CH</span> No. (Bit <span class="hljs-number">2</span>-<span class="hljs-number">0</span>)       <span class="hljs-number">4</span>       |       <span class="hljs-number">5</span>       |       <span class="hljs-number">6</span>       |       <span class="hljs-number">7</span>
<span class="hljs-attribute">Reg</span>. Bit         <span class="hljs-number">6</span>   <span class="hljs-number">5</span>   <span class="hljs-number">4</span>   <span class="hljs-number">3</span> | <span class="hljs-number">6</span>   <span class="hljs-number">5</span>   <span class="hljs-number">4</span>   <span class="hljs-number">3</span> | <span class="hljs-number">6</span>   <span class="hljs-number">5</span>   <span class="hljs-number">4</span>   <span class="hljs-number">3</span> | <span class="hljs-number">6</span>   <span class="hljs-number">5</span>   <span class="hljs-number">4</span>   <span class="hljs-number">3</span>
<span class="hljs-attribute">Function</span>         C<span class="hljs-number">2</span>  M<span class="hljs-number">2</span>  C<span class="hljs-number">1</span>  M<span class="hljs-number">1</span>| C<span class="hljs-number">2</span>  M<span class="hljs-number">2</span>  C<span class="hljs-number">1</span>  M<span class="hljs-number">1</span>| C<span class="hljs-number">2</span>  M<span class="hljs-number">2</span>  C<span class="hljs-number">1</span>  M<span class="hljs-number">1</span>| C<span class="hljs-number">2</span>  M<span class="hljs-number">2</span>  C<span class="hljs-number">1</span>  M<span class="hljs-number">1</span>
<span class="hljs-attribute">Slot</span> No.         <span class="hljs-number">28</span>  <span class="hljs-number">12</span>  <span class="hljs-number">20</span>  <span class="hljs-number">4</span> | <span class="hljs-number">29</span>  <span class="hljs-number">13</span>  <span class="hljs-number">21</span>  <span class="hljs-number">5</span> | <span class="hljs-number">30</span>  <span class="hljs-number">14</span>  <span class="hljs-number">22</span>  <span class="hljs-number">6</span> | <span class="hljs-number">31</span>  <span class="hljs-number">15</span>  <span class="hljs-number">23</span>  <span class="hljs-number">7</span></code></pre><h3 id="60h7fh---slot-031-total-level"><a class="header-link" href="#60h7fh---slot-031-total-level"></a>60h..7Fh - Slot 0..31 Total Level</h3>
<pre class="hljs"><code>Bit
7       <span class="hljs-keyword">Not</span> Used
6-0     Total Level (TL) (<span class="hljs-attribute">0</span>=Loudest, <span class="hljs-attribute">127</span>=Silent)</code></pre><p>Total Level will apply an attenuation after the current envelope value is
determined, leaving the overall envelope duration unchanged. The value is in
0.75 dB steps from 0 to -95.25 dB</p>
<h3 id="80h9fh---slot-031-key-scaling--attack-rate"><a class="header-link" href="#80h9fh---slot-031-key-scaling--attack-rate"></a>80h..9Fh - Slot 0..31 Key Scaling / Attack Rate</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">6</span>     Key Scaling (KS) (<span class="hljs-number">0</span>-<span class="hljs-number">3</span>)
<span class="hljs-attribute">5</span>       Not Used
<span class="hljs-attribute">4</span>-<span class="hljs-number">0</span>     Attack Rate (AR) (<span class="hljs-number">0</span>=No Attack, <span class="hljs-number">31</span>=Fastest)</code></pre><p>Key Scaling scales AR, D1R, D2R and RR rates according to the current key code
value. This is used to replicate some instruments that has faster envelope the
higher pitch it produces. If the rates are 0, KS is forced to be 0.</p>
<p>Attack Rate of 0 (no attack) means the envelope will never ramps up.</p>
<h3 id="a0hbfh---slot-031-decay-1-rate"><a class="header-link" href="#a0hbfh---slot-031-decay-1-rate"></a>A0h..BFh - Slot 0..31 Decay 1 Rate</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       AMS Enable (see LFO section)
<span class="hljs-attribute">6</span>-<span class="hljs-number">5</span>     Not Used
<span class="hljs-attribute">4</span>-<span class="hljs-number">0</span>     Decay <span class="hljs-number">1</span> Rate (D<span class="hljs-number">1</span>R) (<span class="hljs-number">0</span>=No Decay, <span class="hljs-number">31</span>=Fastest)</code></pre><h3 id="c0hdfh---slot-031-decay-2-rate"><a class="header-link" href="#c0hdfh---slot-031-decay-2-rate"></a>C0h..DFh - Slot 0..31 Decay 2 Rate</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">6</span>     Detune <span class="hljs-number">2</span> (DT<span class="hljs-number">2</span>) (see Phase Generator section)
<span class="hljs-attribute">5</span>       Not Used
<span class="hljs-attribute">4</span>-<span class="hljs-number">0</span>     Decay <span class="hljs-number">2</span> Rate (D<span class="hljs-number">2</span>R) (<span class="hljs-number">0</span>=No Decay, <span class="hljs-number">31</span>=Fastest)</code></pre><h3 id="e0hffh---slot-031-decay-1-level--release-rate"><a class="header-link" href="#e0hffh---slot-031-decay-1-level--release-rate"></a>E0h..FFh - Slot 0..31 Decay 1 Level / Release Rate</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>-<span class="hljs-number">4</span>     Decay <span class="hljs-number">1</span> Level (D<span class="hljs-number">1</span>L) (<span class="hljs-number">0</span>-<span class="hljs-number">15</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">0</span>     Release Rate (RR) (<span class="hljs-number">0</span>=No Release, <span class="hljs-number">15</span>=Fastest)</code></pre><p>Decay 1 Level will set the point in the envelope generator to change from Decay
1 Rate to Decay 2 Rate once the envelope value changes past it during the decay
phase. The value is in 3 dB steps from 0 to -42 dB, D1L value of 15 is special
and means -93 dB. If D1L is 0, the envelope generator will immediately skip
Decay 1 phase even if D1R is 0.</p>
<h3 id="adsr-rates"><a class="header-link" href="#adsr-rates"></a>ADSR Rates</h3>
<p>There are two categories of envelope rates, Attack Rate for AR and Decay Rate
for D1R, D2R and RR. The resulting internal rate value can be calculated as
<code>RATE = xR*2+(KC SHR (5-KS))</code> where xR is AR, D1R, D2R or RR*2+1 value. If
RATE is greater than 63 then clamp it to 63. Actual envelope rates are defined
as follows (assuming 3579545Hz clock rate):</p>
<pre class="hljs"><code>RATE  Attack Time Decay Time/Rate     | RATE  Attack Time Decay Time/Rate
      (-<span class="hljs-number">96</span>..<span class="hljs-number">0</span> dB) (<span class="hljs-number">0</span>..-<span class="hljs-number">96d</span>B)          |       (-<span class="hljs-number">96</span>..<span class="hljs-number">0</span> dB) (<span class="hljs-number">0</span>..-<span class="hljs-number">96d</span>B)
      ms          ms        dB/s      |       ms          ms        dB/s
<span class="hljs-number">0</span>     Inf.        Inf.      <span class="hljs-number">0.00000</span>   | <span class="hljs-number">32</span>    <span class="hljs-number">62</span>.<span class="hljs-number">2201</span>     <span class="hljs-number">878.806</span>   <span class="hljs-number">109.239</span>
<span class="hljs-number">1</span>     Inf.        Inf.      <span class="hljs-number">0.00000</span>   | <span class="hljs-number">33</span>    <span class="hljs-number">49</span>.<span class="hljs-number">7761</span>     <span class="hljs-number">703.045</span>   <span class="hljs-number">136.548</span>
<span class="hljs-number">2</span>     Inf.        Inf.      <span class="hljs-number">0.00000</span>   | <span class="hljs-number">34</span>    <span class="hljs-number">41</span>.<span class="hljs-number">6231</span>     <span class="hljs-number">585.871</span>   <span class="hljs-number">163.858</span>
<span class="hljs-number">3</span>     Inf.        Inf.      <span class="hljs-number">0.00000</span>   | <span class="hljs-number">35</span>    <span class="hljs-number">35</span>.<span class="hljs-number">6156</span>     <span class="hljs-number">502.175</span>   <span class="hljs-number">191.168</span>
<span class="hljs-number">4</span>     <span class="hljs-number">7964</span>.<span class="hljs-number">18</span>     <span class="hljs-number">112487</span>.   <span class="hljs-number">0.85343</span>   | <span class="hljs-number">36</span>    <span class="hljs-number">31</span>.<span class="hljs-number">1100</span>     <span class="hljs-number">439.403</span>   <span class="hljs-number">218.478</span>
<span class="hljs-number">5</span>     <span class="hljs-number">7964</span>.<span class="hljs-number">18</span>     <span class="hljs-number">112487</span>.   <span class="hljs-number">0.85343</span>   | <span class="hljs-number">37</span>    <span class="hljs-number">24</span>.<span class="hljs-number">8880</span>     <span class="hljs-number">351.522</span>   <span class="hljs-number">273.097</span>
<span class="hljs-number">6</span>     <span class="hljs-number">5327</span>.<span class="hljs-number">76</span>     <span class="hljs-number">74991.5</span>   <span class="hljs-number">1.28014</span>   | <span class="hljs-number">38</span>    <span class="hljs-number">20</span>.<span class="hljs-number">8115</span>     <span class="hljs-number">292.935</span>   <span class="hljs-number">327.717</span>
<span class="hljs-number">7</span>     <span class="hljs-number">5327</span>.<span class="hljs-number">76</span>     <span class="hljs-number">74991.5</span>   <span class="hljs-number">1.28014</span>   | <span class="hljs-number">39</span>    <span class="hljs-number">17</span>.<span class="hljs-number">8078</span>     <span class="hljs-number">251.087</span>   <span class="hljs-number">382.336</span>
<span class="hljs-number">8</span>     <span class="hljs-number">3982</span>.<span class="hljs-number">09</span>     <span class="hljs-number">56243.6</span>   <span class="hljs-number">1.70686</span>   | <span class="hljs-number">40</span>    <span class="hljs-number">15</span>.<span class="hljs-number">5550</span>     <span class="hljs-number">219.701</span>   <span class="hljs-number">436.956</span>
<span class="hljs-number">9</span>     <span class="hljs-number">3185</span>.<span class="hljs-number">67</span>     <span class="hljs-number">44994.9</span>   <span class="hljs-number">2.13357</span>   | <span class="hljs-number">41</span>    <span class="hljs-number">12</span>.<span class="hljs-number">4440</span>     <span class="hljs-number">175.761</span>   <span class="hljs-number">546.195</span>
<span class="hljs-number">10</span>    <span class="hljs-number">2663</span>.<span class="hljs-number">88</span>     <span class="hljs-number">37495.7</span>   <span class="hljs-number">2.56029</span>   | <span class="hljs-number">42</span>    <span class="hljs-number">10</span>.<span class="hljs-number">4057</span>     <span class="hljs-number">146.467</span>   <span class="hljs-number">655.434</span>
<span class="hljs-number">11</span>    <span class="hljs-number">2279</span>.<span class="hljs-number">40</span>     <span class="hljs-number">32139.2</span>   <span class="hljs-number">2.98700</span>   | <span class="hljs-number">43</span>    <span class="hljs-number">8.90392</span>     <span class="hljs-number">125.543</span>   <span class="hljs-number">764.673</span>
<span class="hljs-number">12</span>    <span class="hljs-number">1991</span>.<span class="hljs-number">04</span>     <span class="hljs-number">28121.8</span>   <span class="hljs-number">3.41372</span>   | <span class="hljs-number">44</span>    <span class="hljs-number">7.77752</span>     <span class="hljs-number">109.850</span>   <span class="hljs-number">873.912</span>
<span class="hljs-number">13</span>    <span class="hljs-number">1592</span>.<span class="hljs-number">83</span>     <span class="hljs-number">22497.4</span>   <span class="hljs-number">4.26715</span>   | <span class="hljs-number">45</span>    <span class="hljs-number">6.22201</span>     <span class="hljs-number">87</span>.<span class="hljs-number">8806</span>   <span class="hljs-number">1092</span>.<span class="hljs-number">39</span>
<span class="hljs-number">14</span>    <span class="hljs-number">1331</span>.<span class="hljs-number">94</span>     <span class="hljs-number">18747.8</span>   <span class="hljs-number">5.12058</span>   | <span class="hljs-number">46</span>    <span class="hljs-number">5.20289</span>     <span class="hljs-number">73</span>.<span class="hljs-number">2338</span>   <span class="hljs-number">1310</span>.<span class="hljs-number">86</span>
<span class="hljs-number">15</span>    <span class="hljs-number">1139</span>.<span class="hljs-number">70</span>     <span class="hljs-number">16069.6</span>   <span class="hljs-number">5.97401</span>   | <span class="hljs-number">47</span>    <span class="hljs-number">4.45196</span>     <span class="hljs-number">62</span>.<span class="hljs-number">7719</span>   <span class="hljs-number">1529</span>.<span class="hljs-number">34</span>
<span class="hljs-number">16</span>    <span class="hljs-number">995.523</span>     <span class="hljs-number">14060.9</span>   <span class="hljs-number">6.82744</span>   | <span class="hljs-number">48</span>    <span class="hljs-number">3.91558</span>     <span class="hljs-number">54</span>.<span class="hljs-number">9254</span>   <span class="hljs-number">1747</span>.<span class="hljs-number">82</span>
<span class="hljs-number">17</span>    <span class="hljs-number">796.418</span>     <span class="hljs-number">11248.7</span>   <span class="hljs-number">8.53430</span>   | <span class="hljs-number">49</span>    <span class="hljs-number">3.27192</span>     <span class="hljs-number">43</span>.<span class="hljs-number">9403</span>   <span class="hljs-number">2184</span>.<span class="hljs-number">78</span>
<span class="hljs-number">18</span>    <span class="hljs-number">665.970</span>     <span class="hljs-number">9373</span>.<span class="hljs-number">93</span>   <span class="hljs-number">10</span>.<span class="hljs-number">2411</span>   | <span class="hljs-number">50</span>    <span class="hljs-number">2.78918</span>     <span class="hljs-number">36</span>.<span class="hljs-number">6169</span>   <span class="hljs-number">2621</span>.<span class="hljs-number">73</span>
<span class="hljs-number">19</span>    <span class="hljs-number">569.851</span>     <span class="hljs-number">8034</span>.<span class="hljs-number">80</span>   <span class="hljs-number">11</span>.<span class="hljs-number">9480</span>   | <span class="hljs-number">51</span>    <span class="hljs-number">2.41371</span>     <span class="hljs-number">31</span>.<span class="hljs-number">3859</span>   <span class="hljs-number">3058</span>.<span class="hljs-number">69</span>
<span class="hljs-number">20</span>    <span class="hljs-number">497.761</span>     <span class="hljs-number">7030</span>.<span class="hljs-number">45</span>   <span class="hljs-number">13</span>.<span class="hljs-number">6548</span>   | <span class="hljs-number">52</span>    <span class="hljs-number">2.14552</span>     <span class="hljs-number">27</span>.<span class="hljs-number">4627</span>   <span class="hljs-number">3495</span>.<span class="hljs-number">64</span>
<span class="hljs-number">21</span>    <span class="hljs-number">398.209</span>     <span class="hljs-number">5624</span>.<span class="hljs-number">36</span>   <span class="hljs-number">17</span>.<span class="hljs-number">0686</span>   | <span class="hljs-number">53</span>    <span class="hljs-number">1.77005</span>     <span class="hljs-number">21</span>.<span class="hljs-number">9701</span>   <span class="hljs-number">4369</span>.<span class="hljs-number">56</span>
<span class="hljs-number">22</span>    <span class="hljs-number">332.985</span>     <span class="hljs-number">4686</span>.<span class="hljs-number">96</span>   <span class="hljs-number">20</span>.<span class="hljs-number">4823</span>   | <span class="hljs-number">54</span>    <span class="hljs-number">1.50186</span>     <span class="hljs-number">18</span>.<span class="hljs-number">3084</span>   <span class="hljs-number">5243</span>.<span class="hljs-number">47</span>
<span class="hljs-number">23</span>    <span class="hljs-number">284.925</span>     <span class="hljs-number">4017</span>.<span class="hljs-number">40</span>   <span class="hljs-number">23</span>.<span class="hljs-number">8960</span>   | <span class="hljs-number">55</span>    <span class="hljs-number">1.28731</span>     <span class="hljs-number">15</span>.<span class="hljs-number">6929</span>   <span class="hljs-number">6117</span>.<span class="hljs-number">38</span>
<span class="hljs-number">24</span>    <span class="hljs-number">248.880</span>     <span class="hljs-number">3515</span>.<span class="hljs-number">22</span>   <span class="hljs-number">27</span>.<span class="hljs-number">3097</span>   | <span class="hljs-number">56</span>    <span class="hljs-number">1.12640</span>     <span class="hljs-number">13</span>.<span class="hljs-number">7313</span>   <span class="hljs-number">6991</span>.<span class="hljs-number">29</span>
<span class="hljs-number">25</span>    <span class="hljs-number">199.104</span>     <span class="hljs-number">2812</span>.<span class="hljs-number">18</span>   <span class="hljs-number">34</span>.<span class="hljs-number">1372</span>   | <span class="hljs-number">57</span>    <span class="hljs-number">1.12640</span>     <span class="hljs-number">10</span>.<span class="hljs-number">9850</span>   <span class="hljs-number">8739</span>.<span class="hljs-number">12</span>
<span class="hljs-number">26</span>    <span class="hljs-number">166.492</span>     <span class="hljs-number">2343</span>.<span class="hljs-number">48</span>   <span class="hljs-number">40</span>.<span class="hljs-number">9646</span>   | <span class="hljs-number">58</span>    <span class="hljs-number">0.75093</span>     <span class="hljs-number">9.15423</span>   <span class="hljs-number">10486.9</span>
<span class="hljs-number">27</span>    <span class="hljs-number">142.462</span>     <span class="hljs-number">2008</span>.<span class="hljs-number">70</span>   <span class="hljs-number">47</span>.<span class="hljs-number">7920</span>   | <span class="hljs-number">59</span>    <span class="hljs-number">0.75093</span>     <span class="hljs-number">7.84648</span>   <span class="hljs-number">12234.7</span>
<span class="hljs-number">28</span>    <span class="hljs-number">124.440</span>     <span class="hljs-number">1757</span>.<span class="hljs-number">61</span>   <span class="hljs-number">54</span>.<span class="hljs-number">6195</span>   | <span class="hljs-number">60</span>    <span class="hljs-number">0.53638</span>     <span class="hljs-number">6.86567</span>   <span class="hljs-number">13982.5</span>
<span class="hljs-number">29</span>    <span class="hljs-number">99</span>.<span class="hljs-number">5523</span>     <span class="hljs-number">1406</span>.<span class="hljs-number">09</span>   <span class="hljs-number">68</span>.<span class="hljs-number">2744</span>   | <span class="hljs-number">61</span>    <span class="hljs-number">0.53638</span>     <span class="hljs-number">6.86567</span>   <span class="hljs-number">13982.5</span>
<span class="hljs-number">30</span>    <span class="hljs-number">83</span>.<span class="hljs-number">2463</span>     <span class="hljs-number">1171</span>.<span class="hljs-number">74</span>   <span class="hljs-number">81</span>.<span class="hljs-number">9292</span>   | <span class="hljs-number">62</span>    <span class="hljs-number">0.00000</span>     <span class="hljs-number">6.86567</span>   <span class="hljs-number">13982.5</span>
<span class="hljs-number">31</span>    <span class="hljs-number">71</span>.<span class="hljs-number">2313</span>     <span class="hljs-number">1004</span>.<span class="hljs-number">35</span>   <span class="hljs-number">95</span>.<span class="hljs-number">5841</span>   | <span class="hljs-number">63</span>    <span class="hljs-number">0.00000</span>     <span class="hljs-number">6.86567</span>   <span class="hljs-number">13982.5</span></code></pre><p>NOTE: Attack rate is not linear and can&#39;t be described in dB/s. Attack RATE of
62 and 63 are bugged in some circumstances which can make the envelope never
ramps up at all, due to an extra logic to skip the attack phase for those
values.</p>
<p>Hardware-wise they are implemented as one global counter with integer and
fraction parts. The bit length for each part (point) is interpreted based on
the RATE/4 value of each envelope. Each time the integer part is incremented,
look up the value to add/subtract based on the fraction part. For decay rates,
simply add the value to the envelope (envelope value is an attenuation from 0
dB). For attack rate, subtract it with <code>((env_value+1) * add_value) SHR 4</code>.</p>
<h2 id="ym2151-low-frequency-oscillator-lfo"><a class="header-link" href="#ym2151-low-frequency-oscillator-lfo"></a>YM2151 Low Frequency Oscillator (LFO)</h2>
<h3 id="18h---lfo-frequency-lfrq"><a class="header-link" href="#18h---lfo-frequency-lfrq"></a>18h - LFO Frequency (LFRQ)</h3>
<p>This 8-bit value is represented as a floating point step value. The resulting
LFO frequency is <code>clk*(10h+LFRQ[0..4])/2^(36-LFRQ[4..7])</code> Hz.</p>
<h3 id="19h---phase--amplitude-modulation-depth"><a class="header-link" href="#19h---phase--amplitude-modulation-depth"></a>19h - Phase / Amplitude Modulation Depth</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Select (<span class="hljs-number">0</span>=Amplitude (AMD), <span class="hljs-number">1</span>=Phase (PMD))
<span class="hljs-attribute">6</span>-<span class="hljs-number">0</span>     Depth (<span class="hljs-number">0</span>-<span class="hljs-number">127</span>)</code></pre><p>Define a depth as a ratio of n/128 from the maximum depth used in the PM/AM
sensitivity table below.</p>
<h3 id="1bh---lfo-waveform"><a class="header-link" href="#1bh---lfo-waveform"></a>1Bh - LFO Waveform</h3>
<pre class="hljs"><code><span class="hljs-variable">Bit</span>
<span class="hljs-number">7</span><span class="hljs-operator">-</span><span class="hljs-number">6</span>     <span class="hljs-variable">CTx</span> <span class="hljs-variable">Output</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">see</span> <span class="hljs-built_in">Control</span> <span class="hljs-variable">Registers</span> <span class="hljs-variable">section</span><span class="hljs-punctuation">)</span>
<span class="hljs-number">5</span><span class="hljs-operator">-</span><span class="hljs-number">2</span>     <span class="hljs-built_in">Not</span> <span class="hljs-variable">Used</span>
<span class="hljs-number">1</span><span class="hljs-operator">-</span><span class="hljs-number">0</span>     <span class="hljs-variable">LFO</span> <span class="hljs-variable">Waveform</span> <span class="hljs-punctuation">(</span><span class="hljs-variable">W</span><span class="hljs-punctuation">)</span>
          <span class="hljs-number">0</span> <span class="hljs-operator">=</span> <span class="hljs-variable">Sawtooth</span>
          <span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">Square</span>
          <span class="hljs-number">2</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">Triangle</span>
          <span class="hljs-number">3</span> <span class="hljs-operator">=</span> <span class="hljs-variable">Noise</span></code></pre><p>LFO waveforms are as shown below. Noise LFO value is sampled from the current
LFSR generator state.</p>
<pre class="hljs"><code>Waveform    Phase Modulation        Amplitude Modulation

Sawtooth    +  .|<span class="hljs-string">    .</span>|<span class="hljs-string">    .</span>|<span class="hljs-string">       0     .</span>|<span class="hljs-string">    .</span>|<span class="hljs-string">    .</span>|
(W=0)       0 &#x27; |<span class="hljs-string">  .&#x27; </span>|<span class="hljs-string">  .&#x27; </span>|<span class="hljs-string">  .        .&#x27; </span>|<span class="hljs-string">  .&#x27; </span>|<span class="hljs-string">  .&#x27; </span>|
            -   |<span class="hljs-string">.&#x27;   </span>|<span class="hljs-string">.&#x27;   </span>|<span class="hljs-string">.&#x27;     + .&#x27;   </span>|<span class="hljs-string">.&#x27;   </span>|<span class="hljs-string">.&#x27;   </span>|
              __    __    __             __    __    __
Square      +   |<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">    0   </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
(W=1)       0   |<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">        </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|<span class="hljs-string">  </span>|
            -   |<span class="hljs-string">__</span>|<span class="hljs-string">  </span>|<span class="hljs-string">__</span>|<span class="hljs-string">  </span>|<span class="hljs-string">__</span>|<span class="hljs-string">    + __</span>|<span class="hljs-string">  </span>|<span class="hljs-string">__</span>|<span class="hljs-string">  </span>|<span class="hljs-string">__</span>|<span class="hljs-string">  </span>|

Triangle    +  /\    /\    /\       0   /\    /\    /\  
(W=2)       0 /  \  /  \  /  \         /  \  /  \  /  \ 
            -     \/    \/    \/    + /    \/    \/    \

Noise       + \ ! / ! \ ! / ! \     0 \ ! / ! \ ! / ! \
(W=3)       0 - + - + - + - + -       - + - + - + - + -
            - / ! \ ! / ! \ ! /     + / ! \ ! / ! \ ! /</code></pre><h3 id="38h3fh---channel-07-phase--amplitude-modulation-sensitivity"><a class="header-link" href="#38h3fh---channel-07-phase--amplitude-modulation-sensitivity"></a>38h..3Fh - Channel 0..7 Phase / Amplitude Modulation Sensitivity</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Not Used
<span class="hljs-attribute">6</span>-<span class="hljs-number">4</span>     Phase Modulation Sensitivity (PMS) (<span class="hljs-number">0</span>-<span class="hljs-number">7</span>)
<span class="hljs-attribute">3</span>-<span class="hljs-number">2</span>     Not Used
<span class="hljs-attribute">1</span>-<span class="hljs-number">0</span>     Amplitude Modulation Sensitivity (AMS) (<span class="hljs-number">0</span>-<span class="hljs-number">3</span>)</code></pre><p>Phase modulation is applied to the key code and key fraction of the channel
before sending them to slots&#39; input. The meaning of both PMS and AMS values
are as follows:</p>
<pre class="hljs"><code><span class="hljs-attribute">PM</span> Sensitivity  <span class="hljs-number">0</span>   <span class="hljs-number">1</span>   <span class="hljs-number">2</span>   <span class="hljs-number">3</span>   <span class="hljs-number">4</span>   <span class="hljs-number">5</span>   <span class="hljs-number">6</span>   <span class="hljs-number">7</span>
<span class="hljs-attribute">Max</span>. Mod. +/-   <span class="hljs-number">0</span>   <span class="hljs-number">5</span>   <span class="hljs-number">10</span>  <span class="hljs-number">20</span>  <span class="hljs-number">50</span>  <span class="hljs-number">100</span> <span class="hljs-number">400</span> <span class="hljs-number">700</span> Cents
<span class="hljs-attribute">When</span> PMD=<span class="hljs-number">128</span>

<span class="hljs-attribute">AM</span> Sensitivity  <span class="hljs-number">0</span>       <span class="hljs-number">1</span>       <span class="hljs-number">2</span>       <span class="hljs-number">3</span>
<span class="hljs-attribute">Max</span>. Mod.       <span class="hljs-number">0</span>       <span class="hljs-number">23</span>.<span class="hljs-number">906</span>  <span class="hljs-number">47</span>.<span class="hljs-number">813</span>  <span class="hljs-number">95</span>.<span class="hljs-number">625</span>  dB
<span class="hljs-attribute">When</span> AMD=<span class="hljs-number">128</span></code></pre><h3 id="a0hbfh---slot-031-ams-enable"><a class="header-link" href="#a0hbfh---slot-031-ams-enable"></a>A0h..BFh - Slot 0..31 AMS Enable</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       AMS Enable (<span class="hljs-number">0</span>=Disable, <span class="hljs-number">1</span>=Enable)
<span class="hljs-attribute">6</span>-<span class="hljs-number">5</span>     Not Used
<span class="hljs-attribute">4</span>-<span class="hljs-number">0</span>     Decay <span class="hljs-number">1</span> Rate (D<span class="hljs-number">1</span>R) (see ADSR Envelope section)</code></pre><p>When AMS is enabled, the slot will receive the AMS-adjusted amplitude
modulation from its mapped channel and apply it to the envelope generator
output. If AMS is disabled, it simply ignores the amplitude modulation.</p>
<h2 id="ym2151-noise-generator"><a class="header-link" href="#ym2151-noise-generator"></a>YM2151 Noise Generator</h2>
<h3 id="0fh---noise-enable--frequency"><a class="header-link" href="#0fh---noise-enable--frequency"></a>0Fh - Noise Enable / Frequency</h3>
<pre class="hljs"><code><span class="hljs-attribute">Bit</span>
<span class="hljs-attribute">7</span>       Noise Enable (<span class="hljs-number">0</span>=Disable, <span class="hljs-number">1</span>=Enable)
<span class="hljs-attribute">6</span>-<span class="hljs-number">5</span>     Not Used
<span class="hljs-attribute">4</span>-<span class="hljs-number">0</span>     Noise Frequency (<span class="hljs-number">0</span>-<span class="hljs-number">31</span>) ; clk/n/<span class="hljs-number">32</span> Hz (usually)</code></pre><p>When a noise is enabled, Slot 31 (Channel 7 C2 function)&#39;s output is replaced
with a noise generator output. The generator uses a 17-bit LFSR to generate a
a noise at a specified frequency then multiply the output bit with Slot 31&#39;s
current envelope generator value (with TL and AM applied). Note that the value
here is treated as a <em>linear</em> ratio instead of dB attenuation. A noise
frequency value of 0 is the same as 1.</p>
<h1 id="cpu-65c02-microprocessor"><a class="header-link" href="#cpu-65c02-microprocessor"></a>CPU 65C02 Microprocessor</h1>
<h3 id="overview-1"><a class="header-link" href="#overview-1"></a>Overview</h3>
<p><a href="#cpu-registers-and-flags">CPU Registers and Flags</a><br><a href="#cpu-memory-addressing">CPU Memory Addressing</a><br><a href="#cpu-clock-cycles">CPU Clock Cycles</a>  </p>
<h3 id="instruction-set"><a class="header-link" href="#instruction-set"></a>Instruction Set</h3>
<p><a href="#cpu-memory-and-register-transfers">CPU Memory and Register Transfers</a><br><a href="#cpu-arithmeticlogical-operations">CPU Arithmetic/Logical Operations</a><br><a href="#cpu-rotate-and-shift-instructions">CPU Rotate and Shift Instructions</a><br><a href="#cpu-jump-and-control-instructions">CPU Jump and Control Instructions</a>  </p>
<h2 id="cpu-registers-and-flags"><a class="header-link" href="#cpu-registers-and-flags"></a>CPU Registers and Flags</h2>
<p>The 65xx CPUs are equipped with not more than three general purpose registers
(A, X, Y). However, the limited number of registers is somewhat covered by
comfortable memory operations, especially addresses 0000h-00FFh (usually
referred as zeropage) may be used for relatively fast and complicated
operations, insofar one might say that the CPU has about 256 8-bit &quot;registers&quot;
in memory. For details, see:<br><a href="#cpu-memory-addressing">CPU Memory Addressing</a>  </p>
<h3 id="registers"><a class="header-link" href="#registers"></a>Registers</h3>
<pre class="hljs"><code><span class="hljs-keyword">Name</span>    Bits    Explanation
A       <span class="hljs-number">8</span>       Accumulator
X       <span class="hljs-number">8</span>       <span class="hljs-keyword">Index</span> <span class="hljs-keyword">Register</span> X
Y       <span class="hljs-number">8</span>       <span class="hljs-keyword">Index</span> <span class="hljs-keyword">Register</span> Y
S       <span class="hljs-number">8</span>       Stack Pointer (see below)
PC      <span class="hljs-number">16</span>      <span class="hljs-keyword">Program</span> Counter
P       <span class="hljs-number">8</span>       Processor Status <span class="hljs-keyword">Register</span> (see below)</code></pre><h3 id="stack-pointer"><a class="header-link" href="#stack-pointer"></a>Stack Pointer</h3>
<p>The stack pointer is addressing 256 bytes of memory with values 00h-FFh
corresponding directly to the address 0100h-01FFh. Unlike most other CPUs,
which decrements the stack pointer first before storing a data, 65xx CPUs will
store a data first before decrementing the stack pointer. Which means that the
stack will point to the first free byte. So, when initializing stack to the
top, set S=(1)FFh rather than (2)00h.</p>
<h3 id="processor-status-register-flags"><a class="header-link" href="#processor-status-register-flags"></a>Processor Status Register (Flags)</h3>
<pre class="hljs"><code>Bit     Name    Explanation
7       N       Negative/Sign (<span class="hljs-attribute">0</span>=Positive, <span class="hljs-attribute">1</span>=Negative)
6       V       Overflow      (<span class="hljs-attribute">0</span>=<span class="hljs-literal">No</span> Overflow, <span class="hljs-attribute">1</span>=Overflow)
5       1       Unused
4       B       Break Flag    (<span class="hljs-attribute">0</span>=IRQ/NMI, <span class="hljs-attribute">1</span>=BRK opcode)
3       D       Decimal Mode  (<span class="hljs-attribute">0</span>=Normal, <span class="hljs-attribute">1</span>=BCD Mode <span class="hljs-keyword">for</span> ADC/SBC opcodes)
2       I      <span class="hljs-built_in"> IRQ </span><span class="hljs-builtin-name">Disable</span>   (<span class="hljs-attribute">0</span>=Enable, <span class="hljs-attribute">1</span>=Disable)
1       Z       Zero          (<span class="hljs-attribute">0</span>=Nonzero, <span class="hljs-attribute">1</span>=Zero)
0       C       Carry         (<span class="hljs-attribute">0</span>=<span class="hljs-literal">No</span> Carry, <span class="hljs-attribute">1</span>=Carry)</code></pre><h3 id="carry-flag-c"><a class="header-link" href="#carry-flag-c"></a>Carry Flag (C)</h3>
<p>CAUTION: When used for subtractions (SBC and CMP), the carry flag have an
opposite meaning compared to Z80 and x86 CPUs. It is <em>set</em> when the result is
above or equal. For all other instructions (ADC, ASL, LSR, ROL, ROR) it works
as normal.</p>
<h3 id="zero-flag-z-negativesign-flag-n-overflow-flag-v"><a class="header-link" href="#zero-flag-z-negativesign-flag-n-overflow-flag-v"></a>Zero Flag (Z), Negative/Sign Flag (N), Overflow Flag (V)</h3>
<p>Those flags work like most other CPUs: Z is set when the result is zero, N is
set when the signed result is negative (bit 7 is set). V is set when an
addition/subtraction exceeds the maximum range for signed numbers (-128..+127).</p>
<h3 id="irq-disable-flag-i"><a class="header-link" href="#irq-disable-flag-i"></a>IRQ Disable Flag (I)</h3>
<p>Disables IRQs when set. NMIs (non-maskable interrupts) and BRK instructions are
not affected and will still interrupt.</p>
<h3 id="decimal-mode-flag-d"><a class="header-link" href="#decimal-mode-flag-d"></a>Decimal Mode Flag (D)</h3>
<p>When set, addition/subtraction will operate as if all numbers are in packed BCD
format (range 00h..99h) and automatically handles digit carrying of it. Unlike
older NMOS 6502s, decimal mode addition/subtraction takes one more cycle than
normal to make resulting flags correct.</p>
<h3 id="break-flag-b"><a class="header-link" href="#break-flag-b"></a>Break Flag (B)</h3>
<p>The Break flag is intended to separate between IRQ and BRK which are both using
the same vector, (FFFEh). It cannot be accessed directly but can be checked by
examining the pushed value on the stack (by either PHP instruction or
automatically by the interrupt). BRK opcode always write 1 to the bit, IRQ/NMI
execution always write 0.</p>
<h2 id="cpu-memory-addressing"><a class="header-link" href="#cpu-memory-addressing"></a>CPU Memory Addressing</h2>
<h3 id="opcode-addressing-modes"><a class="header-link" href="#opcode-addressing-modes"></a>Opcode Addressing Modes</h3>
<pre class="hljs"><code><span class="hljs-variable">Name</span>                        <span class="hljs-built_in">Syntax</span>
<span class="hljs-variable">Implied</span>                     <span class="hljs-operator">-</span>
<span class="hljs-variable">Accumulator</span>                 <span class="hljs-variable">A</span>
<span class="hljs-variable">Immediate</span>                   <span class="hljs-type">#nn</span>
<span class="hljs-variable">Zero</span> <span class="hljs-variable">Page</span>                   <span class="hljs-variable">nn</span>
<span class="hljs-variable">Zero</span> <span class="hljs-variable">Page</span> <span class="hljs-variable">Indirect</span>          <span class="hljs-punctuation">(</span><span class="hljs-variable">nn</span><span class="hljs-punctuation">)</span>
<span class="hljs-variable">Zero</span> <span class="hljs-variable">Page</span> <span class="hljs-built_in">Indexed</span> <span class="hljs-variable">with</span> <span class="hljs-variable">X</span>    <span class="hljs-variable">nn</span><span class="hljs-operator">,</span><span class="hljs-variable">X</span>
<span class="hljs-variable">Zero</span> <span class="hljs-variable">Page</span> <span class="hljs-built_in">Indexed</span> <span class="hljs-variable">with</span> <span class="hljs-variable">Y</span>    <span class="hljs-variable">nn</span><span class="hljs-operator">,</span><span class="hljs-variable">Y</span>
<span class="hljs-variable">Zero</span> <span class="hljs-variable">Page</span> <span class="hljs-built_in">Indexed</span> <span class="hljs-variable">Indirect</span>  <span class="hljs-punctuation">(</span><span class="hljs-variable">nn</span><span class="hljs-operator">,</span><span class="hljs-variable">X</span><span class="hljs-punctuation">)</span>
<span class="hljs-variable">Zero</span> <span class="hljs-variable">Page</span> <span class="hljs-variable">Indirect</span> <span class="hljs-built_in">Indexed</span>  <span class="hljs-punctuation">(</span><span class="hljs-variable">nn</span><span class="hljs-punctuation">)</span><span class="hljs-operator">,</span><span class="hljs-variable">Y</span>
<span class="hljs-built_in">Absolute</span>                    <span class="hljs-variable">nnnn</span>
<span class="hljs-built_in">Absolute</span> <span class="hljs-variable">Indirect</span>           <span class="hljs-punctuation">(</span><span class="hljs-variable">nnnn</span><span class="hljs-punctuation">)</span>
<span class="hljs-built_in">Absolute</span> <span class="hljs-built_in">Indexed</span> <span class="hljs-variable">with</span> <span class="hljs-variable">X</span>     <span class="hljs-variable">nnnn</span><span class="hljs-operator">,</span><span class="hljs-variable">X</span>
<span class="hljs-built_in">Absolute</span> <span class="hljs-built_in">Indexed</span> <span class="hljs-variable">with</span> <span class="hljs-variable">Y</span>     <span class="hljs-variable">nnnn</span><span class="hljs-operator">,</span><span class="hljs-variable">Y</span>
<span class="hljs-built_in">Absolute</span> <span class="hljs-built_in">Indexed</span> <span class="hljs-variable">Indirect</span>   <span class="hljs-punctuation">(</span><span class="hljs-variable">nnnn</span><span class="hljs-operator">,</span><span class="hljs-variable">X</span><span class="hljs-punctuation">)</span>
<span class="hljs-built_in">Stack</span>                       <span class="hljs-operator">-</span>
<span class="hljs-variable">PC</span> <span class="hljs-variable">Relative</span>                 <span class="hljs-variable">rr</span>
<span class="hljs-variable">Zero</span> <span class="hljs-variable">Page</span> <span class="hljs-variable">Relative</span>          <span class="hljs-variable">nn</span><span class="hljs-operator">,</span><span class="hljs-variable">rr</span></code></pre><h3 id="zero-page---nn-nnx-nny"><a class="header-link" href="#zero-page---nn-nnx-nny"></a>Zero Page - nn nn,X nn,Y</h3>
<p>Uses an 8-bit parameter (one byte) to address the first 256 bytes of memory at
0000h-00FFh (page 0). This limited range is enforced even for Indexed
addressing. For example, &quot;C0h+60h&quot; will access 0020h instead of 0120h.</p>
<h3 id="absolute---nnnn-nnnnx-nnnny"><a class="header-link" href="#absolute---nnnn-nnnnx-nnnny"></a>Absolute - nnnn nnnn+X nnnn+Y</h3>
<p>Uses a 16-bit parameter (two bytes) to address the whole memory at 0000h-FFFFh.
Because of an additional parameter byte, this is a bit slower than Zero Page
accesses.</p>
<h3 id="indirect---nn-nnx-nny-nnnn-nnnnx"><a class="header-link" href="#indirect---nn-nnx-nny-nnnn-nnnnx"></a>Indirect - (nn) (nn+X) (nn),Y (nnnn) (nnnn,X)</h3>
<p>Uses an 8/16-bit parameter that points to a 16bit parameter in page 0 memory.
Even though the CPU doesn&#39;t support 16bit registers (except for the program
counter), this (double-)indirect addressing allows to use variable 16-bit
pointers.</p>
<h2 id="cpu-clock-cycles"><a class="header-link" href="#cpu-clock-cycles"></a>CPU Clock Cycles</h2>
<h3 id="execution-legend"><a class="header-link" href="#execution-legend"></a>Execution Legend</h3>
<pre class="hljs"><code>C   Opcode command
P   Opcode <span class="hljs-keyword">parameter</span> (immediate <span class="hljs-comment">or address)</span>
A   <span class="hljs-comment">Address cycles (on indirect addresses)</span>
D   <span class="hljs-comment">Data cycles</span>
N   <span class="hljs-comment">Internal cycles</span>
S   <span class="hljs-comment">Stack cycles</span></code></pre><p>Additional cycles</p>
<pre class="hljs"><code>n   <span class="hljs-type">Internal</span> <span class="hljs-keyword">cycle</span>, <span class="hljs-keyword">when</span> branch <span class="hljs-keyword">is</span> taken
x   <span class="hljs-type">Internal</span> <span class="hljs-keyword">cycle</span>, <span class="hljs-keyword">when</span> branching crosses page boundaries
y   <span class="hljs-type">Internal</span> <span class="hljs-keyword">cycle</span>, <span class="hljs-keyword">when</span> indexing across page boundaries <span class="hljs-keyword">or</span> STA nnnn,X
    The CPU doesn<span class="hljs-string">&#x27;t do a read at invalid address unlike older NMOS 6502s</span></code></pre><h3 id="implied-or-immediate-operands"><a class="header-link" href="#implied-or-immediate-operands"></a>Implied or Immediate Operands</h3>
<pre class="hljs"><code><span class="hljs-attribute">Addressing</span> Mode             Cycles  Execution
<span class="hljs-attribute">Implied</span> Opcodes             <span class="hljs-number">2</span>       CN
<span class="hljs-attribute">WAI</span>/STP (wait IRQ, stop)    <span class="hljs-number">3</span>       CNN
<span class="hljs-comment">#nn                         2       CP</span></code></pre><h3 id="memory-operands"><a class="header-link" href="#memory-operands"></a>Memory Operands</h3>
<pre class="hljs"><code>Addressing Mode             Cycles  Execution
nn                         <span class="hljs-number"> 3 </span>      CPD
nn (RMW)                   <span class="hljs-number"> 5 </span>      CPDND
nn,X or nn,Y               <span class="hljs-number"> 4 </span>      CPND
nn,X (RMW)                 <span class="hljs-number"> 6 </span>      CPNDND
nnnn                       <span class="hljs-number"> 4 </span>      CPPD
nnnn (RMW)                 <span class="hljs-number"> 6 </span>      CPPDND
nnnn,X or nnnn,Y            4,5     CPPyD
nnnn,X (RMW)                6,7     CPPyDND
(nn)                       <span class="hljs-number"> 5 </span>      CPAAD
(nn,X)                     <span class="hljs-number"> 6 </span>      CPNAAD
(nn),Y                      5,6     CPAAyD</code></pre><h3 id="pushpulls"><a class="header-link" href="#pushpulls"></a>Push/Pulls</h3>
<pre class="hljs"><code><span class="hljs-attribute">Addressing</span> Mode             Cycles  Execution
<span class="hljs-attribute">PHx</span>                         <span class="hljs-number">3</span>       CNS
<span class="hljs-attribute">PLx</span>                         <span class="hljs-number">4</span>       CNNS</code></pre><h3 id="branches"><a class="header-link" href="#branches"></a>Branches</h3>
<pre class="hljs"><code><span class="hljs-attribute">Addressing</span> Mode             Cycles  Execution
<span class="hljs-attribute">BRA</span> rr                      <span class="hljs-number">3</span>,<span class="hljs-number">4</span>     CPNx
<span class="hljs-attribute">Bxx</span> rr                      <span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>   CPnx
<span class="hljs-attribute">BBxn</span> nn,rr                  <span class="hljs-number">5</span>       CPPDN (?)
<span class="hljs-attribute">JMP</span> nnnn                    <span class="hljs-number">3</span>       CPP
<span class="hljs-attribute">JSR</span> nnnn                    <span class="hljs-number">6</span>       CPPNSS
<span class="hljs-attribute">JMP</span> (nnnn)                  <span class="hljs-number">6</span>       CPPNDD
<span class="hljs-attribute">JMP</span> (nnnn,X)                <span class="hljs-number">6</span>       CPPNDD
<span class="hljs-attribute">RTS</span>                         <span class="hljs-number">6</span>       CNNSSN
<span class="hljs-attribute">RTI</span>                         <span class="hljs-number">6</span>       CNNSSS
<span class="hljs-attribute">Interrupt</span> (IRQ, NMI, RES)   <span class="hljs-number">7</span>       NNSSSDD
<span class="hljs-attribute">Interrupt</span> (BRK)             <span class="hljs-number">7</span>       CPSSSDD</code></pre><h2 id="cpu-memory-and-register-transfers"><a class="header-link" href="#cpu-memory-and-register-transfers"></a>CPU Memory and Register Transfers</h2>
<h3 id="register-to-register-transfer"><a class="header-link" href="#register-to-register-transfer"></a>Register to Register Transfer</h3>
<pre class="hljs"><code>Opcode      Flags Clks  Syntax      Effect
AA          n---z-  2   TAX         <span class="hljs-attribute">X</span>=A
A8          n---z-  2   TAY         <span class="hljs-attribute">Y</span>=A
BA          n---z-  2   TSX         <span class="hljs-attribute">X</span>=S
8A          n---z-  2   TXA         <span class="hljs-attribute">A</span>=X
9A          ------  2   TXS         <span class="hljs-attribute">S</span>=X
98          n---z-  2   TYA         <span class="hljs-attribute">A</span>=Y</code></pre><h3 id="load-register-from-memory"><a class="header-link" href="#load-register-from-memory"></a>Load Register from Memory</h3>
<pre class="hljs"><code>Opcode      Flags Clks  Syntax      Effect
A9 <span class="hljs-keyword">nn</span>       n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">2</span>   LDA #nn     A=<span class="hljs-keyword">nn</span>
A5 <span class="hljs-keyword">nn</span>       n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">3</span>   LDA <span class="hljs-keyword">nn</span>      A=[<span class="hljs-keyword">nn</span>]
B5 <span class="hljs-keyword">nn</span>       n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">4</span>   LDA <span class="hljs-keyword">nn</span>,<span class="hljs-keyword">X</span>    A=[<span class="hljs-keyword">nn</span>+<span class="hljs-keyword">X</span>]
AD <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">4</span>   LDA nnnn    A=[nnnn]
BD <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">4</span>*  LDA nnnn,<span class="hljs-keyword">X</span>  A=[nnnn+<span class="hljs-keyword">X</span>]
B9 <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">4</span>*  LDA nnnn,Y  A=[nnnn+Y]
A1 <span class="hljs-keyword">nn</span>       n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">6</span>   LDA (<span class="hljs-keyword">nn</span>,<span class="hljs-keyword">X</span>)  A=[WORD[<span class="hljs-keyword">nn</span>+<span class="hljs-keyword">X</span>]]
B1 <span class="hljs-keyword">nn</span>       n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">5</span>*  LDA (<span class="hljs-keyword">nn</span>),Y  A=[WORD[<span class="hljs-keyword">nn</span>]+Y]
B2 <span class="hljs-keyword">nn</span>       n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">5</span>   LDA (<span class="hljs-keyword">nn</span>)    A=[WORD[<span class="hljs-keyword">nn</span>]]
A2 <span class="hljs-keyword">nn</span>       n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">2</span>   LDX #nn     <span class="hljs-keyword">X</span>=<span class="hljs-keyword">nn</span>
A6 <span class="hljs-keyword">nn</span>       n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">3</span>   LDX <span class="hljs-keyword">nn</span>      <span class="hljs-keyword">X</span>=[<span class="hljs-keyword">nn</span>]
B6 <span class="hljs-keyword">nn</span>       n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">4</span>   LDX <span class="hljs-keyword">nn</span>,Y    <span class="hljs-keyword">X</span>=[D+<span class="hljs-keyword">nn</span>+Y]
AE <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">4</span>   LDX nnnn    <span class="hljs-keyword">X</span>=[nnnn]
BE <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">4</span>*  LDX nnnn,Y  <span class="hljs-keyword">X</span>=[nnnn+Y]
A0 <span class="hljs-keyword">nn</span>       n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">2</span>   LDY #nn     Y=<span class="hljs-keyword">nn</span>
A4 <span class="hljs-keyword">nn</span>       n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">3</span>   LDY <span class="hljs-keyword">nn</span>      Y=[<span class="hljs-keyword">nn</span>]
B4 <span class="hljs-keyword">nn</span>       n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">4</span>   LDY <span class="hljs-keyword">nn</span>,<span class="hljs-keyword">X</span>    Y=[<span class="hljs-keyword">nn</span>+<span class="hljs-keyword">X</span>]
AC <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">4</span>   LDY nnnn    Y=[nnnn]
BC <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">4</span>*  LDY nnnn,<span class="hljs-keyword">X</span>  Y=[nnnn+<span class="hljs-keyword">X</span>]</code></pre><p><small>* Add one cycle if indexing crosses a page boundary</small></p>
<h3 id="store-register-in-memory"><a class="header-link" href="#store-register-in-memory"></a>Store Register in Memory</h3>
<pre class="hljs"><code>Opcode      Flags Clks  Syntax      Effect
<span class="hljs-number">85</span> <span class="hljs-keyword">nn</span>       ------  <span class="hljs-number">3</span>   STA <span class="hljs-keyword">nn</span>      [<span class="hljs-keyword">nn</span>]=A
<span class="hljs-number">95</span> <span class="hljs-keyword">nn</span>       ------  <span class="hljs-number">4</span>   STA <span class="hljs-keyword">nn</span>,<span class="hljs-keyword">X</span>    [<span class="hljs-keyword">nn</span>+<span class="hljs-keyword">X</span>]=A
<span class="hljs-number">8</span>D <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    ------  <span class="hljs-number">4</span>   STA nnnn    [nnnn]=A
<span class="hljs-number">9</span>D <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    ------  <span class="hljs-number">5</span>   STA nnnn,<span class="hljs-keyword">X</span>  [nnnn+<span class="hljs-keyword">X</span>]=A
<span class="hljs-number">99</span> <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    ------  <span class="hljs-number">5</span>   STA nnnn,Y  [nnnn+Y]=A
<span class="hljs-number">81</span> <span class="hljs-keyword">nn</span>       ------  <span class="hljs-number">6</span>   STA (<span class="hljs-keyword">nn</span>,<span class="hljs-keyword">X</span>)  [WORD[<span class="hljs-keyword">nn</span>+<span class="hljs-keyword">X</span>]]=A
<span class="hljs-number">91</span> <span class="hljs-keyword">nn</span>       ------  <span class="hljs-number">6</span>   STA (<span class="hljs-keyword">nn</span>),Y  [WORD[<span class="hljs-keyword">nn</span>]+Y]=A
<span class="hljs-number">92</span> <span class="hljs-keyword">nn</span>       ------  <span class="hljs-number">5</span>   STA (<span class="hljs-keyword">nn</span>)    [WORD[<span class="hljs-keyword">nn</span>]]=A
<span class="hljs-number">86</span> <span class="hljs-keyword">nn</span>       ------  <span class="hljs-number">3</span>   STX <span class="hljs-keyword">nn</span>      [<span class="hljs-keyword">nn</span>]=<span class="hljs-keyword">X</span>
<span class="hljs-number">96</span> <span class="hljs-keyword">nn</span>       ------  <span class="hljs-number">4</span>   STX <span class="hljs-keyword">nn</span>,Y    [<span class="hljs-keyword">nn</span>+Y]=<span class="hljs-keyword">X</span>
<span class="hljs-number">8</span>E <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    ------  <span class="hljs-number">4</span>   STX nnnn    [nnnn]=<span class="hljs-keyword">X</span>
<span class="hljs-number">84</span> <span class="hljs-keyword">nn</span>       ------  <span class="hljs-number">3</span>   STY <span class="hljs-keyword">nn</span>      [<span class="hljs-keyword">nn</span>]=Y
<span class="hljs-number">94</span> <span class="hljs-keyword">nn</span>       ------  <span class="hljs-number">4</span>   STY <span class="hljs-keyword">nn</span>,<span class="hljs-keyword">X</span>    [<span class="hljs-keyword">nn</span>+<span class="hljs-keyword">X</span>]=Y
<span class="hljs-number">8</span>C <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    ------  <span class="hljs-number">4</span>   STY nnnn    [nnnn]=Y
<span class="hljs-number">64</span> <span class="hljs-keyword">nn</span>       ------  <span class="hljs-number">3</span>   STZ <span class="hljs-keyword">nn</span>      [<span class="hljs-keyword">nn</span>]=<span class="hljs-number">0</span>
<span class="hljs-number">74</span> <span class="hljs-keyword">nn</span>       ------  <span class="hljs-number">4</span>   STZ <span class="hljs-keyword">nn</span>,<span class="hljs-keyword">X</span>    [<span class="hljs-keyword">nn</span>+<span class="hljs-keyword">X</span>]=<span class="hljs-number">0</span>
<span class="hljs-number">9</span>C <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    ------  <span class="hljs-number">4</span>   STZ nnnn    [nnnn]=<span class="hljs-number">0</span>
<span class="hljs-number">9</span>E <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    ------  <span class="hljs-number">5</span>   STZ nnnn,<span class="hljs-keyword">X</span>  [nnnn+<span class="hljs-keyword">X</span>]=<span class="hljs-number">0</span></code></pre><h3 id="pushpull-stack"><a class="header-link" href="#pushpull-stack"></a>Push/Pull (Stack)</h3>
<pre class="hljs"><code>Opcode      Flags Clks  Syntax      Effect
48          ------  3   PHA         [S]=A, <span class="hljs-attribute">S</span>=S-1
08          ------  3   PHP         [S]=P, <span class="hljs-attribute">S</span>=S-1
DA          ------  3   PHX         [S]=X, <span class="hljs-attribute">S</span>=S-1
5A          ------  3   PHY         [S]=Y, <span class="hljs-attribute">S</span>=S-1
68          n---z-  4   PLA         <span class="hljs-attribute">S</span>=S+1, A=[S]
28          nvdizc  4   PLP         <span class="hljs-attribute">S</span>=S+1, P=[S]
FA          n---z-  4   PLX         <span class="hljs-attribute">S</span>=S+1, X=[S]
7A          n---z-  4   PLY         <span class="hljs-attribute">S</span>=S+1, Y=[S]</code></pre><p>NOTE: PLP cannot modify the B Flag or the unused flag.</p>
<h2 id="cpu-arithmeticlogical-operations"><a class="header-link" href="#cpu-arithmeticlogical-operations"></a>CPU Arithmetic/Logical Operations</h2>
<h3 id="alu-opcodes"><a class="header-link" href="#alu-opcodes"></a>ALU Opcodes</h3>
<pre class="hljs"><code>Base        Flags       Syntax      Operands        <span class="hljs-keyword">Function</span>
<span class="hljs-title">00</span>          n<span class="hljs-comment">---z-      ORA op      &lt;alu_types&gt;     A=A OR op</span>
20          n<span class="hljs-comment">---z-      AND op      &lt;alu_types&gt;     A=A AND op</span>
40          n<span class="hljs-comment">---z-      EOR op      &lt;alu_types&gt;     A=A XOR op</span>
60          nv<span class="hljs-comment">--zc      ADC op      &lt;alu_types&gt;     A=A+C+op</span>
C0          n<span class="hljs-comment">---zc      CMP op      &lt;alu_types&gt;     A-op</span>
E0          nv<span class="hljs-comment">--zc      SBC op      &lt;alu_types&gt;     A=A+C-1-op</span>
C0          n<span class="hljs-comment">---zc      CPY op      &lt;cpx_types&gt;     Y-op</span>
E0          n<span class="hljs-comment">---zc      CPX op      &lt;cpx_types&gt;     X-op</span></code></pre><h3 id="alu_types-operands-for-orandxoradcsbccmp-opcodes"><a class="header-link" href="#alu_types-operands-for-orandxoradcsbccmp-opcodes"></a>alu_types (Operands for OR,AND,XOR,ADC,SBC,CMP Opcodes)</h3>
<pre class="hljs"><code>Opcode            Clks^ Syntax      Effect
Base+<span class="hljs-number">09</span> <span class="hljs-keyword">nn</span>          <span class="hljs-number">2</span>   #nn         op=<span class="hljs-keyword">nn</span>
Base+<span class="hljs-number">05</span> <span class="hljs-keyword">nn</span>          <span class="hljs-number">3</span>   <span class="hljs-keyword">nn</span>          op=[<span class="hljs-keyword">nn</span>]
Base+<span class="hljs-number">15</span> <span class="hljs-keyword">nn</span>          <span class="hljs-number">4</span>   <span class="hljs-keyword">nn</span>,<span class="hljs-keyword">X</span>        op=[<span class="hljs-keyword">nn</span>+<span class="hljs-keyword">X</span>]
Base+<span class="hljs-number">0</span>D <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>       <span class="hljs-number">4</span>   nnnn        op=[nnnn]
Base+<span class="hljs-number">1</span>D <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>       <span class="hljs-number">4</span>*  nnnn,<span class="hljs-keyword">X</span>      op=[nnnn+<span class="hljs-keyword">X</span>]
Base+<span class="hljs-number">19</span> <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>       <span class="hljs-number">4</span>*  nnnn,Y      op=[nnnn+Y]
Base+<span class="hljs-number">01</span> <span class="hljs-keyword">nn</span>          <span class="hljs-number">6</span>   (<span class="hljs-keyword">nn</span>,<span class="hljs-keyword">X</span>)      op=[WORD[<span class="hljs-keyword">nn</span>+<span class="hljs-keyword">X</span>]]
Base+<span class="hljs-number">11</span> <span class="hljs-keyword">nn</span>          <span class="hljs-number">5</span>*  (<span class="hljs-keyword">nn</span>),Y      op=[WORD[<span class="hljs-keyword">nn</span>]+Y]
Base+<span class="hljs-number">12</span> <span class="hljs-keyword">nn</span>          <span class="hljs-number">5</span>   (<span class="hljs-keyword">nn</span>)        op=[WORD[<span class="hljs-keyword">nn</span>]]</code></pre><p><small>* Add one cycle if indexing crosses a page boundary</small><br><small>^ Add one cycle if decimal mode and the instruction is ADC or SBC</small></p>
<h3 id="cpx_types-operands-for-cmp-opcodes-with-xy-operand"><a class="header-link" href="#cpx_types-operands-for-cmp-opcodes-with-xy-operand"></a>cpx_types (Operands for CMP Opcodes with X,Y Operand)</h3>
<pre class="hljs"><code>Opcode            Clks  Syntax      Effect
Base+<span class="hljs-number">00</span> <span class="hljs-keyword">nn</span>          <span class="hljs-number">2</span>   #nn         op=<span class="hljs-keyword">nn</span>
Base+<span class="hljs-number">04</span> <span class="hljs-keyword">nn</span>          <span class="hljs-number">3</span>   <span class="hljs-keyword">nn</span>          op=[<span class="hljs-keyword">nn</span>]
Base+<span class="hljs-number">0</span>C <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>       <span class="hljs-number">4</span>   nnnn        op=[nnnn]</code></pre><h3 id="bit-test"><a class="header-link" href="#bit-test"></a>Bit Test</h3>
<pre class="hljs"><code>Opcode      Flags Clks  Syntax
<span class="hljs-number">24</span> <span class="hljs-keyword">nn</span>       nv--<span class="hljs-keyword">z</span>-  <span class="hljs-number">3</span>   BIT <span class="hljs-keyword">nn</span>
<span class="hljs-number">2</span>C <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    nv--<span class="hljs-keyword">z</span>-  <span class="hljs-number">4</span>   BIT nnnn
<span class="hljs-number">34</span> <span class="hljs-keyword">nn</span>       nv--<span class="hljs-keyword">z</span>-  <span class="hljs-number">4</span>   BIT <span class="hljs-keyword">nn</span>,<span class="hljs-keyword">X</span>
<span class="hljs-number">3</span>C <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    nv--<span class="hljs-keyword">z</span>-  <span class="hljs-number">4</span>*  BIT nnnn,<span class="hljs-keyword">X</span>
<span class="hljs-number">89</span> <span class="hljs-keyword">nn</span>       ----<span class="hljs-keyword">z</span>-  <span class="hljs-number">2</span>   BIT #nn</code></pre><p><small>* Add one cycle if indexing crosses a page boundary</small></p>
<p>Flags are set as follows: <code>Z=((A AND op)==0)</code>, <code>N=op.Bit(7)</code> and <code>V=op.Bit(6)</code>.
Note that N and V rely only on op&#39;s value instead of the result.</p>
<h3 id="increment-by-one"><a class="header-link" href="#increment-by-one"></a>Increment by one</h3>
<pre class="hljs"><code>Opcode      Flags Clks  Syntax      Effect
<span class="hljs-number">1</span>A          n---z-  <span class="hljs-number">2</span>   <span class="hljs-keyword">INC</span> A       A=A+<span class="hljs-number">1</span>
E<span class="hljs-number">6</span> nn       n---z-  <span class="hljs-number">5</span>   <span class="hljs-keyword">INC</span> nn      [nn]=[nn]+<span class="hljs-number">1</span>
F<span class="hljs-number">6</span> nn       n---z-  <span class="hljs-number">6</span>   <span class="hljs-keyword">INC</span> nn,<span class="hljs-keyword">X</span>    [nn+<span class="hljs-keyword">X</span>]=[nn+<span class="hljs-keyword">X</span>]+<span class="hljs-number">1</span>
EE nn nn    n---z-  <span class="hljs-number">6</span>   <span class="hljs-keyword">INC</span> nnnn    [nnnn]=[nnnn]+<span class="hljs-number">1</span>
FE nn nn    n---z-  <span class="hljs-number">7</span>   <span class="hljs-keyword">INC</span> nnnn,<span class="hljs-keyword">X</span>  [nnnn+<span class="hljs-keyword">X</span>]=[nnnn+<span class="hljs-keyword">X</span>]+<span class="hljs-number">1</span>
E<span class="hljs-number">8</span>          n---z-  <span class="hljs-number">2</span>   INX         <span class="hljs-keyword">X</span>=<span class="hljs-keyword">X</span>+<span class="hljs-number">1</span>
C<span class="hljs-number">8</span>          n---z-  <span class="hljs-number">2</span>   INY         <span class="hljs-keyword">Y</span>=<span class="hljs-keyword">Y</span>+<span class="hljs-number">1</span></code></pre><h3 id="decrement-by-one"><a class="header-link" href="#decrement-by-one"></a>Decrement by one</h3>
<pre class="hljs"><code>Opcode      Flags Clks  Syntax      Effect
<span class="hljs-number">3</span>A          n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">2</span>   DEC A       A=A-<span class="hljs-number">1</span>
C6 <span class="hljs-keyword">nn</span>       n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">5</span>   DEC <span class="hljs-keyword">nn</span>      [<span class="hljs-keyword">nn</span>]=[<span class="hljs-keyword">nn</span>]-<span class="hljs-number">1</span>
D6 <span class="hljs-keyword">nn</span>       n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">6</span>   DEC <span class="hljs-keyword">nn</span>,<span class="hljs-keyword">X</span>    [<span class="hljs-keyword">nn</span>+<span class="hljs-keyword">X</span>]=[<span class="hljs-keyword">nn</span>+<span class="hljs-keyword">X</span>]-<span class="hljs-number">1</span>
CE <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">6</span>   DEC nnnn    [nnnn]=[nnnn]-<span class="hljs-number">1</span>
DE <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">7</span>   DEC nnnn,<span class="hljs-keyword">X</span>  [nnnn+<span class="hljs-keyword">X</span>]=[nnnn+<span class="hljs-keyword">X</span>]-<span class="hljs-number">1</span>
CA          n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">2</span>   DEX         <span class="hljs-keyword">X</span>=<span class="hljs-keyword">X</span>-<span class="hljs-number">1</span>
<span class="hljs-number">88</span>          n---<span class="hljs-keyword">z</span>-  <span class="hljs-number">2</span>   DEY         Y=Y-<span class="hljs-number">1</span></code></pre><h3 id="tsbtrb-test-and-setreset"><a class="header-link" href="#tsbtrb-test-and-setreset"></a>TSB/TRB (Test and Set/Reset)</h3>
<pre class="hljs"><code>Opcode      Flags Clks  Syntax      Effect
<span class="hljs-number">04</span> <span class="hljs-keyword">nn</span>       ----<span class="hljs-keyword">z</span>-  <span class="hljs-number">5</span>   TSB <span class="hljs-keyword">nn</span>      <span class="hljs-keyword">z</span>=(A AND [<span class="hljs-keyword">nn</span>])==<span class="hljs-number">0</span>,  [<span class="hljs-keyword">nn</span>]=[<span class="hljs-keyword">nn</span>] OR A
<span class="hljs-number">0</span>C <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    ----<span class="hljs-keyword">z</span>-  <span class="hljs-number">6</span>   TSB nnnn    <span class="hljs-keyword">z</span>=(A AND [nnnn])==<span class="hljs-number">0</span>,[nnnn]=[nnnn] OR A
<span class="hljs-number">14</span> <span class="hljs-keyword">nn</span>       ----<span class="hljs-keyword">z</span>-  <span class="hljs-number">5</span>   TRB <span class="hljs-keyword">nn</span>      <span class="hljs-keyword">z</span>=(A AND [<span class="hljs-keyword">nn</span>])==<span class="hljs-number">0</span>,  [<span class="hljs-keyword">nn</span>]=[<span class="hljs-keyword">nn</span>] AND NOT A
<span class="hljs-number">1</span>C <span class="hljs-keyword">nn</span> <span class="hljs-keyword">nn</span>    ----<span class="hljs-keyword">z</span>-  <span class="hljs-number">6</span>   TRB nnnn    <span class="hljs-keyword">z</span>=(A AND [nnnn])==<span class="hljs-number">0</span>,[nnnn]=[nnnn] AND NOT A</code></pre><h3 id="bit-setreset"><a class="header-link" href="#bit-setreset"></a>Bit Set/Reset</h3>
<p>NOTE: These instructions are incompatible with 65C816</p>
<pre class="hljs"><code>Opcode      Flags Clks  Syntax      Effect
x7+00       <span class="hljs-params">------</span>  5   RMBx nn     [nn]<span class="hljs-string">.bit_x=0</span>
x7+80       <span class="hljs-params">------</span>  5   SMBx nn     [nn]<span class="hljs-string">.bit_x=1</span></code></pre><h2 id="cpu-rotate-and-shift-instructions"><a class="header-link" href="#cpu-rotate-and-shift-instructions"></a>CPU Rotate and Shift Instructions</h2>
<p>In effect column, c means input carry flag, c&#39; means resulting carry flag.
-&gt; and &lt;- does a shift-in/out by 1 bit.</p>
<h3 id="logicalarithmetic-shift-left"><a class="header-link" href="#logicalarithmetic-shift-left"></a>Logical/Arithmetic Shift Left</h3>
<pre class="hljs"><code><span class="hljs-attribute">Opcode</span>      Flags Clks  Syntax      Effect
<span class="hljs-attribute">0A</span>          n---zc  <span class="hljs-number">2</span>   ASL A       c&#x27;&lt;-A&lt;-<span class="hljs-number">0</span>
<span class="hljs-attribute">06</span> nn       n---zc  <span class="hljs-number">5</span>   ASL nn      c&#x27;&lt;-[nn]&lt;-<span class="hljs-number">0</span>
<span class="hljs-attribute">16</span> nn       n---zc  <span class="hljs-number">6</span>   ASL nn,X    c&#x27;&lt;-[nn+X]&lt;-<span class="hljs-number">0</span>
<span class="hljs-attribute">0E</span> nn nn    n---zc  <span class="hljs-number">6</span>   ASL nnnn    c&#x27;&lt;-[nnnn]&lt;-<span class="hljs-number">0</span>
<span class="hljs-attribute">1E</span> nn nn    n---zc  <span class="hljs-number">7</span>   ASL nnnn,X  c&#x27;&lt;-[nnnn+X]&lt;-<span class="hljs-number">0</span></code></pre><h3 id="logical-shift-right"><a class="header-link" href="#logical-shift-right"></a>Logical Shift Right</h3>
<pre class="hljs"><code><span class="hljs-attribute">Opcode</span>      Flags Clks  Syntax      Effect
<span class="hljs-attribute">4A</span>          <span class="hljs-number">0</span>---zc  <span class="hljs-number">2</span>   LSR A       <span class="hljs-number">0</span>-&gt;A-&gt;c&#x27;
<span class="hljs-attribute">46</span> nn       <span class="hljs-number">0</span>---zc  <span class="hljs-number">5</span>   LSR nn      <span class="hljs-number">0</span>-&gt;[nn]-&gt;c&#x27;
<span class="hljs-attribute">56</span> nn       <span class="hljs-number">0</span>---zc  <span class="hljs-number">6</span>   LSR nn,X    <span class="hljs-number">0</span>-&gt;[nn+X]-&gt;c&#x27;
<span class="hljs-attribute">4E</span> nn nn    <span class="hljs-number">0</span>---zc  <span class="hljs-number">6</span>   LSR nnnn    <span class="hljs-number">0</span>-&gt;[nnnn]-&gt;c&#x27;
<span class="hljs-attribute">5E</span> nn nn    <span class="hljs-number">0</span>---zc  <span class="hljs-number">7</span>   LSR nnnn,X  <span class="hljs-number">0</span>-&gt;[nnnn+X]-&gt;c&#x27;</code></pre><h3 id="rotate-left-through-carry"><a class="header-link" href="#rotate-left-through-carry"></a>Rotate Left through Carry</h3>
<pre class="hljs"><code>Opcode      Flags Clks  Syntax      Effect
<span class="hljs-number">2</span>A          n---zc  <span class="hljs-number">2</span>   ROL A       <span class="hljs-keyword">c</span>&#x27;&lt;-A&lt;-<span class="hljs-keyword">c</span>
<span class="hljs-number">26</span> nn       n---zc  <span class="hljs-number">5</span>   ROL nn      <span class="hljs-keyword">c</span>&#x27;&lt;-[nn]&lt;-<span class="hljs-keyword">c</span>
<span class="hljs-number">36</span> nn       n---zc  <span class="hljs-number">6</span>   ROL nn<span class="hljs-punctuation">,</span>X    <span class="hljs-keyword">c</span>&#x27;&lt;-[nn+X]&lt;-<span class="hljs-keyword">c</span>
<span class="hljs-number">2</span>E nn nn    n---zc  <span class="hljs-number">6</span>   ROL nnnn    <span class="hljs-keyword">c</span>&#x27;&lt;-[nnnn]&lt;-<span class="hljs-keyword">c</span>
<span class="hljs-number">3</span>E nn nn    n---zc  <span class="hljs-number">7</span>   ROL nnnn<span class="hljs-punctuation">,</span>X  <span class="hljs-keyword">c</span>&#x27;&lt;-[nnnn+X]&lt;-<span class="hljs-keyword">c</span></code></pre><h3 id="rotate-right-through-carry"><a class="header-link" href="#rotate-right-through-carry"></a>Rotate Right through Carry</h3>
<pre class="hljs"><code><span class="hljs-type">Opcode</span>      <span class="hljs-type">Flags</span> <span class="hljs-type">Clks</span>  <span class="hljs-type">Syntax</span>      <span class="hljs-type">Effect</span>
<span class="hljs-number">6</span>A          n---zc  <span class="hljs-number">2</span>   <span class="hljs-type">ROR</span> <span class="hljs-type">A</span>       c-&gt;<span class="hljs-type">A</span>-&gt;c&#x27;
<span class="hljs-number">66</span> nn       n---zc  <span class="hljs-number">5</span>   <span class="hljs-type">ROR</span> nn      c-&gt;[nn]-&gt;c&#x27;
<span class="hljs-number">76</span> nn       n---zc  <span class="hljs-number">6</span>   <span class="hljs-type">ROR</span> nn,<span class="hljs-type">X</span>    c-&gt;[nn+<span class="hljs-type">X</span>]-&gt;c&#x27;
<span class="hljs-number">6</span>E nn nn    n---zc  <span class="hljs-number">6</span>   <span class="hljs-type">ROR</span> nnnn    c-&gt;[nnnn]-&gt;c&#x27;
<span class="hljs-number">7</span>E nn nn    n---zc  <span class="hljs-number">7</span>   <span class="hljs-type">ROR</span> nnnn,<span class="hljs-type">X</span>  c-&gt;[nnnn+<span class="hljs-type">X</span>]-&gt;c&#x27;</code></pre><p>NOTE: ROL and ROR rotate an 8-bit value through carry (9 bits in total).</p>
<h2 id="cpu-jump-and-control-instructions"><a class="header-link" href="#cpu-jump-and-control-instructions"></a>CPU Jump and Control Instructions</h2>
<h3 id="normal-jumps"><a class="header-link" href="#normal-jumps"></a>Normal Jumps</h3>
<pre class="hljs"><code>Opcode      Flags Clks  Syntax          Effect
80 rr       ------  3   BRA rr          <span class="hljs-attribute">PC</span>=PC+/-rr
4C nn nn    ------  3   JMP nnnn        <span class="hljs-attribute">PC</span>=nnnn
6C nn nn    ------  6   JMP (nnnn)      <span class="hljs-attribute">PC</span>=WORD[nnnn]
7C nn nn    ------  6   JMP (nnnn,X)    <span class="hljs-attribute">PC</span>=WORD[nnnn+X]
20 nn nn    ------  6   JSR nnnn        [S]=PC+2, <span class="hljs-attribute">PC</span>=nnnn, <span class="hljs-attribute">S</span>=S+2
40          nvdizc  6   RTI             P=[S+1], PC=[S+2], <span class="hljs-attribute">S</span>=S+3
60          ------  6   RTS             PC=[S+1]+1, <span class="hljs-attribute">S</span>=S+2</code></pre><p>Note: RTI cannot modify the B Flag or the unused flag. The 65C02 doesn&#39;t have
<code>JMP (nnnn)</code> operand crossing page boundaries bug found in older NMOS 6502s
(although it spends one more cycle).</p>
<h3 id="conditional-branches-branch-on-condition-to-pc-rr"><a class="header-link" href="#conditional-branches-branch-on-condition-to-pc-rr"></a>Conditional Branches (Branch on condition to PC+/-rr)</h3>
<pre class="hljs"><code>Opcode      Flags Clks  Syntax      Condition (branch <span class="hljs-keyword">if</span>)
10 dd       ------  2** BPL rr      <span class="hljs-attribute">N</span>=0 (positive)
30 dd       ------  2** BMI rr      <span class="hljs-attribute">N</span>=1 (negative)
50 dd       ------  2** BVC rr      <span class="hljs-attribute">V</span>=0 (<span class="hljs-literal">no</span> overflow)
70 dd       ------  2** BVS rr      <span class="hljs-attribute">V</span>=1 (overflow)
90 dd       ------  2** BCC rr      <span class="hljs-attribute">C</span>=0 (<span class="hljs-literal">no</span> carry/less than)
B0 dd       ------  2** BCS rr      <span class="hljs-attribute">C</span>=1 (carry/greater then/equal)
D0 dd       ------  2** BNE rr      <span class="hljs-attribute">Z</span>=0 (<span class="hljs-keyword">not</span> zero/<span class="hljs-keyword">not</span> equal)
F0 dd       ------  2** BEQ rr      <span class="hljs-attribute">Z</span>=1 (zero/equal)
xF+00 nn rr ------  5   BBRx nn,rr^ [nn].<span class="hljs-attribute">bit_x</span>=0
xF+80 nn rr ------  5   BBSx nn,rr^ [nn].<span class="hljs-attribute">bit_x</span>=1</code></pre><p><small>^ These instructions are incompatible with 65C816</small><br><small>** If the condition is false (no branch executed). Otherwise, 3 cycles
if the destination is in the same memory page, or 4 cycles if it crosses a page
boundary (see below for exact info).</small></p>
<p>NOTE: After subtractions (SBC or CMP), carry is set when the result is above
or equal, unlike as in Z80 and x86 CPUs.</p>
<h3 id="interrupts-breakpoints"><a class="header-link" href="#interrupts-breakpoints"></a>Interrupts, Breakpoints</h3>
<pre class="hljs"><code>Opcode    Clks  Syntax  Effect
00          7   BRK     <span class="hljs-attribute">B</span>=1, [S]=PC+2,[S-2]=P, <span class="hljs-attribute">S</span>=S-3, <span class="hljs-attribute">D</span>=0 <span class="hljs-attribute">I</span>=1, PC=[00FFFE]
--          7   <span class="hljs-built_in">/IRQ </span>   <span class="hljs-attribute">B</span>=0, [S]=PC,  [S-2]=P, <span class="hljs-attribute">S</span>=S-3, <span class="hljs-attribute">D</span>=0 <span class="hljs-attribute">I</span>=1, PC=[00FFFE]
--          7   /NMI    <span class="hljs-attribute">B</span>=0, [S]=PC,  [S-2]=P, <span class="hljs-attribute">S</span>=S-3, <span class="hljs-attribute">D</span>=0 <span class="hljs-attribute">I</span>=1, PC=[00FFFA]
--          7   /RESET  <span class="hljs-attribute">B</span>=1                           <span class="hljs-attribute">D</span>=0 <span class="hljs-attribute">I</span>=1, PC=[00FFFC]</code></pre><p>IRQs can be disabled by setting the I flag. BRK, NMI, and /RESET signal cannot
be masked by setting I.</p>
<p>Interrupts first change the B flag, then write PC and P to the stack, and then
set the I flag. The D flag is cleared and BRK will not be ignored if IRQ
happens right after a fetch of that instruction, unlike in older NMOS 6502s.</p>
<p>The same vector is shared for BRK and IRQ. Software can separate between those
by examining the pushed B flag in the stack.</p>
<p>The RTI opcode can be used to return from BRK/IRQ/NMI. Note that returning from
BRK will skip one signature byte following after the BRK opcode.</p>
<p>IRQs are executed whenever /IRQ signal goes low and I flag is set to 0. NMIs
are executed whenever /NMI signal goes from high to low. If /IRQ signal is kept
low then the same interrupt is executed again as soon as I flag is set to 0. If
/NMI signal is kept LOW then no further NMIs can be executed. Software or
hardware must take care to acknowledge or reset /IRQ or /NMI signals after
processing it.</p>
<h3 id="cpu-control"><a class="header-link" href="#cpu-control"></a>CPU Control</h3>
<pre class="hljs"><code>Opcode      Flags Clks  Syntax      Effect
18          -----0  2   CLC         <span class="hljs-attribute">C</span>=0     ; Clear carry flag
58          ---0--  2   CLI         <span class="hljs-attribute">I</span>=0     ; Clear interrupt <span class="hljs-builtin-name">disable</span> bit
D8          --0---  2   CLD         <span class="hljs-attribute">D</span>=0     ; Clear decimal mode
B8          -0----  2   CLV         <span class="hljs-attribute">V</span>=0     ; Clear overflow flag
38          -----1  2   SEC         <span class="hljs-attribute">C</span>=1     ; <span class="hljs-builtin-name">Set</span> carry flag
78          ---1--  2   SEI         <span class="hljs-attribute">I</span>=1     ; <span class="hljs-builtin-name">Set</span> interrupt <span class="hljs-builtin-name">disable</span> bit
F8          --1---  2   SED         <span class="hljs-attribute">D</span>=1     ; <span class="hljs-builtin-name">Set</span> decimal mode</code></pre><h3 id="special-opcodes"><a class="header-link" href="#special-opcodes"></a>Special Opcodes</h3>
<pre class="hljs"><code>Opcode      Flags Clks  Syntax      Effect
CB          <span class="hljs-comment">------  3x  WAI         HALT</span>
DB          <span class="hljs-comment">------  -   STP         STOP</span>
EA          <span class="hljs-comment">------  2   NOP         No operation</span></code></pre><p>WAI halts the CPU until an IRQ/NMI/Reset occurs. In case of IRQs, this works
even if IRQs are disabled (I flag is set to 1). STP will stop the entire
processor&#39;s operation until a hardware Reset occurs.</p>
<p>Any other opcodes not mentioned throughout this chapter are invalid and
executed as NOPs. Those later become new opcodes in 65C816.</p>
<h3 id="conditional-branch-page-crossing"><a class="header-link" href="#conditional-branch-page-crossing"></a>Conditional Branch Page Crossing</h3>
<p>The branch opcode with parameter takes up two bytes (or three bytes in case of
BBSx and BBRx), causing the PC to get incremented past it without any extra
boundary cycle. If a branch is taken, the signed parameter is then added to the
PC (PC+rr). The extra clock cycle occurs if the addition crosses page
boundaries. BBSx and BBRx instructions don&#39;t have any extra cycle penalties at
all (?).</p>
<h1 id="aboutcredits"><a class="header-link" href="#aboutcredits"></a>About/Credits</h1>
<h3 id="about-1"><a class="header-link" href="#about-1"></a>About</h3>
<p>This document is written as an alternative to the official reference and aims
to document Commander X16 hardware in detail as much as possible. While still
being easy to follow in programmer&#39;s perspective. There are still lots of
missing and uncomfirmed details based on speculation and emulator source codes
(marked by (?)). Keep in mind that the hardware is currently in development and
it (and this specs too) can change anytime!</p>
<p>This document is released under
<a href="https://creativecommons.org/licenses/by/4.0/">CC-BY-4.0 license</a>. Everyone is
welcome to contribute, add missing bits and provide feedbacks through the
website repository linked below.</p>
<blockquote>
<p>Needed: Someone with a real hardware prototype, preferably active on Discord
too...</p>
</blockquote>
<h3 id="authors"><a class="header-link" href="#authors"></a>Authors</h3>
<p>Natt Akuma</p>
<h3 id="credits"><a class="header-link" href="#credits"></a>Credits</h3>
<ul class="list">
<li>Michael Steil (official X16 programmer&#39;s reference)</li>
<li>Frank van den Hoef (official VERA programmer&#39;s reference)</li>
<li>Martin Korth (nocash) (SNES/65xx CPU reference)</li>
<li>Official X16 emulator contributors</li>
<li>Aaron Giles, Nuke.YKT (YM2151 core and test register details)</li>
<li>Adam Chapweske (PS/2 interface articles)</li>
</ul>
<h3 id="homepage"><a class="header-link" href="#homepage"></a>Homepage</h3>
<p><a href="https://ayce.dev/emptyx16.html">https://ayce.dev/emptyx16.html</a> - X16 specs updates (html version)<br><a href="https://ayce.dev/emptyx16.txt">https://ayce.dev/emptyx16.txt</a> - X16 specs updates (text version)<br><a href="https://github.com/AYCEdemo/emptyx16">https://github.com/AYCEdemo/emptyx16</a> - X16 specs repository  </p>
    </div>
  </div>
</body>
</html>
